var earthjs=function(){"use strict";var t=function(){function t(t){var n=t[0]/2*h,e=u(n),o=s(n),r=t[1]/2*h,a=u(r),i=s(r),l=t[2]/2*h,c=u(l),d=s(l);return[o*i*d+e*a*c,e*i*d-o*a*c,o*a*d+e*i*c,o*i*c-e*a*d]}function n(t,n){return[t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]]}function e(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}var o=Math.acos,r=Math.asin,a=Math.atan2,s=Math.cos,i=Math.max,l=Math.min,c=Math.PI,u=Math.sin,d=Math.sqrt,h=c/180,p=180/c;return t.cartesian=function(t){var n=t[0]*h,e=t[1]*h,o=s(e);return[o*s(n),o*u(n),u(e)]},t.rotation=function(t){return[a(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*p,r(i(-1,l(1,2*(t[0]*t[2]-t[3]*t[1]))))*p,a(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*p]},t.delta=function(t,r){var a=n(t,r),c=d(e(a,a));if(!c)return[1,0,0,0];var h=o(i(-1,l(1,e(t,r))))/2,p=u(h);return[s(h),a[2]/c*p,-a[1]/c*p,a[0]/c*p]},t.multiply=function(t,n){return[t[0]*n[0]-t[1]*n[1]-t[2]*n[2]-t[3]*n[3],t[0]*n[1]+t[1]*n[0]+t[2]*n[3]-t[3]*n[2],t[0]*n[2]-t[1]*n[3]+t[2]*n[0]+t[3]*n[1],t[0]*n[3]+t[1]*n[2]-t[2]*n[1]+t[3]*n[0]]},t}(),n=function n(){function e(t,n){t[n]&&(r[n][t.name]=t[n],r[n+"Keys"]=Object.keys(r[n]))}var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};clearInterval(n.ticker),o=Object.assign({transparent:!1,select:"#earth",rotate:130},o);var r={onResize:{},onResizeKeys:[],onRefresh:{},onRefreshKeys:[],onInterval:{},onIntervalKeys:[],renderOrder:["renderThree","svgAddDropShadow","svgAddCanvas","canvasAddGraticule","canvasAddWorldOrCountries","canvasAddDots","svgAddOcean","svgAddGlobeShading","svgAddGraticule","svgAddWorldOrCountries","svgAddGlobeHilight","svgAddPlaces","svgAddPings","svgAddDots","svgAddBar","addBarTooltip","addCountryTooltip","addCountryCenteroid"],ready:null,loadingData:null,promeses:[]},a=d3.selectAll(o.select),s=a.attr("width"),i=a.attr("height");s&&i||(s=o.width||700,i=o.height||500,a.attr("width",s).attr("height",i));var l=[s/2,i/2];Object.defineProperty(o,"width",{get:function(){return s},set:function(t){s=t,l[0]=t/2}}),Object.defineProperty(o,"height",{get:function(){return i},set:function(t){i=t,l[1]=t/2}});var c={_:{svg:a,drag:!1,versor:t,center:l,options:o},$fn:{},$slc:{},ready:function(t){if(!t)return r.loadingData;if(r.promeses.length>0){r.loadingData=!0;var n=d3.queue();r.promeses.forEach(function(t){t.urls.forEach(function(t){var e=t.split(".").pop();"geojson"===e&&(e="json"),n.defer(d3[e],t)})}),n.await(function(){var n=[].slice.call(arguments),e=n.shift();r.promeses.forEach(function(t){var o=t.urls.length,r=n.slice(0,o),a=c[t.name].ready;r.unshift(e),a?a.apply(c,r):t.onReady.apply(c,r),n=n.slice(o)}),r.loadingData=!1,t.call(c)})}},register:function(t){var n={};return c[t.name]=n,Object.keys(t).forEach(function(e){-1===["urls","onReady","onInit","onResize","onRefresh","onInterval"].indexOf(e)&&"function"==typeof t[e]&&(n[e]=function(){return t[e].apply(c,arguments)})}),t.onInit&&t.onInit.call(c),e(t,"onResize"),e(t,"onRefresh"),e(t,"onInterval"),t.urls&&t.onReady&&r.promeses.push({name:t.name,urls:t.urls,onReady:t.onReady}),c}},u=[],d=null,h=c._;return c.svgDraw=function(t){var n=c.$fn;return u=t||[],r.renderOrder.forEach(function(t){n[t]&&n[t].call(c)}),u.forEach(function(t){t.svgDraw(null)}),null===d&&u!==[]&&h.ticker(),c},c.$slc.defs=h.svg.append("defs"),h.ticker=function(t){var e=h.intervalRun;return t=t||50,d=setInterval(function(){e.call(c),u.forEach(function(t){t._.intervalRun.call(t)})},t),n.ticker=d,c},h.scale=function(t){return h.proj.scale(t),h.resize(),h.refresh(),c},h.rotate=function(t){return h.proj.rotate(t),h.refresh(),c},h.intervalRun=function(){return r.onIntervalKeys.forEach(function(t){r.onInterval[t].call(c)}),c},h.refresh=function(t){return(t?r.onRefreshKeys.filter(function(n){return t.test(n)}):r.onRefreshKeys).forEach(function(t){r.onRefresh[t].call(c)}),c},h.resize=function(){return r.onResizeKeys.forEach(function(t){r.onResize[t].call(c)}),c},h.orthoGraphic=function(){return d3.geoOrthographic().rotate([h.options.rotate,0]).scale(h.options.width/3.5).translate(h.center).precision(.1).clipAngle(90)},h.addRenderer=function(t){r.renderOrder.indexOf(t)<0&&r.renderOrder.push(t)},h.proj=h.orthoGraphic(),h.path=d3.geoPath().projection(h.proj),c};return n.plugins={versorDragPlugin:function(){function t(){function t(t){var n=t[0]-l[0];t[0]=n+this._.proj.rotate()[0],t[0]>=180&&(t[0]-=360),this._.rotate(t)}function e(){i=s.cartesian(a.proj.invert(d3.mouse(this))),l=a.proj.rotate(),c=s(l),a.drag=null,a.refresh(),n.mouse=null}function o(){var t=this,e=d3.mouse(this),o=s.cartesian(a.proj.rotate(l).invert(e)),r=s.multiply(c,s.delta(i,o)),u=s.rotation(r);a.rotate(u),a.drag=!0,n.mouse=e,n.onDragKeys.forEach(function(o){n.onDrag[o].call(t,e)})}function r(){var e=a.proj.rotate();n.sync.forEach(function(n){t.call(n,e)}),a.drag=!1,a.refresh(),n.mouse=null}var a=this._,s=a.versor;n.svg.call(d3.drag().on("start",e).on("end",r).on("drag",o));var i=void 0,l=void 0,c=void 0}var n={svg:null,q:null,sync:[],mouse:null,onDrag:{},onDragKeys:[]};return{name:"versorDragPlugin",onInit:function(){n.svg=this._.svg,t.call(this)},selectAll:function(e){return e&&(n.q=e,n.svg.call(d3.drag().on("start",null).on("end",null).on("drag",null)),n.svg=d3.selectAll(e),t.call(this)),n.svg},sync:function(t){n.sync=t},mouse:function(){return n.mouse},onDrag:function(t){Object.assign(n.onDrag,t),n.onDragKeys=Object.keys(n.onDrag)}}},wheelZoomPlugin:function(){function t(){var t=this._;n.svg.on("wheel",function(){var e=d3.event.deltaY+t.proj.scale();e=e<20?20:e>999?1e3:e,t.scale(e),n.sync.forEach(function(t){t._.scale.call(t,e)})})}var n={svg:null,q:null,sync:[]};return{name:"wheelZoomPlugin",onInit:function(){n.svg=this._.svg,t.call(this)},selectAll:function(e){return e&&(n.q=e,n.svg.on("wheel",null),n.svg=d3.selectAll(e),t.call(this)),n.svg},sync:function(t){n.sync=t}}},threejsPlugin:function(){function t(){setTimeout(function(){n.renderer.render(n.scene,n.camera)},1)}var n={renderer:null,scene:null,camera:null,scale:null};return{name:"threejsPlugin",onInit:function(){var e=this._.options.width,o=this._.options.height;n.scene=new THREE.Scene,n.yAxis=new THREE.Vector3(0,1,0),n.camera=new THREE.OrthographicCamera(-e/2,e/2,o/2,-o/2,.1,1e4),n.camera.position.z=500,this._.camera=n.camera,n.renderer=new THREE.WebGLRenderer({antialias:!0}),n.renderer.domElement.id="three-js",n.renderer.setClearColor("white",1),n.renderer.setSize(e,o),document.body.appendChild(n.renderer.domElement),this.renderThree=t},onRefresh:function(){t.call(this)},addObject:function(t){n.scene.add(t)}}},canvasPlugin:function(){function t(){var t=this._;if(t.options.showCanvas){if(!n.canvas){var e=t.svg.append("g").attr("class","canvas").append("foreignObject").attr("x",0).attr("y",0).attr("width",t.options.width).attr("height",t.options.height),o=e.append("xhtml:body").style("margin","0px").style("padding","0px").style("background-color","none").style("width",t.options.width+"px").style("height",t.options.height+"px");n.canvas=o.append("canvas")}return n.canvas.attr("x",0).attr("y",0).attr("width",t.options.width).attr("height",t.options.height),n.canvas}}var n={canvas:null,path:null,q:null};return{name:"canvasPlugin",onInit:function(){this._.options.showCanvas=!0,this.$fn.svgAddCanvas=t,n.path=d3.geoPath().projection(this._.proj)},onRefresh:function(){var t=this._.options,e=t.width,o=t.height;n.canvas.each(function(){this.getContext("2d").clearRect(0,0,e,o)})},selectAll:function(t){return t&&(n.q=t,n.canvas=d3.selectAll(t)),n.canvas},render:function(t,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=this._;if(r.options.showCanvas){var a=!1,s=r.proj,i=s.rotate(),l=this;n.canvas.each(function(r,c){if(!e||e.indexOf(c)>-1){var u=o[c]||{};u.rotate?(a=!0,s.rotate([i[0]+u.rotate,i[1],i[2]])):a&&(a=!1,s.rotate(i));var d=this.getContext("2d");t.call(l,d,n.path.context(d))}}),a&&(a=!1,s.rotate(i))}}}},oceanPlugin:function(){function t(){if(e.svg.selectAll("#ocean,.ocean").remove(),this._.options.showOcean){var t=this.$slc.defs.append("radialGradient").attr("id","ocean").attr("cx","75%").attr("cy","25%");t.append("stop").attr("offset","5%").attr("stop-color","#ddf"),t.append("stop").attr("offset","100%").attr("stop-color","#9ab"),e.ocean=e.svg.append("g").attr("class","ocean").append("circle").attr("cx",this._.center[0]).attr("cy",this._.center[1]).attr("class","noclicks"),n.call(this)}}function n(){e.ocean&&this._.options.showOcean&&e.ocean.attr("r",this._.proj.scale()+e.scale)}var e={svg:null,q:null,scale:0};return{name:"oceanPlugin",onInit:function(){this.$fn.svgAddOcean=t,this._.options.showOcean=!0,e.svg=this._.svg},onResize:function(){n.call(this)},selectAll:function(t){return t&&(e.q=t,e.svg=d3.selectAll(t)),e.svg},scale:function(t){if(!t)return e.scale;e.scale=t,n.call(this)}}},configPlugin:function(){return{name:"configPlugin",set:function(t){if(t){if(Object.assign(this._.options,t),void 0!==t.spin){var n=this.autorotatePlugin;t.spin?n.start():n.stop()}this.svgDraw()}return Object.assign({},this._.options)}}},graticuleCanvas:function(){function t(){var t=this._;t.options.showGraticule&&((t.options.transparent||t.options.transparentGraticule)&&t.proj.clipAngle(180),this.canvasPlugin.render(function(t,o){t.beginPath(),o(n),t.lineWidth=.3,t.strokeStyle=e.style.line||"rgba(119,119,119,0.4)",t.stroke()},e.drawTo),(t.options.transparent||t.options.transparentGraticule)&&t.proj.clipAngle(90))}var n=d3.geoGraticule()(),e={style:{},drawTo:null};return{name:"graticuleCanvas",onInit:function(){this.$fn.canvasAddGraticule=t,this._.options.transparentGraticule=!1,this._.options.showGraticule=!0},onRefresh:function(){t.call(this)},style:function(t){return t&&(e.style=t),e.style},drawTo:function(t){e.drawTo=t}}},graticulePlugin:function(){function t(){e.svg.selectAll(".graticule").remove(),this._.options.showGraticule&&(o.graticule=e.svg.append("g").attr("class","graticule").append("path").datum(e.graticule).attr("class","noclicks"),n.call(this))}function n(){var t=this._;o.graticule&&t.options.showGraticule&&(t.options.transparent||t.options.transparentGraticule?(t.proj.clipAngle(180),o.graticule.attr("d",this._.path),t.proj.clipAngle(90)):o.graticule.attr("d",this._.path))}var e={svg:null,q:null,graticule:d3.geoGraticule()},o={};return{name:"graticulePlugin",onInit:function(){this.$fn.svgAddGraticule=t,this._.options.showGraticule=!0,e.svg=this._.svg},onRefresh:function(){n.call(this)},selectAll:function(t){return t&&(e.q=t,e.svg=d3.selectAll(t)),e.svg}}},fauxGlobePlugin:function(){function t(){var t=this._;if(o.svg.selectAll("#drop_shadow,.drop_shadow").remove(),t.options.showGlobeShadow){var n=this.$slc.defs.append("radialGradient").attr("id","drop_shadow").attr("cx","50%").attr("cy","50%");n.append("stop").attr("offset","20%").attr("stop-color","#000").attr("stop-opacity",".5"),n.append("stop").attr("offset","100%").attr("stop-color","#000").attr("stop-opacity","0"),r.dropShadow=o.svg.append("g").attr("class","drop_shadow").append("ellipse").attr("cx",t.center[0]).attr("cy",t.options.height-50).attr("rx",.9*t.proj.scale()).attr("ry",.25*t.proj.scale()).attr("class","noclicks").style("fill","url(#drop_shadow)")}}function n(){var t=this._;if(o.svg.selectAll("#shading,.shading").remove(),t.options.showGlobeShading){var n=this.$slc.defs.append("radialGradient").attr("id","shading").attr("cx","50%").attr("cy","40%");n.append("stop").attr("offset","50%").attr("stop-color","#9ab").attr("stop-opacity","0"),n.append("stop").attr("offset","100%").attr("stop-color","#3e6184").attr("stop-opacity","0.3"),r.globeShading=o.svg.append("g").attr("class","shading").append("circle").attr("cx",t.center[0]).attr("cy",t.center[1]).attr("r",t.proj.scale()).attr("class","noclicks").style("fill","url(#shading)")}}function e(){var t=this._;if(o.svg.selectAll("#hilight,.hilight").remove(),t.options.showGlobeHilight){var n=this.$slc.defs.append("radialGradient").attr("id","hilight").attr("cx","75%").attr("cy","25%");n.append("stop").attr("offset","5%").attr("stop-color","#ffd").attr("stop-opacity","0.6"),n.append("stop").attr("offset","100%").attr("stop-color","#ba9").attr("stop-opacity","0.2"),r.globeHilight=o.svg.append("g").attr("class","hilight").append("circle").attr("cx",t.center[0]).attr("cy",t.center[1]).attr("r",t.proj.scale()).attr("class","noclicks").style("fill","url(#hilight)")}}var o={svg:null,q:null},r={};return{name:"fauxGlobePlugin",onInit:function(){var r=this._.options;r.showGlobeShadow=!0,r.showGlobeShading=!0,r.showGlobeHilight=!0,this.$fn.svgAddDropShadow=t,this.$fn.svgAddGlobeHilight=e,this.$fn.svgAddGlobeShading=n,o.svg=this._.svg},onResize:function(){var t=this._,n=t.options,e=t.proj.scale();r.globeShading&&n.showGlobeShading&&r.globeShading.attr("r",e),r.globeHilight&&n.showGlobeHilight&&r.globeHilight.attr("r",e),r.dropShadow&&n.showGlobeShadow&&r.dropShadow.attr("cy",e+250).attr("rx",.9*e).attr("ry",.25*e)},selectAll:function(t){return t&&(o.q=t,o.svg=d3.selectAll(t)),o.svg}}},autorotatePlugin:function(t){function n(t){var n=this._.proj.rotate();n[0]+=e.degree*t,this._.rotate(n)}var e={lastTick:new Date,degree:t/1e3,sync:[]};return{name:"autorotatePlugin",onInit:function(){this._.options.spin=!0},onInterval:function(){var t=new Date;if(this._.options.spin&&!this._.drag){var o=t-e.lastTick;n.call(this,o),e.sync.forEach(function(t){return n.call(t,o)})}e.lastTick=t},speed:function(t){e.degree=t/1e3},start:function(){this._.options.spin=!0},stop:function(){this._.options.spin=!1},sync:function(t){e.sync=t}}},countrySelectCanvas:function(){function t(t,n){for(var e,o,r=t.length,a=t[r-1],s=n[0],i=n[1],l=a[0],c=a[1],u=!1,d=0;d<r;++d)a=t[d],e=a[0],o=a[1],o>i!=c>i&&s<(l-e)*(i-o)/(c-o)+e&&(u=!u),l=e,c=o;return u}var n={countries:null,country:null,mouse:null,onHover:{},onHoverKeys:[]};return{name:"countrySelectCanvas",onInit:function(){var e=this._,o=this.worldCanvas,r=o.data(),a=r.world;a&&(n.countries=topojson.feature(a,a.objects.countries));var s=function(){var o=this,r=d3.mouse(this),a=e.proj.invert(r);n.country=n.countries.features.find(function(n){return n.geometry.coordinates.find(function(n){return t(n,a)||n.find(function(n){return t(n,a)})})}),n.mouse=r,n.onHoverKeys.forEach(function(t){n.onHover[t].call(o,n.mouse,n.country)})};e.svg.on("mousemove",s),this.versorDragPlugin&&this.versorDragPlugin.onDrag({countrySelectCanvas:s})},data:function(){return{country:n.country,mouse:n.mouse}},onHover:function(t){Object.assign(n.onHover,t),n.onHoverKeys=Object.keys(n.onHover)},world:function(t){n.countries=topojson.feature(t,t.objects.countries)}}},countryTooltipCanvas:function(){function t(t){return o.style("left",t[0]+7+"px").style("top",t[1]-15+"px")}function n(){o.style("opacity",0).style("display","none")}var e={show:!1},o=d3.select("body").append("div").attr("class","countryTooltip");return{name:"countryTooltipCanvas",onInit:function(){var e=this,o=function(){var o=e.countrySelectCanvas.data(),r=o.country,a=o.mouse;if(r){var s=e.worldCanvas.countryName(r);s?t(a).style("display","block").style("opacity",1).text(s.name):n()}else n()};this.countrySelectCanvas.onHover({countryTooltipCanvas:o}),this.versorDragPlugin&&this.versorDragPlugin.onDrag({countryTooltipCanvas:o})},onRefresh:function(){this._.drag&&e.show&&t(this.versorDragPlugin.mouse())}}},countryTooltipPlugin:function(){function t(){var t=this;this.worldPlugin.$countries().on("mouseover",function(o){if(!t._.drag){e.show=!0;var r=t.worldPlugin.countryName.call(t,o);n(d3.mouse(this)).style("display","block").style("opacity",1).text(r.name)}}).on("mouseout",function(){t._.drag||(e.show=!1,o.style("opacity",0).style("display","none"))}).on("mousemove",function(){t._.drag||n(d3.mouse(this))})}function n(t){return o.style("left",t[0]+7+"px").style("top",t[1]-15+"px")}var e={show:!1},o=d3.select("body").append("div").attr("class","countryTooltip");return{name:"countryTooltipPlugin",onInit:function(){this.$fn.addCountryTooltip=t},onRefresh:function(){this._.drag&&e.show&&n(this.versorDragPlugin.mouse())}}},barTooltipPlugin:function(){function t(){var t=this;this.barPlugin.$bar().on("mouseover",function(){var e=+this.dataset.index,o=t.barPlugin.data().features[e];t.barTooltipPlugin.onShow&&(o=t.barTooltipPlugin.onShow.call(this,o,e,n)),t.barTooltipPlugin.show(o).style("left",d3.event.pageX+7+"px").style("top",d3.event.pageY-15+"px").style("display","block").style("opacity",1)}).on("mouseout",function(){n.style("opacity",0).style("display","none")}).on("mousemove",function(){n.style("left",d3.event.pageX+7+"px").style("top",d3.event.pageY-15+"px")})}var n=d3.select("body").append("div").attr("class","barTooltip");return{name:"barTooltipPlugin",onInit:function(){this.$fn.addBarTooltip=t},show:function(t){var e=t.properties,o=Object.keys(e).map(function(t){return t+": "+e[t]}).join("<br/>");return n.html(o)}}},placesPlugin:function(t){function n(){s.svg.selectAll(".points,.labels").remove(),s.places&&this._.options.showPlaces&&(o.call(this),r.call(this),e.call(this))}function e(){i.placePoints&&(i.placePoints.attr("d",this._.path),a.call(this))}function o(){i.placePoints=s.svg.append("g").attr("class","points").selectAll("path").data(s.places.features).enter().append("path").attr("class","point")}function r(){i.placeLabels=s.svg.append("g").attr("class","labels").selectAll("text").data(s.places.features).enter().append("text").attr("class","label").text(function(t){return t.properties.name})}function a(){var t=this,n=this._.proj.invert(this._.center);i.placeLabels.attr("text-anchor",function(n){var e=t._.proj(n.geometry.coordinates)[0];return e<t._.center[0]-20?"end":e<t._.center[0]+20?"middle":"start"}).attr("transform",function(n){var e=t._.proj(n.geometry.coordinates),o=e[0],r=e[1];return"translate("+(o+(o<t._.center[0]?-5:5))+","+(r-2)+")"}).style("display",function(t){return d3.geoDistance(t.geometry.coordinates,n)>1.57?"none":"inline"})}var s={svg:null,q:null,places:null},i={};return{name:"placesPlugin",urls:t&&[t],onReady:function(t,n){s.places=n},onInit:function(){this.$fn.svgAddPlaces=n,this._.options.showPlaces=!0,s.svg=this._.svg},onRefresh:function(){e.call(this)},selectAll:function(t){return t&&(s.q=t,s.svg=d3.selectAll(t)),s.svg},data:function(t){if(!t)return{places:s.places};var n=t.placesPlugin.data();s.places=n.places}}},worldCanvas:function(t,n){function e(){var t=this._;if(s.world&&t.options.showLand&&((t.options.transparent||t.options.transparentWorld)&&(t.proj.clipAngle(180),this.canvasPlugin.render(function(t,n){t.beginPath(),n(s.land),t.fillStyle=s.style.backLand||"rgba(119,119,119,0.2)",t.fill()},s.drawTo,s.options),t.proj.clipAngle(90)),!t.drag&&t.options.showCountries?(r.call(this),t.options.showLakes&&a.call(this)):o.call(this),this.countrySelectCanvas)){var n=this.countrySelectCanvas.data(),e=n.country;this.canvasPlugin.render(function(t,n){t.beginPath(),n(e),t.fillStyle="rgba(117, 0, 0, 0.4)",t.fill()})}}function o(){this.canvasPlugin.render(function(t,n){t.beginPath(),n(s.land),t.fillStyle=s.style.land||"rgba(117, 87, 57, 0.4)",t.fill()},s.drawTo,s.options)}function r(){this.canvasPlugin.render(function(t,n){t.beginPath(),n(s.countries),t.lineWidth=.1,t.fillStyle=s.style.land||"rgba(117, 87, 57, 0.4)",t.strokeStyle=s.style.countries||"rgb(239, 237, 234)",t.fill(),t.stroke()},s.drawTo,s.options)}function a(){this.canvasPlugin.render(function(t,n){t.beginPath(),n(s.lakes),t.fillStyle=s.style.lakes||"rgba(80, 87, 97, 0.4)",t.fill()},s.drawTo,s.options)}var s={world:null,countryNames:null,style:{},drawTo:null,options:{}},i=null;return t&&(i=[t],n&&i.push(n)),{name:"worldCanvas",urls:i,onReady:function(t,n,e){this.worldCanvas.data({world:n,countryNames:e})},onInit:function(){var t=this._.options;t.showLand=!0,t.showLakes=!0,t.showCountries=!0,t.transparentWorld=!1,this.$fn.canvasAddWorldOrCountries=e},onRefresh:function(){e.call(this)},data:function(t){return t&&(s.world=t.world,s.countryNames=t.countryNames,s.land=topojson.feature(s.world,s.world.objects.land),s.lakes=topojson.feature(s.world,s.world.objects.ne_110m_lakes),s.countries=topojson.feature(s.world,s.world.objects.countries)),{world:s.world,countryNames:s.countryNames}},countryName:function(t){var n="";return s.countryNames&&(n=s.countryNames.find(function(n){return n.id==t.id})),n},style:function(t){return t&&(s.style=t),s.style},drawTo:function(t){s.drawTo=t},options:function(t){s.options=t}}},worldPlugin:function(t,n){function e(){var t=this._;l.svg.selectAll(".landbg,.land,.lakes,.countries").remove(),t.options.showLand&&(l.world&&((t.options.transparent||t.options.transparentWorld)&&l.svgAddWorldBg.call(this),t.options.showCountries?l.svgAddCountries.call(this):l.svgAddWorld.call(this),t.options.showLakes&&l.svgAddLakes.call(this)),o.call(this))}function o(){var t=this._;l.world&&t.options.showLand&&((t.options.transparent||t.options.transparentWorld)&&(t.proj.clipAngle(180),c.worldBg.attr("d",t.path),t.proj.clipAngle(90)),t.options.showCountries?c.countries.attr("d",t.path):c.world.attr("d",t.path),t.options.showLakes&&c.lakes.attr("d",t.path))}function r(){c.worldBg=l.svg.append("g").attr("class","landbg").append("path").datum(l.land).attr("fill","rgba(119,119,119,0.2)")}function a(){c.world=l.svg.append("g").attr("class","land").append("path").datum(l.land)}function s(){c.countries=l.svg.append("g").attr("class","countries").selectAll("path").data(l.countries.features).enter().append("path").attr("id",function(t){return"x"+t.id})}function i(){c.lakes=l.svg.append("g").attr("class","lakes").append("path").datum(l.lakes)}var l={svg:null,q:null,world:null,countryNames:null},c={},u=null;return t&&(u=[t],n&&u.push(n)),{name:"worldPlugin",urls:u,onReady:function(t,n,e){this.worldPlugin.data({world:n,countryNames:e})},onInit:function(){var t=this._,n=t.options;n.showLand=!0,n.showLakes=!0,n.showCountries=!0,n.transparentWorld=!1,this.$fn.svgAddWorldOrCountries=e,l.svgAddCountries=s,l.svgAddWorldBg=r,l.svgAddLakes=i,l.svgAddWorld=a,l.svg=t.svg},onRefresh:function(){o.call(this)},countries:function(){return l.countries.features},data:function(t){return t&&(l.world=t.world,l.countryNames=t.countryNames,l.land=topojson.feature(l.world,l.world.objects.land),l.lakes=topojson.feature(l.world,l.world.objects.ne_110m_lakes),l.countries=topojson.feature(l.world,l.world.objects.countries)),{world:l.world,countryNames:l.countryNames}},countryName:function(t){var n="";return l.countryNames&&(n=l.countryNames.find(function(n){return n.id==t.id})),n},selectAll:function(t){return t&&(l.q=t,l.svg=d3.selectAll(t)),l.svg},$countries:function(){return c.countries}}},worldThreejs:function(){function t(){if(!e.sphereObject){var t=this,o=new THREE.Group;(new THREE.TextureLoader).load("./d/world.jpg",function(r){var a=new THREE.SphereGeometry(200,20,20),s=new THREE.MeshBasicMaterial({map:r,overdraw:.5});e.sphereObject=new THREE.Mesh(a,s),o.add(e.sphereObject),n.call(t)}),t.threejsPlugin.addObject(o)}}function n(){var t=this._.proj.rotate();t[0]-=90;var n=this._.versor(t),o=new THREE.Quaternion(-n[2],n[1],n[3],n[0]);e.sphereObject.setRotationFromQuaternion(o)}var e={sphereObject:null};return{name:"worldThreejs",onInit:function(){t.call(this)},onRefresh:function(){e.sphereObject&&n.call(this)}}},centerPlugin:function(){function t(t,n){n=n.replace("x","");for(var e=0,o=t.length;e<o;e++)if(t[e].id==n)return t[e]}function n(t){var n=this;d3.transition().duration(2500).tween("rotate",function(){var e=d3.interpolate(n._.proj.rotate(),[-t[0],-t[1],0]);return function(t){n._.rotate(e(t))}})}function e(){var e=this;this.worldPlugin.$countries().on("click",function(){if(e._.options.enableCenter){var r=this.id.replace("x",""),a=e.worldPlugin.countries(),s=t(a,r),i=d3.geoCentroid(s);n.call(e,i),"function"==typeof o.focused&&o.focused.call(e)}})}var o={focused:null,svgAddCountriesOld:null};return{name:"centerPlugin",onInit:function(){this.$fn.addCountryCenteroid=e,this._.options.enableCenter=!0},go:function(e){var o=this.worldPlugin.countries(),r=t(o,e),a=d3.geoCentroid(r);n.call(this,a)},focused:function(t){o.focused=t}}},flattenPlugin:function(){function t(){var n=this;return n._.svg.transition().duration(10500).tween("projection",function(){return function(e){t.alpha(e),n._.refresh()}})}function n(n,e){function o(t,o){var r=n([t*=180/Math.PI,o*=180/Math.PI]),s=e([t,o]);return[(1-a)*r[0]+a*s[0],(a-1)*r[1]-a*s[1]]}var r=d3.geoProjection(o).scale(1),a=void 0;return t.alpha=function(t){if(!arguments.length)return a;a=+t;var o=n.center(),s=e.center(),i=n.translate(),l=e.translate();return r.center([(1-a)*o[0]+a*s[0],(1-a)*o[1]+a*s[1]]),r.translate([(1-a)*i[0]+a*l[0],(1-a)*i[1]+a*l[1]]),r},t.alpha(0),r}function e(){var t=this._;return d3.transition().duration(1500).tween("rotate",function(){t.rotate(t.proj.rotate());var n=d3.interpolate(t.proj.rotate(),[0,0,0]);return function(e){t.rotate(n(e))}})}var o={};return{name:"flattenPlugin",onInit:function(){var t=this._.proj,n=d3.geoEquirectangular().scale(this._.options.width/6.3).translate(this._.center);o.g1=t,o.g2=n},toMap:function(){var r=this;e.call(this).on("end",function(){var e=n(o.g1,o.g2);r._.path=d3.geoPath().projection(e),t.call(r).on("end",function(){r._.options.enableCenter=!1})})},toGlobe:function(){var e=this;this._.rotate([0,0,0]);var r=n(o.g2,o.g1);this._.path=d3.geoPath().projection(r),t.call(this).on("end",function(){e._.path=d3.geoPath().projection(e._.proj),e._.options.enableCenter=!0,e._.refresh()})}}},barPlugin:function(t){function n(){var t=this._;if(r.svg.selectAll(".bar").remove(),r.bars&&t.options.showBars){var n=r.svg.append("g").attr("class","bar"),o=n.append("mask").attr("id","edge");o.append("rect").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").attr("fill","white"),o.append("use").attr("xlink:href","#edgeCircle").attr("fill","black"),r.max=d3.max(r.bars.features,function(t){return parseInt(t.geometry.value)});var s=t.proj.scale();r.lengthScale=d3.scaleLinear().domain([0,r.max]).range([s,s+50]),a.bar=n.selectAll("line").data(r.bars.features).enter().append("line").attr("stroke","red").attr("stroke-width","2").attr("data-index",function(t,n){return n}),e.call(this)}}function e(){var t=this._;if(r.bars&&t.options.showBars){var n=t.proj,e=r.lengthScale,o=r.barProjection,s=n.invert(t.center);a.bar.each(function(t){var r=t.geometry.coordinates;o.scale(e(t.geometry.value));var a=d3.geoDistance(r,s),i=n(r),l=o(r);d3.select(this).attr("x1",i[0]).attr("y1",i[1]).attr("x2",l[0]).attr("y2",l[1]).attr("mask",a<1.57?null:"url(#edge)")})}}function o(){var t=this._;this.$slc.defs.selectAll("clipPath").remove(),this.$slc.defs.append("clipPath").append("circle").attr("id","edgeCircle").attr("cx",t.center[0]).attr("cy",t.center[1]).attr("r",t.proj.scale())}var r={svg:null,barProjection:null,q:null,bars:null},a={};return{name:"barPlugin",urls:t&&[t],onReady:function(t,n){var o=this;r.bars=n,setTimeout(function(){return e.call(o)},1)},onInit:function(){var t=this._;this.$fn.svgAddBar=n,t.options.showBars=!0,r.barProjection=t.orthoGraphic(),r.svg=t.svg,o.call(this)},onResize:function(){o.call(this),n.call(this)},onRefresh:function(){r.barProjection.rotate(this._.proj.rotate()),e.call(this)},selectAll:function(t){return t&&(r.q=t,r.svg=d3.selectAll(t)),r.svg},data:function(t){if(!t)return r.bars;r.bars=t},$bar:function(){return a.bar}}},dotsPlugin:function(){function t(){var t=this._;if(o.dataDots&&t.options.showDots&&!t.drag&&(t.svg.selectAll(".dot").remove(),o.dataDots&&t.options.showDots)){var e=[];if(o.circles.forEach(function(t){e.push(t.circle)}),r.dots=t.svg.append("g").attr("class","dot").selectAll("path").data(e).enter().append("path"),o.dataDots.geometry){var a=o.dataDots.geometry;a.lineWidth&&r.dots.style("stroke-width",a.lineWidth),a.fillStyle&&r.dots.style("fill",a.fillStyle),a.strokeStyle&&r.dots.style("stroke",a.strokeStyle)}n.call(this)}}function n(){var t=this._;r.dots&&t.options.showDots&&r.dots.attr("d",t.path).style("display",function(n){return d3.geoDistance(n.coordinates,t.proj.invert(t.center))>1.57?"none":"inline"})}function e(){var t=d3.geoCircle(),n=o.dataDots.geometry||{},e=n.radius||.5;o.circles=o.dataDots.features.map(function(n){var o=n.geometry.coordinates,r=n.geometry.radius||e;return{coordinates:o,circle:t.center(o).radius(r)()}})}var o={dataDots:null},r={};return{name:"dotsPlugin",onInit:function(){this.$fn.svgAddDots=t,this._.options.showDots=!0},onRefresh:function(){n.call(this)},data:function(t){o.dataDots=t,e()}}},dotsCanvas:function(){function t(){if(e.dataDots&&this._.options.showDots){var t=[],n=this._.proj,o=e.dataDots.geometry||{},r=n.invert(this._.center);this.canvasPlugin.render(function(n,a){e.circles.forEach(function(n){d3.geoDistance(n.coordinates,r)<=1.57&&t.push(n.circle)}),n.beginPath(),a({type:"GeometryCollection",geometries:t}),n.lineWidth=o.lineWidth||.2,n.fillStyle=o.fillStyle||"rgba(100,0,0,.4)",n.strokeStyle=o.strokeStyle||"rgba(100,0,0,.6)",n.fill(),n.stroke(),n.closePath()},e.drawTo)}}function n(){var t=d3.geoCircle(),n=e.dataDots.geometry||{},o=n.radius||.5;e.circles=e.dataDots.features.map(function(n){var e=n.geometry.coordinates,r=n.geometry.radius||o;return{coordinates:e,circle:t.center(e).radius(r)()}})}var e={dataDots:null,circles:[]};return{name:"dotsCanvas",onInit:function(){this.$fn.canvasAddDots=t,this._.options.showDots=!0},onRefresh:function(){t.call(this)},data:function(t){e.dataDots=t,n()},drawTo:function(t){e.drawTo=t}}},pingsCanvas:function(){var t={dataPings:null,pings:[]};return{name:"pingsCanvas",onInit:function(){this._.options.showPings=!0},onInterval:function(){if(!this._.drag&&this._.options.showPings){var n=void 0,e=this._.proj;if(t.pings.length<=7){n=this._.proj.invert(this._.center);var o=t.dataPings.features.filter(function(t){return d3.geoDistance(t.geometry.coordinates,n)<=1.57}),r=o[Math.floor(Math.random()*(o.length-1))];t.pings.push({r:2.5,l:r.geometry.coordinates})}var a=t.pings[0];d3.geoDistance(a.l,this._.proj.invert(this._.center))>1.57?t.pings.shift():(this._.options.spin||this._.refresh(/anvas/),this.canvasPlugin.render(function(n){if(n.beginPath(),n.fillStyle="#F80",n.arc(e(a.l)[0],e(a.l)[1],a.r,0,2*Math.PI),n.fill(),n.closePath(),a.r=a.r+.2,a.r>5)t.pings.shift();else if(t.pings.length>1){var o=t.pings.shift();t.pings.push(o)}},t.drawTo))}},data:function(n){t.dataPings=n},drawTo:function(n){t.drawTo=n}}},pingsPlugin:function(){function t(){if(o.svg.selectAll(".pings").remove(),o.dataPings&&this._.options.showPings){var t=o.svg.append("g").attr("class","pings");r.ping2=t.selectAll(".ping-2").data(o.dataPings.features).enter().append("circle").attr("class","ping-2").attr("id",function(t,n){return"ping-"+n}),r.pings=t.selectAll(".ping-2"),e.call(this),n.call(this)}}function n(){var t=r.ping2.nodes().filter(function(t){return"inline"==t.style.display});t.length>0&&d3.select("#"+t[Math.floor(Math.random()*(t.length-1))].id).attr("r",2).attr("stroke","#F00").attr("stroke-opacity",1).attr("stroke-width","10px").transition().duration(1e3).attr("r",30).attr("fill","none").attr("stroke-width","0.1px")}function e(){if(null==this._.drag)r.pings.style("display","none");else if(!this._.drag&&r.pings&&this._.options.showPings){var t=this._.proj,n=this._.proj.invert(this._.center);r.pings.attr("cx",function(n){return t(n.geometry.coordinates)[0]}).attr("cy",function(n){return t(n.geometry.coordinates)[1]}).style("display",function(t){return d3.geoDistance(t.geometry.coordinates,n)>1.57?"none":"inline"})}}var o={svg:null,dataPings:null},r={};return{name:"pingsPlugin",onInit:function(){var e=this;this._.options.showPings=!0,this.$fn.svgAddPings=t,setInterval(function(){return n.call(e)},3e3),o.svg=this._.svg},onRefresh:function(){e.call(this)},data:function(t){o.dataPings=t},selectAll:function(t){return t&&(o.q=t,o.svg=d3.selectAll(t)),o.svg}}},debugThreejs:function(){function t(){if(!e.sphereObject){var t=this._.proj.scale(),o=new THREE.SphereGeometry(t,100,100),r=new THREE.MeshNormalMaterial({wireframe:!1
}),a=new THREE.Mesh(o,r),s=new THREE.SphereGeometry(30,10,10),i=new THREE.SphereGeometry(30,10,10),l=new THREE.SphereGeometry(30,10,10);s.translate(0,0,t),i.translate(t,0,0),l.translate(0,-t,0);var c=new THREE.MeshBasicMaterial({color:"blue"}),u=new THREE.MeshBasicMaterial({color:"red"}),d=new THREE.MeshBasicMaterial({color:"green"}),h=new THREE.Mesh(s,c),p=new THREE.Mesh(i,u),f=new THREE.Mesh(l,d);e.sphereObject=new THREE.Object3D,e.sphereObject.add(a,h,p,f),n.call(this),this.threejsPlugin.addObject(e.sphereObject)}}function n(){var t=this._.proj.rotate();t[0]-=90;var n=this._.versor(t),o=new THREE.Quaternion(-n[2],n[1],n[3],n[0]);e.sphereObject.setRotationFromQuaternion(o)}var e={sphereObject:null};return{name:"debugThreejs",onInit:function(){this._.options.showDebugSpahre=!0,t.call(this)},onRefresh:function(){e.sphereObject&&n.call(this)}}},commonPlugins:function(t){var n={checker:[]};return{name:"commonPlugins",onInit:function(){var e=this,o=this.register,r=earthjs.plugins;o(r.autorotatePlugin(10)),o(r.versorDragPlugin()),o(r.wheelZoomPlugin()),o(r.configPlugin()),o(r.oceanPlugin()),o(r.canvasPlugin()),o(r.graticuleCanvas()),o(r.worldCanvas(t)),this.canvasPlugin.selectAll(".canvas"),this.ready(function(){return e.svgDraw()}),n.options=this.configPlugin.set(),n.buttonClick=function(t){var o=t.split(":"),r=o[2],a={},s=n.options;s[r]=!s[r],a[r]=s[r],"hideCountries"==r&&(a.hideLand=!1),e.configPlugin.set(a)},n.checker=["ocean:Ocean:showOcean","graticule:Graticule:showGraticule","hideLand:Land:showLand","spin:Spin:spin"].map(function(t){return t.split(":")}),d3.select(".set-options").selectAll("button").data(n.checker).enter().append("button").text(function(t){return t[1]}).on("click",function(t){return n.buttonClick.call(e,t.join(":"))})},addChecker:function(t){var e=this;n.checker.push(t),n.options=this.configPlugin.set(),d3.select(".set-options").selectAll("button").data(n.checker).enter().append("button").text(function(t){return t[1]}).on("click",function(t){return n.buttonClick.call(e,t.join(":"))})}}}},n}();