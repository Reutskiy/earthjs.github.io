var earthjs=function(){"use strict";var t=function(){function t(t){var n=t[0]/2*d,o=u(n),e=i(n),r=t[1]/2*d,a=u(r),s=i(r),l=t[2]/2*d,c=u(l),h=i(l);return[e*s*h+o*a*c,o*s*h-e*a*c,e*a*h+o*s*c,e*s*c-o*a*h]}function n(t,n){return[t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]]}function o(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}var e=Math.acos,r=Math.asin,a=Math.atan2,i=Math.cos,s=Math.max,l=Math.min,c=Math.PI,u=Math.sin,h=Math.sqrt,d=c/180,f=180/c;return t.cartesian=function(t){var n=t[0]*d,o=t[1]*d,e=i(o);return[e*i(n),e*u(n),u(o)]},t.rotation=function(t){return[a(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*f,r(s(-1,l(1,2*(t[0]*t[2]-t[3]*t[1]))))*f,a(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*f]},t.delta=function(t,r){var a=n(t,r),c=h(o(a,a));if(!c)return[1,0,0,0];var d=e(s(-1,l(1,o(t,r))))/2,f=u(d);return[i(d),a[2]/c*f,-a[1]/c*f,a[0]/c*f]},t.multiply=function(t,n){return[t[0]*n[0]-t[1]*n[1]-t[2]*n[2]-t[3]*n[3],t[0]*n[1]+t[1]*n[0]+t[2]*n[3]-t[3]*n[2],t[0]*n[2]-t[1]*n[3]+t[2]*n[0]+t[3]*n[1],t[0]*n[3]+t[1]*n[2]-t[2]*n[1]+t[3]*n[0]]},t}(),n=function n(){function o(t,n){t[n]&&(r[n][t.name]=t[n],r[n+"Keys"]=Object.keys(r[n]),r[n+"Vals"]=Object.values(r[n]))}var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};clearInterval(n.ticker),e=Object.assign({selectAll:"#earth-js",rotate:[130,-33,-11],transparent:!1},e);var r={onCreate:{},onCreateKeys:[],onCreateVals:[],onRefresh:{},onRefreshKeys:[],onRefreshVals:[],onResize:{},onResizeKeys:[],onResizeVals:[],onInterval:{},onIntervalKeys:[],onIntervalVals:[],ready:null,promeses:[],loadingData:null,recreateSvgOrCanvas:function(){return r.onCreateVals.forEach(function(t){t.call(c)}),c}};window.__=r;var a=d3.selectAll(e.selectAll),i=a.attr("width"),s=a.attr("height");i&&s||(i=e.width||700,s=e.height||500,a.attr("width",i).attr("height",s));var l=[i/2,s/2];Object.defineProperty(e,"width",{get:function(){return i},set:function(t){i=t,l[0]=t/2}}),Object.defineProperty(e,"height",{get:function(){return s},set:function(t){s=t,l[1]=t/2}});var c={_:{svg:a,drag:!1,versor:t,center:l,options:e},$slc:{},ready:function(t){if(t&&r.promeses.length>0){var n=d3.queue();r.loadingData=!0,r.promeses.forEach(function(t){t.urls.forEach(function(t){var o=t.split(".").pop();"geojson"===o&&(o="json"),n.defer(d3[o],t)})}),n.await(function(){var n=[].slice.call(arguments),o=n.shift();r.promeses.forEach(function(t){var e=t.urls.length,r=n.slice(0,e),a=c[t.name].ready;r.unshift(o),a?a.apply(c,r):t.onReady.apply(c,r),n=n.slice(e)}),r.loadingData=!1,t.call(c)})}else if(0===arguments.length)return r.loadingData},register:function(t){var n={};return c[t.name]=n,Object.keys(t).forEach(function(o){-1===["urls","onReady","onInit","onCreate","onRefresh","onResize","onInterval"].indexOf(o)&&"function"==typeof t[o]&&(n[o]=function(){return t[o].apply(c,arguments)})}),t.onInit&&t.onInit.call(c),o(t,"onCreate"),o(t,"onResize"),o(t,"onRefresh"),o(t,"onInterval"),t.urls&&t.onReady&&r.promeses.push({name:t.name,urls:t.urls,onReady:t.onReady}),c}},u=[],h=null,d=c._;return c.create=function(t){return u=t||[],r.recreateSvgOrCanvas(),u.forEach(function(t){t.create(null)}),null===h&&u!==[]&&d.ticker(),c},c.$slc.defs=d.svg.append("defs"),d.ticker=function(t){var o=d.interval;return t=t||50,h=setInterval(function(){o.call(c),u.forEach(function(t){t._.interval.call(t)})},t),n.ticker=h,c},d.scale=function(t){return d.proj.scale(t),d.resize(),d.refresh(),c},d.rotate=function(t){return d.proj.rotate(t),d.refresh(),c},d.interval=function(){return r.onIntervalVals.forEach(function(t){t.call(c)}),c},d.refresh=function(t){if(t){(t?r.onRefreshKeys.filter(function(n){return t.test(n)}):r.onRefreshKeys).forEach(function(t){r.onRefresh[t].call(c)})}else r.onRefreshVals.forEach(function(t){t.call(c)});return c},d.resize=function(){return r.onResizeVals.forEach(function(t){t.call(c)}),c},d.orthoGraphic=function(){var t=d.options.rotate;return"number"==typeof t&&(d.options.rotate=[t,-33,-11]),d3.geoOrthographic().rotate(d.options.rotate).scale(d.options.width/3.5).translate(d.center).precision(.1).clipAngle(90)},d.proj=d.orthoGraphic(),d.path=d3.geoPath().projection(d.proj),c},o=function(){return{name:"configPlugin",set:function(t){if(t){if(Object.assign(this._.options,t),void 0!==t.spin){var n=this.autorotatePlugin;t.spin?n.start():n.stop()}this.create()}return Object.assign({},this._.options)}}},e=function(){function t(){var t=new Date;if(this._.options.spin&&!this._.drag){var o=t-e.lastTick;n.call(this,o),e.sync.forEach(function(t){return n.call(t,o)})}e.lastTick=t}function n(t){var n=this._.proj.rotate();n[0]+=e.degree*t,this._.rotate(n)}var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e={lastTick:new Date,degree:o/1e3,sync:[]};return{name:"autorotatePlugin",onInit:function(){this._.options.spin=!0},onInterval:function(){t.call(this)},speed:function(t){e.degree=t/1e3},start:function(){this._.options.spin=!0},stop:function(){this._.options.spin=!1},sync:function(t){e.sync=t}}},r=function(){function t(){c.onClickKeys.forEach(function(t){c.onClick[t].call(c._this,c.event,c.mouse)}),console.log("onClick")}function n(){c.onDblClickKeys.forEach(function(t){c.onDblClick[t].call(c._this,c.event,c.mouse)}),console.log("onDblClick")}function o(t){var n=t.versor,o=n.cartesian(t.proj.rotate(h).invert(c.mouse)),e=n.multiply(d,n.delta(u,o));c.r=n.rotation(e)}function e(t){var n=this;o(t),t.rotate(c.r),c.onDragKeys.forEach(function(t){c.onDrag[t].call(n,c.mouse)})}function r(){function r(){var t=s,n=y*d3.event.transform.k;n>=t[0]&&n<=t[1]&&(v.scale(n),c.sync.forEach(function(t){return t._.scale(n)}))}function a(t){var n=t[0]-h[0];t[0]=n+this._.proj.rotate()[0],t[0]>=180&&(t[0]-=360),this._.rotate(t)}function i(){var t=d3.mouse(this);u=g.cartesian(v.proj.invert(t)),h=v.proj.rotate(),d=g(h),v.drag=null,v.refresh(),c.mouse=t,c._this=this,c.t1=0,c.t2=0}function f(){v.drag=!0,c._this=this,c.mouse=d3.mouse(this),!l&&e(v)}function p(){null===v.drag?(c.event=d3.event,v.options.spin?t():c.wait?(c.wait=null,n()):null===c.wait&&(c.wait=window.setTimeout(function(){c.wait&&(c.wait=!1)},250))):v.drag&&(o(v),v.rotate(c.r),c.onDragKeys.forEach(function(t){c.onDrag[t].call(c._this,c.mouse)}),c.sync.forEach(function(t){return a.call(t,c.r)})),v.drag=!1,v.refresh()}var v=this._,g=v.versor,y=v.proj.scale(),C=[v.options.width,v.options.height];c.svg.call(d3.drag().on("start",i).on("end",p).on("drag",f)),c.svg.call(d3.zoom().on("zoom",r).scaleExtent([.1,5]).translateExtent([[0,0],C]))}var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{zoomScale:[0,1e3]},i=a.selector,s=a.zoomScale,l=a.iDrag,c={svg:null,q:null,sync:[],mouse:null,wait:null,onDrag:{},onDragKeys:[],onClick:{},onClickKeys:[],onDblClick:{},onDblClickKeys:[]},u=void 0,h=void 0,d=void 0;return{name:"mousePlugin",onInit:function(){c.oMouse=[];var t=this._;c.svg=i?d3.selectAll(i):t.svg,r.call(this)},onInterval:function(){var n=this._;n.drag&&l?c.oMouse[0]!==c.mouse[0]&&c.oMouse[1]!==c.mouse[1]&&(c.oMouse=c.mouse,e(n)):!1===c.wait&&(c.wait=null,t())},selectAll:function(t){return t&&(c.q=t,c.svg.call(d3.zoom().on("zoom start end",null)),c.svg.call(d3.drag().on("start",null).on("end",null).on("drag",null)),c.svg=d3.selectAll(t),r.call(this)),c.svg},sync:function(t){c.sync=t},mouse:function(){return c.mouse},onDrag:function(t){Object.assign(c.onDrag,t),c.onDragKeys=Object.keys(c.onDrag)},onClick:function(t){Object.assign(c.onClick,t),c.onClickKeys=Object.keys(c.onClick)},onDblClick:function(t){Object.assign(c.onDblClick,t),c.onDblClickKeys=Object.keys(c.onDblClick)}}},a=function(){function t(){function t(){var t=d3.event.transform;n.proj.scale(o*t.k),n.resize(),n.refresh()}var n=this._,o=n.proj.scale(),e=[n.options.width,n.options.height];n.svg.call(d3.zoom().on("zoom start end",t).scaleExtent([.1,5]).translateExtent([[0,0],e]))}return{name:"zoomPlugin",onInit:function(){t.call(this)}}},i=function(){function t(){var t=this._.options.width,r=this._.options.height;e.scene=new THREE.Scene,e.yAxis=new THREE.Vector3(0,1,0),e.camera=new THREE.OrthographicCamera(-t/2,t/2,r/2,-r/2,.1,1e4),e.camera.position.z=500,this._.camera=e.camera;var a=document.getElementById(o);e.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0,canvas:a}),e.renderer.setClearColor(0,0),e.renderer.setSize(t,r),this.renderThree=n}function n(){setTimeout(function(){e.renderer.render(e.scene,e.camera)},1)}var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"three-js",e={renderer:null,scene:null,camera:null,scale:null};return{name:"threejsPlugin",onInit:function(){t.call(this)},onRefresh:function(){n.call(this)},addObject:function(t){e.scene.add(t)}}},s=function(t){function n(){var t=this._;t.options.showCanvas=!0,r.path=d3.geoPath().projection(t.proj)}function o(){var t=this._;if(t.options.showCanvas){if(!r.canvas){var n=t.svg.append("g").attr("class","canvas").append("foreignObject").attr("x",0).attr("y",0).attr("width",t.options.width).attr("height",t.options.height),o=n.append("xhtml:body").style("margin","0px").style("padding","0px").style("background-color","none").style("width",t.options.width+"px").style("height",t.options.height+"px");r.canvas=o.append("canvas")}r.canvas.attr("x",0).attr("y",0).attr("width",t.options.width).attr("height",t.options.height)}r.canvas&&e.call(this)}function e(){var t=this._.options,n=t.width,o=t.height;r.canvas.each(function(){this.getContext("2d").clearRect(0,0,n,o)})}var r={canvas:t&&d3.selectAll(t),path:null,q:null};return{name:"canvasPlugin",onInit:function(){n.call(this)},onCreate:function(){o.call(this)},onRefresh:function(){e.call(this)},selectAll:function(t){return t&&(r.q=t,r.canvas=d3.selectAll(t)),r.canvas},render:function(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],e=this._;if(e.options.showCanvas){var a=!1,i=e.proj,s=i.rotate(),l=this;r.canvas.each(function(e,c){if(!n||n.indexOf(c)>-1){var u=o[c]||{};u.rotate?(a=!0,i.rotate([s[0]+u.rotate,s[1],s[2]])):a&&(a=!1,i.rotate(s));var h=this.getContext("2d");t.call(l,h,r.path.context(h))}}),a&&(a=!1,i.rotate(s))}},flipRender:function(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],e=this._,r=e.center[0],a=e.proj.rotate();this.canvasPlugin.render(function(n,o){n.save(),n.translate(r,0),n.scale(-1,1),n.translate(-r,0),e.proj.rotate([a[0]+180,-a[1],-a[2]]),t.call(this,n,o),n.restore(),e.proj.rotate(a)},n,o)}}},l=function(){function t(){if(this._.options.showSelectedCountry=!1,this.worldCanvas){var t=this.worldCanvas.data(),e=t.world;e&&(o.countries=topojson.feature(e,e.objects.countries))}var r=this._,a=function(){var t=this,e=d3.event;if(!r.drag&&e){e.sourceEvent&&(e=e.sourceEvent);var a=[e.clientX,e.clientY],i=r.proj.invert(d3.mouse(this));o.pos=i,o.dot=null,o.mouse=a,o.country=null,r.options.showDots&&o.onCircleKeys.forEach(function(n){o.dot=o.onCircle[n].call(t,o.mouse,i)}),r.options.showLand&&o.countries&&!o.dot&&(r.drag||(o.country=n(i)),o.onCountryKeys.forEach(function(n){o.onCountry[n].call(t,o.mouse,o.country)}))}};r.svg.on("mousemove",a),this.mousePlugin&&this.mousePlugin.onDrag({hoverCanvas:a})}function n(t){return o.countries.features.find(function(n){return n.geometry.coordinates.find(function(n){return d3.polygonContains(n,t)||n.find(function(n){return d3.polygonContains(n,t)})})})}var o={mouse:null,country:null,countries:null,onCircle:{},onCircleKeys:[],onCountry:{},onCountryKeys:[]};return{name:"hoverCanvas",onInit:function(){t.call(this)},onCircle:function(t){Object.assign(o.onCircle,t),o.onCircleKeys=Object.keys(o.onCircle)},onCountry:function(t){Object.assign(o.onCountry,t),o.onCountryKeys=Object.keys(o.onCountry)},world:function(t){o.countries=topojson.feature(t,t.objects.countries)},data:function(){return{pos:o.pos,dot:o.dot,mouse:o.mouse,country:o.country}}}},c=function(){function t(){if(this.worldCanvas){var t=this.worldCanvas.data(),e=t.world;e&&(o.countries=topojson.feature(e,e.objects.countries))}var r=this._,a=function(t,e){var a=this;if(t){t.sourceEvent&&(t=t.sourceEvent);var i=[t.clientX,t.clientY],s=r.proj.invert(e);o.pos=s,o.dot=null,o.mouse=i,o.country=null,r.options.showDots&&o.onCircleKeys.forEach(function(t){o.dot=o.onCircle[t].call(a,o.mouse,s)}),r.options.showLand&&!o.dot&&(r.drag||(o.country=n(s)),o.onCountryKeys.forEach(function(t){o.onCountry[t].call(a,o.mouse,o.country)}))}};this.mousePlugin&&this.mousePlugin.onClick({clickCanvas:a})}function n(t){return o.countries.features.find(function(n){return n.geometry.coordinates.find(function(n){return d3.polygonContains(n,t)||n.find(function(n){return d3.polygonContains(n,t)})})})}var o={mouse:null,country:null,countries:null,onCircle:{},onCircleKeys:[],onCountry:{},onCountryKeys:[]};return{name:"clickCanvas",onInit:function(){t.call(this)},onCircle:function(t){Object.assign(o.onCircle,t),o.onCircleKeys=Object.keys(o.onCircle)},onCountry:function(t){Object.assign(o.onCountry,t),o.onCountryKeys=Object.keys(o.onCountry)},world:function(t){o.countries=topojson.feature(t,t.objects.countries)},data:function(){return{pos:o.pos,dot:o.dot,mouse:o.mouse,country:o.country}}}},u=function(){function t(t){return o.countries.features.find(function(n){return n.geometry.coordinates.find(function(n){return d3.polygonContains(n,t)||n.find(function(n){return d3.polygonContains(n,t)})})})}function n(){if(this.worldCanvas){var n=this.worldCanvas.data(),e=n.world;e&&(o.countries=topojson.feature(e,e.objects.countries))}var r=this._,a=function(n,e){var a=this;if(n){n.sourceEvent&&(n=n.sourceEvent);var i=[n.clientX,n.clientY],s=r.proj.invert(e);o.pos=s,o.dot=null,o.mouse=i,o.country=null,r.options.showDots&&o.onCircleKeys.forEach(function(t){o.dot=o.onCircle[t].call(a,o.mouse,s)}),r.options.showLand&&!o.dot&&(r.drag||(o.country=t(s)),o.onCountryKeys.forEach(function(t){o.onCountry[t].call(a,o.mouse,o.country)}))}};this.mousePlugin&&this.mousePlugin.onDblClick({dblClickCanvas:a})}var o={mouse:null,country:null,countries:null,onCircle:{},onCircleKeys:[],onCountry:{},onCountryKeys:[]};return{name:"dblClickCanvas",onInit:function(){n.call(this)},onCircle:function(t){Object.assign(o.onCircle,t),o.onCircleKeys=Object.keys(o.onCircle)},onCountry:function(t){Object.assign(o.onCountry,t),o.onCountryKeys=Object.keys(o.onCountry)},world:function(t){o.countries=topojson.feature(t,t.objects.countries)},data:function(){return{pos:o.pos,dot:o.dot,mouse:o.mouse,country:o.country}}}},h=function(t){function n(){var n=this._;this._.options.showOcean=!0,Object.defineProperty(n.options,"oceanColor",{get:function(){return a.oceanColor},set:function(t){a.oceanColor=t}}),a.svg=t?d3.selectAll(t):n.svg}function o(){if(a.svg.selectAll("#ocean,.ocean").remove(),this._.options.showOcean){var t=a.oceanColor,n=this.$slc.defs.append("radialGradient").attr("id","ocean").attr("cx","75%").attr("cy","25%");"number"==typeof t?(t=r[t],n.append("stop").attr("offset","5%").attr("stop-color",t[0])):"string"==typeof t&&(t=[t,t]),n.append("stop").attr("offset","100%").attr("stop-color",t[1]),i.ocean=a.svg.append("g").attr("class","ocean").append("circle").attr("cx",this._.center[0]).attr("cy",this._.center[1]).attr("class","noclicks"),e.call(this)}}function e(){i.ocean&&this._.options.showOcean&&i.ocean.attr("r",this._.proj.scale()+a.scale)}var r={0:["rgba(221, 221, 255, 0.6)","rgba(153, 170, 187,0.8)"],1:["rgba(159, 240, 232, 0.6)","rgba(  5, 242, 219,0.8)"],2:["rgba(152, 234, 242, 0.6)","rgba(  5, 219, 242,0.8)"],3:["rgba(114, 162, 181, 0.6)","rgba(  4, 138, 191,0.8)"],4:["rgba( 96, 123, 148, 0.6)","rgba( 10,  93, 166,0.8)"],5:["rgba( 87, 102, 131, 0.6)","rgba(  8,  52, 140,0.8)"]},a={svg:null,q:null,scale:0,oceanColor:0},i={};return{name:"oceanSvg",onInit:function(){n.call(this)},onCreate:function(){o.call(this)},onResize:function(){e.call(this)},selectAll:function(t){return t&&(a.q=t,a.svg=d3.selectAll(t)),a.svg},scale:function(t){if(!t)return a.scale;a.scale=t,e.call(this)},recreate:function(){o.call(this)},$ocean:function(){return i.ocean}}},d=function(t){function n(){var n=this._;n.options.showSphere=!0,r.svg=t?d3.selectAll(t):n.svg}function o(){r.svg.selectAll("#glow,.sphere").remove(),this._.options.showSphere&&(this.$slc.defs.nodes()[0].append("\n<filter id='glow'>\n    <feColorMatrix type='matrix'\n        values=\n        '0 0 0 0   0\n         0 0 0 0.9 0\n         0 0 0 0.9 0\n         0 0 0 1   0'/>\n    <feGaussianBlur stdDeviation='5.5' result='coloredBlur'/>\n    <feMerge>\n        <feMergeNode in='coloredBlur'/>\n        <feMergeNode in='SourceGraphic'/>\n    </feMerge>\n</filter>\n"),a.sphere=r.svg.append("g").attr("class","sphere").append("circle").attr("cx",this._.center[0]).attr("cy",this._.center[1]).attr("class","noclicks").attr("filter","url(#glow)"),e.call(this))}function e(){a.sphere.attr("r",this._.proj.scale())}var r={svg:null,q:null,sphereColor:0},a={};return{name:"sphereSvg",onInit:function(){n.call(this)},onCreate:function(){o.call(this)},onResize:function(){e.call(this)},selectAll:function(t){return t&&(r.q=t,r.svg=d3.selectAll(t)),r.svg},$sphere:function(){return a.sphere}}},f=function(){function t(){var t=this._;t.options.showGraticule=!0,t.options.transparentGraticule=!1}function n(){var t=this._;t.options.showGraticule&&((t.options.transparent||t.options.transparentGraticule)&&t.proj.clipAngle(180),this.canvasPlugin.render(function(t,n){t.beginPath(),n(o),t.lineWidth=.4,t.strokeStyle=e.style.line||"rgba(119,119,119,0.6)",t.stroke()},e.drawTo),(t.options.transparent||t.options.transparentGraticule)&&t.proj.clipAngle(90))}var o=d3.geoGraticule()(),e={style:{},drawTo:null};return{name:"graticuleCanvas",onInit:function(){t.call(this)},onCreate:function(){n.call(this)},onRefresh:function(){n.call(this)},drawTo:function(t){e.drawTo=t},style:function(t){return t&&(e.style=t),e.style}}},p=function(t){function n(){var n=this._;n.options.showGraticule=!0,n.options.transparentGraticule=!1,r.svg=t?d3.selectAll(t):n.svg}function o(){r.svg.selectAll(".graticule").remove(),this._.options.showGraticule&&(a.graticule=r.svg.append("g").attr("class","graticule").append("path").datum(r.graticule).attr("class","noclicks"),e.call(this))}function e(){var t=this._;a.graticule&&t.options.showGraticule&&(t.options.transparent||t.options.transparentGraticule?(t.proj.clipAngle(180),a.graticule.attr("d",this._.path),t.proj.clipAngle(90)):a.graticule.attr("d",this._.path))}var r={svg:null,q:null,graticule:d3.geoGraticule()},a={};return{name:"graticuleSvg",onInit:function(){n.call(this)},onCreate:function(){o.call(this)},onRefresh:function(){e.call(this)},selectAll:function(t){return t&&(r.q=t,r.svg=d3.selectAll(t)),r.svg},$graticule:function(){return a.graticule}}},v=function(t){function n(){var n=this._;n.options.showDropShadow=!0,r.svg=t?d3.selectAll(t):n.svg}function o(){var t=this._;if(r.svg.selectAll("#drop_shadow,.drop_shadow").remove(),t.options.showDropShadow){var n=this.$slc.defs.append("radialGradient").attr("id","drop_shadow").attr("cx","50%").attr("cy","50%");n.append("stop").attr("offset","20%").attr("stop-color","#000").attr("stop-opacity",".5"),n.append("stop").attr("offset","100%").attr("stop-color","#000").attr("stop-opacity","0"),a.dropShadow=r.svg.append("g").attr("class","drop_shadow").append("ellipse").attr("cx",t.center[0]).attr("class","noclicks").style("fill","url(#drop_shadow)"),e.call(this)}}function e(){var t=this._.proj.scale();a.dropShadow.attr("cy",t+this._.center[1]).attr("rx",.9*t).attr("ry",.25*t)}var r={svg:null,q:null},a={};return{name:"dropShadowSvg",onInit:function(){n.call(this)},onCreate:function(){o.call(this)},onResize:function(){a.dropShadow&&this._.options.showDropShadow&&e.call(this)},selectAll:function(t){return t&&(r.q=t,r.svg=d3.selectAll(t)),r.svg},$dropShadow:function(){return a.dropShadow}}},g=function(t){function n(){var n=this._;n.options.showGlobeShading=!0,n.options.showGlobeHilight=!0,i.svg=t?d3.selectAll(t):n.svg}function o(){e.call(this),r.call(this)}function e(){var t=this._;if(i.svg.selectAll("#shading,.shading").remove(),t.options.showGlobeShading){var n=this.$slc.defs.append("radialGradient").attr("id","shading").attr("cx","50%").attr("cy","40%");n.append("stop").attr("offset","50%").attr("stop-color","#9ab").attr("stop-opacity","0"),n.append("stop").attr("offset","100%").attr("stop-color","#3e6184").attr("stop-opacity","0.3"),s.globeShading=i.svg.append("g").attr("class","shading").append("circle").attr("cx",t.center[0]).attr("cy",t.center[1]).attr("r",t.proj.scale()).attr("class","noclicks").style("fill","url(#shading)")}}function r(){var t=this._;if(i.svg.selectAll("#hilight,.hilight").remove(),t.options.showGlobeHilight){var n=this.$slc.defs.append("radialGradient").attr("id","hilight").attr("cx","75%").attr("cy","25%");n.append("stop").attr("offset","5%").attr("stop-color","#ffd").attr("stop-opacity","0.6"),n.append("stop").attr("offset","100%").attr("stop-color","#ba9").attr("stop-opacity","0.2"),s.globeHilight=i.svg.append("g").attr("class","hilight").append("circle").attr("cx",t.center[0]).attr("cy",t.center[1]).attr("r",t.proj.scale()).attr("class","noclicks").style("fill","url(#hilight)")}}function a(){var t=this._,n=t.options,o=t.proj.scale();s.globeShading&&n.showGlobeShading&&s.globeShading.attr("r",o),s.globeHilight&&n.showGlobeHilight&&s.globeHilight.attr("r",o)}var i={svg:null,q:null},s={};return{name:"fauxGlobeSvg",onInit:function(){n.call(this)},onCreate:function(){o.call(this)},onResize:function(){a.call(this)},selectAll:function(t){return t&&(i.q=t,i.svg=d3.selectAll(t)),i.svg},$globeShading:function(){return s.globeShading},$globeHilight:function(){return s.globeHilight}}},y=function(){function t(){var t=this;this.dotsSvg.$dots().on("mouseover",function(){if(t._.options.showBarTooltip){e.visible=!0,e.mouseXY=[d3.event.pageX+7,d3.event.pageY-15];var o=+this.dataset.index,a=t.dotsSvg.data().features[o];t.dotTooltipSvg.onShow&&(a=t.dotTooltipSvg.onShow.call(this,a,r)),t.dotTooltipSvg.show(a.properties).style("display","block").style("opacity",1),n()}}).on("mouseout",function(){e.visible=!1,r.style("opacity",0).style("display","none")}).on("mousemove",function(){t._.options.showBarTooltip&&(e.mouseXY=[d3.event.pageX+7,d3.event.pageY-15],n())})}function n(){r.style("left",e.mouseXY[0]+7+"px").style("top",e.mouseXY[1]-15+"px")}function o(){t.call(this),r.style("opacity",0).style("display","none")}var e={mouseXY:[0,0],visible:!1},r=d3.select("body").append("div").attr("class","ej-dot-tooltip");return{name:"dotTooltipSvg",onInit:function(){this._.options.showBarTooltip=!0},onCreate:function(){t.call(this)},onRefresh:function(){n.call(this)},onResize:function(){o.call(this)},show:function(t){var n=Object.keys(t).map(function(n){return n+": "+t[n]}).join("<br/>");return r.html(n)},visible:function(){return e.visible}}},C=function(){function t(t,n){var e=null;return o.dots.forEach(function(o){if(t&&!e){d3.geoDistance(o.coordinates,n)<=.02&&(e=o)}}),e}function n(){var n=this;if(this.hoverCanvas){var e=function(e,r){var a=t(e,r);return o.onHoverKeys.forEach(function(t){o.onHover[t].call(n,e,a)}),a};this.hoverCanvas.onCircle({dotsCanvas:e})}if(this.clickCanvas){var r=function(e,r){var a=t(e,r);return o.onClickKeys.forEach(function(t){o.onClick[t].call(n,e,a)}),a};this.clickCanvas.onCircle({dotsCanvas:r})}if(this.dblClickCanvas){var a=function(e,r){var a=t(e,r);return o.onDblClickKeys.forEach(function(t){o.onDblClick[t].call(n,e,a)}),a};this.dblClickCanvas.onCircle({dotsCanvas:a})}}var o={dataDots:null,dots:null,radiusPath:null,onHover:{},onHoverKeys:[],onClick:{},onClickKeys:[],onDblClick:{},onDblClickKeys:[]};return{name:"dotSelectCanvas",onInit:function(){n.call(this)},onCreate:function(){this.dotsCanvas&&!o.dots&&this.dotSelectCanvas.dots(this.dotsCanvas.dots())},onHover:function(t){Object.assign(o.onHover,t),o.onHoverKeys=Object.keys(o.onHover)},onClick:function(t){Object.assign(o.onClick,t),o.onClickKeys=Object.keys(o.onClick)},onDblClick:function(t){Object.assign(o.onDblClick,t),o.onDblClickKeys=Object.keys(o.onDblClick)},dots:function(t){o.dots=t}}},w=function(){function t(){var t=this,o=function(o,e){e?(t.dotTooltipCanvas.onShow&&(e=t.dotTooltipCanvas.onShow.call(t,e,n)),t.dotTooltipCanvas.show(e.properties).style("display","block").style("opacity",1).style("left",o[0]+7+"px").style("top",o[1]-15+"px")):n.style("opacity",0).style("display","none")};this.dotSelectCanvas.onHover({dotTooltipCanvas:o})}var n=d3.select("body").append("div").attr("class","ej-dot-tooltip");return{name:"dotTooltipCanvas",onInit:function(){t.call(this)},show:function(t){var o=Object.keys(t).map(function(n){return n+": "+t[n]}).join("<br/>");return n.html(o)}}},m=function(){function t(){var t=this;if(this.hoverCanvas){var n=function(n,e){return o.onHoverKeys.forEach(function(r){o.onHover[r].call(t,n,e)}),e};this.hoverCanvas.onCountry({countrySelectCanvas:n})}if(this.clickCanvas){var e=function(n,e){return o.onClickKeys.forEach(function(r){o.onClick[r].call(t,n,e)}),e};this.clickCanvas.onCountry({countrySelectCanvas:e})}if(this.dblClickCanvas){var r=function(n,e){return o.onDblClickKeys.forEach(function(r){o.onDblClick[r].call(t,n,e)}),e};this.dblClickCanvas.onCountry({countrySelectCanvas:r})}}function n(){if(this.worldCanvas&&!o.countries){var t=this.worldCanvas.data(),n=t.world;n&&(o.countries=topojson.feature(n,n.objects.countries))}}var o={countries:null,onHover:{},onHoverKeys:[],onClick:{},onClickKeys:[],onDblClick:{},onDblClickKeys:[]};return{name:"countrySelectCanvas",onInit:function(){t.call(this)},onCreate:function(){n.call(this)},onHover:function(t){Object.assign(o.onHover,t),o.onHoverKeys=Object.keys(o.onHover)},onClick:function(t){Object.assign(o.onClick,t),o.onClickKeys=Object.keys(o.onClick)},onDblClick:function(t){Object.assign(o.onDblClick,t),o.onDblClickKeys=Object.keys(o.onDblClick)},world:function(t){o.countries=topojson.feature(t,t.objects.countries)}}},b=function(){function t(){var t=this,e=function(e,r){if(!t._.drag&&r&&t._.options.showCountryTooltip){var a=t.worldCanvas.countryName(r);!a||t.barTooltipSvg&&t.barTooltipSvg.visible()?o():n(e).style("display","block").style("opacity",1).text(a.name)}else o()};this.hoverCanvas.onCountry({countryTooltipCanvas:e}),this.mousePlugin&&this.mousePlugin.onDrag({countryTooltipCanvas:e}),this._.options.showCountryTooltip=!0}function n(t){return e.style("left",t[0]+7+"px").style("top",t[1]-15+"px")}function o(){e.style("opacity",0).style("display","none")}var e=d3.select("body").append("div").attr("class","ej-country-tooltip");return{name:"countryTooltipCanvas",onInit:function(){t.call(this)},onRefresh:function(){this._.drag&&n(this.mousePlugin.mouse())}}},j=function(){function t(){var t=this;this.worldSvg.$countries().on("mouseover",function(e){if(t._.options.showCountryTooltip){o.show=!0;var r=t.worldSvg.countryName.call(t,e);n().style("display","block").style("opacity",1).text(r.name)}}).on("mouseout",function(){o.show=!1,e.style("opacity",0).style("display","none")}).on("mousemove",function(){t._.options.showCountryTooltip&&n()})}function n(t){return t||(t=[d3.event.pageX,d3.event.pageY]),e.style("left",t[0]+7+"px").style("top",t[1]-15+"px")}var o={show:!1},e=d3.select("body").append("div").attr("class","ej-country-tooltip");return{name:"countryTooltipSvg",onInit:function(){this._.options.showCountryTooltip=!0},onCreate:function(){t.call(this)},onRefresh:function(){this._.drag&&o.show&&n(this.mousePlugin.mouse())}}};return n.plugins={configPlugin:o,autorotatePlugin:e,mousePlugin:r,zoomPlugin:a,threejsPlugin:i,canvasPlugin:s,hoverCanvas:l,clickCanvas:c,dblClickCanvas:u,oceanSvg:h,sphereSvg:d,graticuleCanvas:f,graticuleSvg:p,dropShadowSvg:v,fauxGlobeSvg:g,dotTooltipSvg:y,dotSelectCanvas:C,dotTooltipCanvas:w,countrySelectCanvas:m,countryTooltipCanvas:b,countryTooltipSvg:j,barTooltipSvg:function(){function t(){var t=this;this.barSvg.$bar().on("mouseover",function(){if(t._.options.showBarTooltip){e.visible=!0,e.mouseXY=[d3.event.pageX+7,d3.event.pageY-15];var o=+this.dataset.index,a=t.barSvg.data().features[o];t.barTooltipSvg.onShow&&(a=t.barTooltipSvg.onShow.call(this,a,r)),t.barTooltipSvg.show(a).style("display","block").style("opacity",1),n()}}).on("mouseout",function(){e.visible=!1,r.style("opacity",0).style("display","none")}).on("mousemove",function(){t._.options.showBarTooltip&&(e.mouseXY=[d3.event.pageX+7,d3.event.pageY-15],n())})}function n(){r.style("left",e.mouseXY[0]+7+"px").style("top",e.mouseXY[1]-15+"px")}function o(){t.call(this),r.style("opacity",0).style("display","none")}var e={mouseXY:[0,0],visible:!1},r=d3.select("body").append("div").attr("class","ej-bar-tooltip");return{name:"barTooltipSvg",onInit:function(){this._.options.showBarTooltip=!0},onCreate:function(){t.call(this)},onRefresh:function(){n.call(this)},onResize:function(){o.call(this)},show:function(t){var n=t.properties,o=Object.keys(n).map(function(t){return t+": "+n[t]}).join("<br/>");return r.html(o)},visible:function(){return e.visible}}},placesSvg:function(t,n){function o(){var t=this._;t.options.showPlaces=!0,l.svg=n?d3.selectAll(n):t.svg}function e(){l.svg.selectAll(".points,.labels").remove(),l.places&&this._.options.showPlaces&&(r.call(this),a.call(this),s.call(this))}function r(){c.placePoints=l.svg.append("g").attr("class","points").selectAll("path").data(l.places.features).enter().append("path").attr("class","point")}function a(){c.placeLabels=l.svg.append("g").attr("class","labels").selectAll("text").data(l.places.features).enter().append("text").attr("class","label").text(function(t){return t.properties.name})}function i(){var t=this,n=this._.proj.invert(this._.center);c.placeLabels.attr("text-anchor",function(n){var o=t._.proj(n.geometry.coordinates)[0];return o<t._.center[0]-20?"end":o<t._.center[0]+20?"middle":"start"}).attr("transform",function(n){var o=t._.proj(n.geometry.coordinates),e=o[0],r=o[1];return"translate("+(e+(e<t._.center[0]?-5:5))+","+(r-2)+")"}).style("display",function(t){return d3.geoDistance(t.geometry.coordinates,n)>1.57?"none":"inline"})}function s(){c.placePoints&&(c.placePoints.attr("d",this._.path),i.call(this))}var l={svg:null,q:null,places:null},c={};return{name:"placesSvg",urls:t&&[t],onReady:function(t,n){l.places=n},onInit:function(){o.call(this)},onCreate:function(){e.call(this)},onRefresh:function(){s.call(this)},data:function(t){if(!t)return{places:l.places};var n=t.placesSvg.data();l.places=n.places},selectAll:function(t){return t&&(l.q=t,l.svg=d3.selectAll(t)),l.svg},$placePoints:function(){return c.placePoints},$placeLabels:function(){return c.placeLabels}}},worldCanvas:function(t){function n(){var t=this._;l.world&&t.options.showLand&&((t.options.transparent||t.options.transparentLand)&&this.canvasPlugin.flipRender(function(t,n){t.beginPath(),n(l.land),t.fillStyle=l.style.backLand||"rgba(119,119,119,0.2)",t.fill()},l.drawTo,l.options),t.options.showCountries?e.call(this):o.call(this),t.drag||(t.options.showLakes&&r.call(this),this.hoverCanvas&&t.options.showSelectedCountry&&this.canvasPlugin.render(function(t,n){t.beginPath(),n(this.hoverCanvas.data().country),t.fillStyle="rgba(117, 0, 0, 0.4)",t.fill()},l.drawTo,l.options)))}function o(){this.canvasPlugin.render(function(t,n){var o=l.landColor;t.beginPath(),n(l.land),t.fillStyle=l.style.land||("number"==typeof o?s[o]:o),t.fill()},l.drawTo,l.options)}function e(){this.canvasPlugin.render(function(t,n){var o=l.landColor;t.beginPath(),n(l.countries),t.fillStyle=l.style.land||("number"==typeof o?s[o]:o),t.fill(),t.lineWidth=.1,t.strokeStyle=l.style.countries||"rgb(239, 237, 234)",t.stroke()},l.drawTo,l.options)}function r(){this.canvasPlugin.render(function(t,n){t.beginPath(),n(l.lakes),t.fillStyle=l.style.lakes||"rgba(80, 87, 97, 0.4)",t.fill()},l.drawTo,l.options)}var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=a.countryNameUrl,s={0:"rgba(117, 87, 57, 0.6)",1:"rgba(138, 96, 56, 0.6)",2:"rgba(140,104, 63, 0.6)",3:"rgba(149,114, 74, 0.6)",4:"rgba(153,126, 87, 0.6)",5:"rgba(155,141,115, 0.6)"},l={world:null,countryNames:null,style:{},drawTo:null,options:{},landColor:0},c=null
;return t&&(c=[t],i&&c.push(i)),{name:"worldCanvas",urls:c,onReady:function(t,n,o){this.worldCanvas.data({world:n,countryNames:o}),Object.defineProperty(this._.options,"landColor",{get:function(){return l.landColor},set:function(t){l.landColor=t}})},onInit:function(){var t=this._.options;t.showLand=!0,t.showLakes=!0,t.showCountries=!0,t.transparentLand=!1,t.landColor=0},onCreate:function(){var t=this;if(n.call(this),this.hoverCanvas){var o=function(){t._.options.spin||t._.refresh()};this.hoverCanvas.onCountry({worldCanvas:o})}},onRefresh:function(){n.call(this)},countries:function(){return l.countries.features},data:function(t){return t&&(l.world=t.world,l.countryNames=t.countryNames,l.land=topojson.feature(l.world,l.world.objects.land),l.lakes=topojson.feature(l.world,l.world.objects.ne_110m_lakes),l.countries=topojson.feature(l.world,l.world.objects.countries)),{world:l.world,countryNames:l.countryNames}},drawTo:function(t){l.drawTo=t},countryName:function(t){var n="";return l.countryNames&&(n=l.countryNames.find(function(n){return n.id==t.id})),n},style:function(t){return t&&(l.style=t),l.style},options:function(t){l.options=t}}},worldSvg:function(t){function n(){var t=this._;u.svg.selectAll(".landbg,.land,.lakes,.countries").remove(),t.options.showLand&&(u.world&&((t.options.transparent||t.options.transparentLand)&&u.svgAddWorldBg.call(this),!t.drag&&t.options.showCountries?u.svgAddCountries.call(this):u.svgAddWorld.call(this),!t.drag&&t.options.showLakes&&u.svgAddLakes.call(this)),o.call(this))}function o(){var t=this._;u.world&&t.options.showLand&&((t.options.transparent||t.options.transparentLand)&&(t.proj.clipAngle(180),h.worldBg.attr("d",t.path),t.proj.clipAngle(90)),t.options.showCountries?h.countries.attr("d",t.path):h.world.attr("d",t.path),t.options.showLakes&&h.lakes.attr("d",t.path))}function e(){h.worldBg=u.svg.append("g").attr("class","landbg").append("path").datum(u.land).attr("fill","rgba(119,119,119,0.2)")}function r(){h.world=u.svg.append("g").attr("class","land").append("path").datum(u.land)}function a(){h.countries=u.svg.append("g").attr("class","countries").selectAll("path").data(u.countries.features).enter().append("path").attr("id",function(t){return"x"+t.id})}function i(){h.lakes=u.svg.append("g").attr("class","lakes").append("path").datum(u.lakes)}var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=s.countryNameUrl,c=s.selectAll,u={svg:null,q:null,world:null,countryNames:null},h={},d=null;return t&&(d=[t],l&&d.push(l)),{name:"worldSvg",urls:d,onReady:function(t,n,o){this.worldSvg.data({world:n,countryNames:o})},onInit:function(){var t=this._,n=t.options;n.showLand=!0,n.showLakes=!0,n.showCountries=!0,n.transparentLand=!1,u.svgAddCountries=a,u.svgAddWorldBg=e,u.svgAddLakes=i,u.svgAddWorld=r,u.svg=c?d3.selectAll(c):t.svg},onCreate:function(){n.call(this)},onRefresh:function(){o.call(this)},countries:function(){return u.countries.features},data:function(t){return t&&(u.world=t.world,u.countryNames=t.countryNames,u.land=topojson.feature(u.world,u.world.objects.land),u.lakes=topojson.feature(u.world,u.world.objects.ne_110m_lakes),u.countries=topojson.feature(u.world,u.world.objects.countries)),{world:u.world,countryNames:u.countryNames}},countryName:function(t){var n="";return u.countryNames&&(n=u.countryNames.find(function(n){return n.id==t.id})),n},selectAll:function(t){return t&&(u.q=t,u.svg=d3.selectAll(t)),u.svg},$world:function(){return h.world},$lakes:function(){return h.lakes},$countries:function(){return h.countries}}},worldThreejs:function(){function t(){if(!r.sphereObject){var t=this,n=new THREE.Group;(new THREE.TextureLoader).load(e,function(e){var a=new THREE.SphereGeometry(200,30,30),i=new THREE.MeshBasicMaterial({map:e,overdraw:.5,opacity:0});i.opacity=1,r.sphereObject=new THREE.Mesh(a,i),n.add(r.sphereObject),o.call(t)}),t.threejsPlugin.addObject(n)}}function n(){var t=r.scale(this._.proj.scale()),n=r.sphereObject;n.scale.x=t,n.scale.y=t,n.scale.z=t}function o(){var t=this._.proj.rotate();t[0]-=90;var n=this._.versor(t),o=new THREE.Quaternion(-n[2],n[1],n[3],n[0]);r.sphereObject.setRotationFromQuaternion(o)}var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../d/world.png",r={sphereObject:null,scale:null};return r.scale=d3.scaleLinear().domain([0,200]).range([0,1]),{name:"worldThreejs",onInit:function(){t.call(this)},onResize:function(){n.call(this)},onRefresh:function(){r.sphereObject&&o.call(this)}}},centerCanvas:function(){function t(t,n){n=n.replace("x","");for(var o=0,e=t.length;o<e;o++)if(t[o].id==n)return t[o]}function n(t){var n=this._,o=d3.interpolate(n.proj.rotate(),[-t[0],-t[1],0]),e=function(t){return n.rotate(o(t))};d3.transition().duration(2500).tween("rotate",function(){return e})}function o(){var t=this;this.clickCanvas&&this.clickCanvas.onCountry({centerCanvas:function(o,r){r&&(n.call(t,d3.geoCentroid(r)),"function"==typeof e.focused&&e.focused.call(t))}})}var e={focused:null};return{name:"centerCanvas",onInit:function(){this._.options.enableCenter=!0},onCreate:function(){o.call(this)},go:function(o){var e=this.worldCanvas.countries(),r=t(e,o),a=d3.geoCentroid(r);n.call(this,a)},focused:function(t){e.focused=t}}},centerSvg:function(){function t(t,n){n=n.replace("x","");for(var o=0,e=t.length;o<e;o++)if(t[o].id==n)return t[o]}function n(t){var n=this._,o=d3.interpolate(n.proj.rotate(),[-t[0],-t[1],0]),e=function(t){return n.rotate(o(t))};d3.transition().duration(2500).tween("rotate",function(){return e})}function o(){var o=this;this.worldSvg.$countries().on("click",function(){if(o._.options.enableCenter){var r=this.id.replace("x",""),a=t(o.worldSvg.countries(),r);n.call(o,d3.geoCentroid(a)),"function"==typeof e.focused&&e.focused.call(o)}})}var e={focused:null,svgAddCountriesOld:null};return{name:"centerSvg",onInit:function(){this._.options.enableCenter=!0},onCreate:function(){o.call(this)},go:function(o){var e=this.worldSvg.countries(),r=t(e,o),a=d3.geoCentroid(r);n.call(this,a)},focused:function(t){e.focused=t}}},flattenPlugin:function(){function t(){var t=this._.proj,n=d3.geoEquirectangular().scale(this._.options.width/6.3).translate(this._.center);r.g1=t,r.g2=n}function n(){var t=this;return t._.svg.transition().duration(10500).tween("projection",function(){return function(o){n.alpha(o),t._.refresh()}})}function o(t,o){function e(n,e){var r=t([n*=180/Math.PI,e*=180/Math.PI]),i=o([n,e]);return[(1-a)*r[0]+a*i[0],(a-1)*r[1]-a*i[1]]}var r=d3.geoProjection(e).scale(1),a=void 0;return n.alpha=function(n){if(!arguments.length)return a;a=+n;var e=t.center(),i=o.center(),s=t.translate(),l=o.translate();return r.center([(1-a)*e[0]+a*i[0],(1-a)*e[1]+a*i[1]]),r.translate([(1-a)*s[0]+a*l[0],(1-a)*s[1]+a*l[1]]),r},n.alpha(0),r}function e(){var t=this._;return d3.transition().duration(1500).tween("rotate",function(){t.rotate(t.proj.rotate());var n=d3.interpolate(t.proj.rotate(),[0,0,0]);return function(o){t.rotate(n(o))}})}var r={};return{name:"flattenPlugin",onInit:function(){t.call(this)},toMap:function(){var t=this;e.call(this).on("end",function(){var e=o(r.g1,r.g2);t._.path=d3.geoPath().projection(e),n.call(t).on("end",function(){t._.options.enableCenter=!1})})},toGlobe:function(){var t=this;this._.rotate([0,0,0]);var e=o(r.g2,r.g1);this._.path=d3.geoPath().projection(e),n.call(this).on("end",function(){t._.path=d3.geoPath().projection(t._.proj),t._.options.enableCenter=!0,t._.refresh()})}}},barSvg:function(t){function n(){var t=this._;t.options.showBars=!0,s.barProjection=t.orthoGraphic(),s.svg=i?d3.selectAll(i):t.svg}function o(){var t=this._;if(r.call(this),s.svg.selectAll(".bar").remove(),s.bars&&t.options.showBars){var n=s.svg.append("g").attr("class","bar"),o=n.append("mask").attr("id","edge");o.append("rect").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").attr("fill","white"),o.append("use").attr("xlink:href","#edgeCircle").attr("fill","black"),s.max=d3.max(s.bars.features,function(t){return parseInt(t.geometry.value)});var a=t.proj.scale();s.lengthScale=d3.scaleLinear().domain([0,s.max]).range([a,a+50]),l.bar=n.selectAll("line").data(s.bars.features).enter().append("line").attr("stroke","red").attr("stroke-width","2").attr("data-index",function(t,n){return n}),e.call(this)}}function e(){var t=this._;if(s.bars&&t.options.showBars){var n=t.proj,o=s.lengthScale,e=s.barProjection,r=n.invert(t.center);e.rotate(this._.proj.rotate()),l.bar.each(function(t){var a=t.geometry.coordinates;e.scale(o(t.geometry.value));var i=d3.geoDistance(a,r),s=n(a),l=e(a);d3.select(this).attr("x1",s[0]).attr("y1",s[1]).attr("x2",l[0]).attr("y2",l[1]).attr("mask",i<1.57?null:"url(#edge)")})}}function r(){var t=this._;this.$slc.defs.selectAll("clipPath").remove(),this.$slc.defs.append("clipPath").append("circle").attr("id","edgeCircle").attr("cx",t.center[0]).attr("cy",t.center[1]).attr("r",t.proj.scale())}var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=a.selector,s={svg:null,barProjection:null,q:null,bars:null,valuePath:null},l={};return{name:"barSvg",urls:t&&[t],onReady:function(t,n){this.barSvg.data(n)},onInit:function(){n.call(this)},onCreate:function(){o.call(this)},onRefresh:function(){e.call(this)},onResize:function(){o.call(this)},selectAll:function(t){return t&&(s.q=t,s.svg=d3.selectAll(t)),s.svg},valuePath:function(t){s.valuePath=t},data:function(t){var n=this;if(!t)return s.bars;if(s.valuePath){var o=s.valuePath.split(".");t.features.forEach(function(t){var n=t;o.forEach(function(t){return n=n[t]}),t.geometry.value=n})}s.bars=t,setTimeout(function(){return e.call(n)},1)},$bar:function(){return l.bar}}},dotsSvg:function(t){function n(){var t=this._;t.options.showDots=!0,l.svg=i?d3.selectAll(i):t.svg}function o(){var t=this._;if(l.svg.selectAll(".dot").remove(),l.dataDots&&t.options.showDots){var n=[];if(l.circles.forEach(function(t){n.push(t.circle)}),c.dots=l.svg.append("g").attr("class","dot").selectAll("path").data(n).enter().append("path"),l.dataDots.geometry){var o=l.dataDots.geometry||{};c.dots.style("stroke-width",o.lineWidth||.2).style("fill",o.fillStyle||"rgba(100,0,0,.4)").style("stroke",o.strokeStyle||"rgba(119,119,119,.4)").attr("data-index",function(t,n){return n})}e.call(this)}}function e(){var t=this._,n=void 0,o=void 0;if(c.dots&&t.options.showDots){var e=l.dataDots.geometry||{};t.options.transparent||t.options.transparentDots?(t.proj.clipAngle(180),c.dots.style("fill",function(r,a){return n=r.coordinates[0][a],o=d3.geoDistance(n,t.proj.invert(t.center)),o>1.57?"none":e.fillStyle||"rgba(100,0,0,.4)"}),c.dots.style("display",function(){return t.drag&&!s?"none":"inline"}),c.dots.attr("d",t.path),t.proj.clipAngle(90)):(c.dots.style("display",function(e,r){return n=e.coordinates[0][r],o=d3.geoDistance(n,t.proj.invert(t.center)),o>1.57||t.drag&&!s?"none":"inline"}),c.dots.style("fill",e.fillStyle||"rgba(100,0,0,.4)"),c.dots.attr("d",t.path))}}function r(){var t=d3.geoCircle(),n=l.dataDots.geometry||{},o=n.radius||.5;l.circles=l.dataDots.features.map(function(n){var e=n.geometry.coordinates,r=n.properties,a=n.geometry.radius||o;return{properties:r,coordinates:e,circle:t.center(e).radius(a)()}})}var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=a.selectAll,s=a.important,l={dataDots:null,radiusPath:null},c={};return{name:"dotsSvg",urls:t&&[t],onReady:function(t,n){this.dotsSvg.data(n)},onInit:function(){n.call(this)},onCreate:function(){o.call(this)},onRefresh:function(){e.call(this)},radiusPath:function(t){l.radiusPath=t},data:function(t){var n=this;if(!t)return l.dataDots;if(l.radiusPath){var o=l.radiusPath.split("."),a=t.features.map(function(t){var n=t;return o.forEach(function(t){return n=n[t]}),n}).sort(),i=d3.scaleLinear().domain([a[0],a.pop()]).range([.5,2]);t.features.forEach(function(t){var n=t;o.forEach(function(t){return n=n[t]}),t.geometry.radius=i(n)})}l.dataDots=t,r(),setTimeout(function(){return e.call(n)},1)},selectAll:function(t){return t&&(l.q=t,l.svg=d3.selectAll(t)),l.svg},$dots:function(){return c.dots}}},pinCanvas:function(t,n){function o(t){this._.options.showPin=!0;var n=this._.proj.scale();i.w=d3.scaleLinear().domain([0,n]).range([0,t[0]]),i.h=d3.scaleLinear().domain([0,n]).range([0,t[1]]),r.call(this)}function e(){if(this._.options.showPin){var t=this._,n=t.proj.invert(t.center);this.canvasPlugin.render(function(o){i.dataPin.features.forEach(function(e){var r=e.geometry.coordinates;if(d3.geoDistance(r,n)<=1.57){var a=t.path.centroid(e);o.drawImage(i.image,a[0]-i.pX,a[1]-i.pY,i.wh[0],i.wh[1])}})},i.drawTo)}}function r(){var t=this._,n=t.proj.scale(),o=[i.w(n),i.h(n)];i.wh=o,i.pX=o[0]/2,i.pY=o[1]}var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[15,25],i={dataPin:null,image:null,w:null,h:null};return d3.select("body").append("img").attr("src",n).attr("id","pin").attr("width","0").attr("height","0"),i.image=document.getElementById("pin"),{name:"pinCanvas",urls:t&&[t],onReady:function(t,n){this.pinCanvas.data(n)},onInit:function(){o.call(this,a)},onCreate:function(){var t=this;setTimeout(function(){return e.call(t)},1)},onResize:function(){r.call(this)},onRefresh:function(){e.call(this)},data:function(t){if(!t)return i.dataPin;i.dataPin=t},drawTo:function(t){i.drawTo=t},image:function(){return i.image},size:function(t){if(!t)return i.wh;i.wh=t,o.call(this,t)}}},dotsCanvas:function(t){function n(){var t=this._;if((!t.drag||r)&&a.dataDots&&this._.options.showDots){var n=this._.proj,o=a.dataDots.geometry||{},e=n.invert(this._.center),i=[],s=[];a.dots.forEach(function(t){d3.geoDistance(t.coordinates,e)>1.57?i.push(t.circle):s.push(t.circle)}),(t.options.transparent||t.options.transparentDots)&&this.canvasPlugin.flipRender(function(t,n){t.beginPath(),n({type:"GeometryCollection",geometries:i}),t.lineWidth=.2,t.strokeStyle="rgba(119,119,119,.4)",t.stroke()},a.drawTo),this.canvasPlugin.render(function(t,n){t.beginPath(),n({type:"GeometryCollection",geometries:s}),t.lineWidth=o.lineWidth||.2,t.fillStyle=o.fillStyle||"rgba(100,0,0,.4)",t.strokeStyle=o.strokeStyle||"rgba(100,0,0,.6)",t.fill(),t.stroke()},a.drawTo)}}function o(){var t=d3.geoCircle(),n=a.dataDots.geometry||{},o=n.radius||.5;a.dots=a.dataDots.features.map(function(n){var e=n.geometry.coordinates,r=n.properties,a=n.geometry.radius||o;return{properties:r,coordinates:e,circle:t.center(e).radius(a)()}})}var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.important,a={dataDots:null,dots:[],radiusPath:null};return{name:"dotsCanvas",urls:t&&[t],onReady:function(t,n){this.dotsCanvas.data(n)},onInit:function(){this._.options.transparentDots=!1,this._.options.showDots=!0},onCreate:function(){n.call(this)},onRefresh:function(){(r||!0!==this._.drag)&&n.call(this)},radiusPath:function(t){a.radiusPath=t},data:function(t){var e=this;if(!t)return a.dataDots;if(a.radiusPath){var r=a.radiusPath.split("."),i=t.features.map(function(t){var n=t;return r.forEach(function(t){return n=n[t]}),n}).sort(),s=d3.scaleLinear().domain([i[0],i.pop()]).range([.5,2]);t.features.forEach(function(t){var n=t;r.forEach(function(t){return n=n[t]}),t.geometry.radius=s(n)})}a.dataDots=t,o(),setTimeout(function(){return n.call(e)},1)},drawTo:function(t){a.drawTo=t},dots:function(){return a.dots}}},pingsCanvas:function(){function t(){if(!this._.drag&&this._.options.showPings){var t=void 0,o=this._.proj;if(n.pings.length<=7){t=this._.proj.invert(this._.center);var e=n.dataPings.features.filter(function(n){return d3.geoDistance(n.geometry.coordinates,t)<=1.57}),r=e[Math.floor(Math.random()*(e.length-1))];n.pings.push({r:2.5,l:r.geometry.coordinates})}var a=n.pings[0];d3.geoDistance(a.l,this._.proj.invert(this._.center))>1.57?n.pings.shift():(this._.options.spin||this._.refresh(/anvas/),this.canvasPlugin.render(function(t){if(t.beginPath(),t.fillStyle="#F80",t.arc(o(a.l)[0],o(a.l)[1],a.r,0,2*Math.PI),t.fill(),t.closePath(),a.r=a.r+.2,a.r>5)n.pings.shift();else if(n.pings.length>1){var e=n.pings.shift();n.pings.push(e)}},n.drawTo))}}var n={dataPings:null,pings:[]};return{name:"pingsCanvas",onInit:function(){this._.options.showPings=!0},onInterval:function(){t.call(this)},data:function(t){n.dataPings=t},drawTo:function(t){n.drawTo=t}}},pingsSvg:function(t){function n(){var n=this,o=this._;o.options.showPings=!0,setInterval(function(){return e.call(n)},3e3),a.svg=t?d3.selectAll(t):o.svg}function o(){if(a.svg.selectAll(".pings").remove(),a.dataPings&&this._.options.showPings){var t=a.svg.append("g").attr("class","pings");i.ping2=t.selectAll(".ping-2").data(a.dataPings.features).enter().append("circle").attr("class","ping-2").attr("id",function(t,n){return"ping-"+n}),i.pings=t.selectAll(".ping-2"),r.call(this),e.call(this)}}function e(){var t=i.ping2.nodes().filter(function(t){return"inline"==t.style.display});t.length>0&&d3.select("#"+t[Math.floor(Math.random()*(t.length-1))].id).attr("r",2).attr("stroke","#F00").attr("stroke-opacity",1).attr("stroke-width","10px").transition().duration(1e3).attr("r",30).attr("fill","none").attr("stroke-width","0.1px")}function r(){if(null==this._.drag)i.pings.style("display","none");else if(!this._.drag&&i.pings&&this._.options.showPings){var t=this._.proj,n=this._.proj.invert(this._.center);i.pings.attr("cx",function(n){return t(n.geometry.coordinates)[0]}).attr("cy",function(n){return t(n.geometry.coordinates)[1]}).style("display",function(t){return d3.geoDistance(t.geometry.coordinates,n)>1.57?"none":"inline"})}}var a={svg:null,dataPings:null},i={};return{name:"pingsSvg",onInit:function(){n.call(this)},onCreate:function(){o.call(this)},onRefresh:function(){r.call(this)},data:function(t){a.dataPings=t},selectAll:function(t){return t&&(a.q=t,a.svg=d3.selectAll(t)),a.svg},$pings:function(){return i.pings}}},debugThreejs:function(){function t(){if(this._.options.showDebugSpahre=!0,!e.sphereObject){var t=this._.proj.scale(),n=new THREE.SphereGeometry(t,100,100),r=new THREE.MeshNormalMaterial({wireframe:!1}),a=new THREE.Mesh(n,r),i=new THREE.SphereGeometry(30,10,10),s=new THREE.SphereGeometry(30,10,10),l=new THREE.SphereGeometry(30,10,10);i.translate(0,0,t),s.translate(t,0,0),l.translate(0,-t,0);var c=new THREE.MeshBasicMaterial({color:"blue"}),u=new THREE.MeshBasicMaterial({color:"red"}),h=new THREE.MeshBasicMaterial({color:"green"}),d=new THREE.Mesh(i,c),f=new THREE.Mesh(s,u),p=new THREE.Mesh(l,h);e.sphereObject=new THREE.Object3D,e.sphereObject.add(a,d,f,p),o.call(this),this.threejsPlugin.addObject(e.sphereObject)}}function n(){var t=e.scale(this._.proj.scale()),n=e.sphereObject;n.scale.x=t,n.scale.y=t,n.scale.z=t}function o(){var t=this._.proj.rotate();t[0]-=90;var n=this._.versor(t),o=new THREE.Quaternion(-n[2],n[1],n[3],n[0]);e.sphereObject.setRotationFromQuaternion(o)}var e={sphereObject:null,scale:null};return e.scale=d3.scaleLinear().domain([0,200]).range([0,1]),{name:"debugThreejs",onInit:function(){t.call(this)},onResize:function(){n.call(this)},onRefresh:function(){e.sphereObject&&o.call(this)}}},commonPlugins:function(t){function n(){var n=this,o=this.register,e=earthjs.plugins;o(e.configPlugin()),o(e.autorotatePlugin(10)),o(e.mousePlugin()),o(e.dropShadowSvg()),o(e.oceanSvg()),o(e.canvasPlugin()),o(e.graticuleCanvas()),o(e.worldCanvas(t,{countryNameUrl:a})),this._.options.oceanColor=2,this._.options.transparent=!0,this.canvasPlugin.selectAll(".ej-canvas"),this.graticuleCanvas.drawTo([1]),this.worldCanvas.drawTo([0]),i.options=this.configPlugin.set(),i.buttonClick=function(t){var o=t.split(":"),e=o[2],r={},a=n.configPlugin.set();a[e]=!a[e],r[e]=a[e],"transparent"==e?((a.transparentGraticule||a.transparentLand)&&(r.transparent=!1),r.transparentGraticule=!1,r.transparentLand=!1):"showCountries"==e||"showLakes"==e?r.showLand=!0:"transparentGraticule"!=e&&"transparentLand"!=e||(a.transparent&&(r.transparentGraticule=!1,r.transparentLand=!1),r.transparent=!1),n.configPlugin.set(r)}}function o(t,n,o,e,r,a,i){t.append("br"),t.append("input").attr("id",n).attr("type","range").attr("min",o).attr("max",e).attr("step",r).attr("value",a).on("input",i)}function e(){var t=this,n=this,e=d3.select(".set-options"),r=d3.select(".set-options2");if(e.selectAll("button, input, br").remove(),r.selectAll("button, input, br").remove(),this._.options.showControll){e.selectAll("button").data(i.checker).enter().append("button").text(function(t){return t[1]}).on("click",function(n){return i.buttonClick.call(t,n.join(":"))}),o(r,"pan",0,400,1,i.pan,function(){i.pan=+this.value;for(var t=1;t<a.length;t++)a[t].style.left=i.pan*t+"px"}),o(r,"ocn",0,20,1,i.ocn,function(){i.ocn=this.value,n.oceanSvg.scale(-i.ocn)}),o(r,"spd",10,200,10,i.spd,function(){i.spd=this.value,n.autorotatePlugin.speed(i.spd)});var a=d3.selectAll(".ea-layer").nodes();window.nodes=a,o(r,"clr",0,5,1,n._.options.oceanColor,function(){n._.options.oceanColor=+this.value,n.oceanSvg.recreate()})}}var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.countryNameUrl,i={checker:[],ocn:0,spd:10,pan:0,clr:0};return i.checker=[":Shadow:showDropShadow",":Ocean:showOcean",":Graticule:showGraticule",":Land:showLand",":Country:showCountries",":Lakes:showLakes",":Transparent:transparent",":Canvas:showCanvas",":Spin:spin"].map(function(t){return t.split(":")}),{name:"commonPlugins",onInit:function(){n.call(this),this._.options.showControll=!0},onCreate:function(){e.call(this)},addChecker:function(t){i.checker.push(t),i.options=this.configPlugin.set(),e.call(this)}}}},n}();