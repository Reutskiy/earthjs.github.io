var earthjs=function(){"use strict";function t(t,e){(arguments.length<2||isNaN(parseFloat(e))||!isFinite(e)||e<0)&&(e=42),THREE.Geometry.call(this);var n,o=[];for(n=0;n<t.vertices.length;n+=2){var r=t.vertices[n],a=t.vertices[n+1],i=.01745329252*+(90-a),s=.01745329252*+(180-r),l=Math.sin(s)*Math.sin(i)*-1,c=Math.cos(s)*Math.sin(i),u=Math.cos(i),d=.25+r/360,h=.5+a/180;this.vertices.push(new THREE.Vector3(l,u,c)),o.push(new THREE.Vector2(d,h))}var f=this.vertices.length;if(e<=1)for(n=0;n<f;n++){var p=this.vertices[n];this.vertices.push(p.clone().multiplyScalar(e))}for(n=0;n<t.triangles.length;n+=3){var v=t.triangles[n],g=t.triangles[n+1],m=t.triangles[n+2];this.faces.push(new THREE.Face3(v,g,m,[this.vertices[v],this.vertices[g],this.vertices[m]])),this.faceVertexUvs[0].push([o[v],o[g],o[m]]),0<e&&e<=1&&(this.faces.push(new THREE.Face3(f+g,f+v,f+m,[this.vertices[g].clone().multiplyScalar(-1),this.vertices[v].clone().multiplyScalar(-1),this.vertices[m].clone().multiplyScalar(-1)])),this.faceVertexUvs[0].push([o[g],o[v],o[m]]))}if(e<1)for(n=0;n<t.polygons.length;n++)for(var y=t.polygons[n],w=0;w<y.length;w++)for(var b=y[w],j=0;j<b.length;j++){var C,v=b[j],g=b[(j+1)%b.length],E=this.vertices[v],_=this.vertices[g],x=this.vertices[f+v];w<1?(C=_.clone().sub(E).cross(x.clone().sub(E)).normalize(),this.faces.push(new THREE.Face3(v,g,f+v,[C,C,C])),this.faceVertexUvs[0].push([o[v],o[g],o[v]]),e>0&&(this.faces.push(new THREE.Face3(g,f+g,f+v,[C,C,C])),this.faceVertexUvs[0].push([o[g],o[g],o[v]]))):(C=x.clone().sub(E).cross(_.clone().sub(E)).normalize(),this.faces.push(new THREE.Face3(g,v,f+v,[C,C,C])),this.faceVertexUvs[0].push([o[g],o[v],o[v]]),e>0&&(this.faces.push(new THREE.Face3(g,f+v,f+g,[C,C,C])),this.faceVertexUvs[0].push([o[g],o[v],o[g]])))}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,1)}var e=function(){function t(t){var e=t[0]/2*h,n=u(e),o=i(e),r=t[1]/2*h,a=u(r),s=i(r),l=t[2]/2*h,c=u(l),d=i(l);return[o*s*d+n*a*c,n*s*d-o*a*c,o*a*d+n*s*c,o*s*c-n*a*d]}function e(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function n(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}var o=Math.acos,r=Math.asin,a=Math.atan2,i=Math.cos,s=Math.max,l=Math.min,c=Math.PI,u=Math.sin,d=Math.sqrt,h=c/180,f=180/c;return t.cartesian=function(t){var e=t[0]*h,n=t[1]*h,o=i(n);return[o*i(e),o*u(e),u(n)]},t.rotation=function(t){return[a(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*f,r(s(-1,l(1,2*(t[0]*t[2]-t[3]*t[1]))))*f,a(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*f]},t.delta=function(t,r){var a=e(t,r),c=d(n(a,a));if(!c)return[1,0,0,0];var h=o(s(-1,l(1,n(t,r))))/2,f=u(h);return[i(h),a[2]/c*f,-a[1]/c*f,a[0]/c*f]},t.multiply=function(t,e){return[t[0]*e[0]-t[1]*e[1]-t[2]*e[2]-t[3]*e[3],t[0]*e[1]+t[1]*e[0]+t[2]*e[3]-t[3]*e[2],t[0]*e[2]-t[1]*e[3]+t[2]*e[0]+t[3]*e[1],t[0]*e[3]+t[1]*e[2]-t[2]*e[1]+t[3]*e[0]]},t}(),n=function t(){function n(t,e,n){a[e][n]=t[e],a[e+"Keys"]=Object.keys(a[e]),a[e+"Vals"]=a[e+"Keys"].map(function(t){return a[e][t]})}function o(t,e,o){t[e]&&(u[o].__on__[e]=t[e],n(t,e,o))}var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};cancelAnimationFrame(t.ticker),r=Object.assign({svgCanvasSelector:".ej-svg,.ej-canvas",selector:"#earth-js",rotate:[130,-33,-11],transparent:!1,map:!1,padding:0},r);var a={onCreate:{},onCreateVals:[],onRefresh:{},onRefreshVals:[],onResize:{},onResizeVals:[],onInterval:{},onIntervalVals:[],ready:null,promeses:[],loadingData:null,recreateSvgOrCanvas:function(){return a.onCreateVals.forEach(function(t){t.call(u)}),u}};window._=a;var i=d3.selectAll(r.selector),s=+i.attr("width"),l=+i.attr("height");s&&l||(s=r.width||700,l=r.height||500,i.attr("width",s).attr("height",l)),d3.selectAll(r.svgCanvasSelector).attr("width",s).attr("height",l);var c=[s/2,l/2];Object.defineProperty(r,"width",{get:function(){return s},set:function(t){s=t,c[0]=t/2}}),Object.defineProperty(r,"height",{get:function(){return l},set:function(t){l=t,c[1]=t/2}});var u={_:{svg:i,drag:!1,versor:e,center:c,options:r},$slc:{},ready:function(t){if(t){if(u._.readyFn=t,u._.promeses=a.promeses,a.promeses.length>0){var e=d3.queue();a.loadingData=!0,a.promeses.forEach(function(t){t.urls.forEach(function(t){var n=t.split(".").pop();"geojson"===n&&(n="json"),e.defer(d3[n],t)})}),e.await(function(){var e=[].slice.call(arguments),n=e.shift();a.promeses.forEach(function(t){var o=t.urls.length,r=e.slice(0,o),a=u[t.name].ready;r.unshift(n),a?a.apply(u,r):t.onReady.apply(u,r),e=e.slice(o)}),a.loadingData=!1,t.called=!0,t.call(u)})}}else if(0===arguments.length)return a.loadingData},register:function(t,e){var n={name:e||t.name,__on__:{}};return u[n.name]=n,Object.keys(t).forEach(function(e){-1===["urls","onReady","onInit","onCreate","onRefresh","onResize","onInterval"].indexOf(e)&&"function"==typeof t[e]&&(n[e]=function(){return t[e].apply(u,arguments)})}),t.onInit&&t.onInit.call(u,n),o(t,"onCreate",n.name),o(t,"onResize",n.name),o(t,"onRefresh",n.name),o(t,"onInterval",n.name),t.urls&&t.onReady&&a.promeses.push({name:n.name,urls:t.urls,onReady:t.onReady}),u}};Object.defineProperty(u,"loading",{get:function(){return a.loadingData}});var d=[],h=u._;return u.create=function(t){return d=t||[],a.recreateSvgOrCanvas(),d.forEach(function(t){t.create(null)}),d!==[]&&h.ticker(),u},u.$slc.defs=h.svg.append("defs"),h.ticker=function(e){function n(s){if(s-r>e&&(r=s,!a.loadingData&&(o.call(u,s),s-i>e+30))){i=s;var l=!0,c=!1,f=void 0;try{for(var p,v=d[Symbol.iterator]();!(l=(p=v.next()).done);l=!0){var g=p.value;g._.interval.call(g,s)}}catch(t){c=!0,f=t}finally{try{!l&&v.return&&v.return()}finally{if(c)throw f}}}h.options.tween&&!h.drag&&h.options.tween(s),t.ticker=requestAnimationFrame(n)}var o=h.interval;e=e||10;var r=0,i=0;return t.ticker=requestAnimationFrame(n),u},h.scale=function(t){return h.proj.scale(t),h.resize(),h.refresh(),u},h.rotate=function(t){return h.proj.rotate(t),h.refresh(),u},h.interval=function(t){var e=!0,n=!1,o=void 0;try{for(var r,i=a.onIntervalVals[Symbol.iterator]();!(e=(r=i.next()).done);e=!0)r.value.call(u,t)}catch(t){n=!0,o=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw o}}return u},h.refresh=function(t){if(t)(t?a.onRefreshKeys.filter(function(e){return t.test(e)}):a.onRefreshKeys).forEach(function(t){a.onRefresh[t].call(u)});else{var e=!0,n=!1,o=void 0;try{for(var r,i=a.onRefreshVals[Symbol.iterator]();!(e=(r=i.next()).done);e=!0)r.value.call(u)}catch(t){n=!0,o=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw o}}}return u},h.resize=function(){var t=!0,e=!1,n=void 0;try{for(var o,r=a.onResizeVals[Symbol.iterator]();!(t=(o=r.next()).done);t=!0)o.value.call(u)}catch(t){e=!0,n=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw n}}return u},h.projection=function(){var t=h.options,e=t.scale,n=t.width,o=t.height,r=t.padding;if(h.options.map)return e||(e=n/6.279-r),d3.geoEquirectangular().translate(h.center).precision(.1).scale(e);e||(e=d3.min([n,o])/2-r);var a=h.options.rotate;return"number"==typeof a&&(h.options.rotate=[a,-33,-11]),d3.geoOrthographic().rotate(h.options.rotate).translate(h.center).precision(.1).clipAngle(90).scale(e)},h.proj=h.projection(),h.path=d3.geoPath().projection(h.proj),u.__addEventQueue=function(t){var e=u[t].__on__;e&&Object.keys(e).forEach(function(o){return n(e,o,t)})},u.__removeEventQueue=function(t){var e=u[t].__on__;e&&Object.keys(e).forEach(function(e){delete a[e][t],a[e+"Keys"]=Object.keys(a[e]),a[e+"Vals"]=a[e+"Keys"].map(function(t){return a[e][t]})})},u};void 0===window.d3&&(window.d3={}),window.d3.earthjs=n;var o=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)};window.THREE&&(t.prototype=Object.create(THREE.Geometry.prototype));return n.plugins={baseCsv:function(t){var e={data:null};return{name:"baseCsv",urls:t&&[t],onReady:function(t,n){e.me.data(n)},onInit:function(t){e.me=t},data:function(t){if(!t)return e.data;e.data=t},message:function(t){e.data=e.data.map(t)},allData:function(t){if(!t)return{data:e.data};e.data=t.data}}},baseGeoJson:function(t){var e={data:null};return{name:"baseGeoJson",urls:t&&[t],onReady:function(t,n){e.me.data(n)},onInit:function(t){e.me=t},data:function(t){if(!t)return e.data;e.data=t},message:function(t){e.data=e.data.map(t)},allData:function(t){if(!t)return{data:e.data};e.data=t.data}}},worldJson:function(t){var e={world:null,land:null,lakes:{type:"FeatureCollection",features:[]},selected:{type:"FeatureCollection",features:[]},countries:{type:"FeatureCollection",features:[]}};return{name:"worldJson",urls:t&&[t],onReady:function(t,n){e.me.data(n)},onInit:function(t){e.me=t},data:function(t){if(!t)return e.world;e.world=t,e.land=topojson.feature(t,t.objects.land),e.lakes.features=topojson.feature(t,t.objects.ne_110m_lakes).features,e.countries.features=topojson.feature(t,t.objects.countries).features},allData:function(t){if(!t)return{world:e.world,land:e.land,lakes:e.lakes,countries:e.countries};e.world=t.world,e.land=t.land,e.lakes=t.lakes,e.countries=t.countries},countries:function(t){if(!t)return e.countries.features;e.countries.features=t}}},choroplethCsv:function(t){function e(t){var e=this;return t.split(".").forEach(function(t){return e=e[t]}),e}function n(t,e){var n=void 0,o=void 0,r=this;t.split(".").forEach(function(t){n=r,o=t,r=r[t]}),n[o]=e}var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"schemeReds",a={cid:null,data:null,color:null,selectedColorId:null,selectedCountryId:null,countries:{type:"FeatureCollection",features:[]}};return{name:"choroplethCsv",urls:t&&[t],onReady:function(t,e){a.me.data(e)},onInit:function(t){a.me=t},data:function(t){if(!t)return a.data;a.data=t,a.data.getPath=e,a.data.updatePath=n},mergeData:function(t,o){var r=a.data,i=o[0].split(":"),s=o[1].split(":");t.features.forEach(function(t){var o=r.find(function(n){return e.call(t,i[0])===e.call(n,i[1])});if(o){var a=e.call(o,s[1]);n.call(t,s[0],a)}})},colorize:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r,n=arguments[2],i=void 0,s=d3[e][9];if(arguments.length>1){var l=a.data.map(function(e){return+e[t]});l=[].concat(o(new Set(l)));var c=[1,8];a.scheme=e,a.minMax=d3.extent(l),a.range=d3.range.apply(d3,c),a.scale=d3.scaleLinear().domain(a.minMax).rangeRound(c),a.color=d3.scaleThreshold().domain(a.range).range(s),a.colorValues=s.map(function(t,e){return i=Math.floor(a.scale.invert(e+1.45)),{id:e,color:t,value:i,totalValue:0}}),a.data.forEach(function(e){var o=+e[t],r=a.scale(o);if(void 0===n)e.color=a.color(r);else{var i=d3.color(a.color(r));i.opacity=n,e.color=i+""}e.colorId=r-1,a.colorValues[e.colorId].totalValue+=o})}return a.colorValues},colorScale:function(t){return void 0!==t?a.color(a.scale(+t)):{color:a.color,scale:a.scale,minMax:a.minMax}},setCss:function(t,e){var n=void 0;void 0===e&&null!==a.selectedColorId&&(e=a.selectedColorId);var o=a.data.map(function(t){return n=void 0===e||e===t.colorId||e===t.cid?"opacity:1;fill:"+t.color+";stroke:black":"",".countries path.cid-"+t.cid+" {"+n+";}"});t&&(a.targetCss=t),d3.select(a.targetCss).text(o.join("\n"))},setColorcountries:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"body",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".1f",o=a.me.countries(),r=d3.format(n);d3.select(e+" .color-countries").remove();var i=d3.select(e).append("div").attr("class","color-countries");i.append("div").attr("class","color-countries-title");var s=o.filter(function(e){var n=e.properties.value;return a.scale(n)-1===t});s.sort(function(t,e){return e.properties.value-t.properties.value}),i.selectAll("div.color-countries-item").data(s).enter().append("div").attr("data-cid",function(t){return t.properties.cid}).attr("class",function(t){var e=t.properties.cid===a.cid?"selected":"";return"color-countries-item cid-"+t.properties.cid+" "+e}).html(function(t){var e=t.properties,n=e.cid,o=e.name,a=e.value;return o+": "+r(a)+" - "+(n||"&nbsp;-&nbsp;")}),i.on("mouseover",function(){a.me.setCss(a.targetCss,d3.event.target.dataset.cid)}).on("mouseout",function(){a.me.setCss(a.targetCss)})},setColorRange:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"body",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".1f",n=a.me.colorize(),o=d3.format(e);n.sort(function(t,e){return e.value-t.value}),d3.select(t+" .color-range").remove();var r=d3.select(t).append("div").attr("class","color-range");r.append("div").attr("class","color-range-title");var i=n.filter(function(t){return 0!==t.totalValue});a.colorItems=r.selectAll("div.color-range-item").data(i).enter().append("div").attr("class",function(t){return"color-range-item s-"+t.id}).style("background",function(t){return t.color}).text(function(t){return o(t.totalValue)}),a.colorItems.on("click",function(t){a.me.setSelectedColor(t.id)}).on("mouseover",function(t){a.me.setCss(a.targetCss,t.id),a.me.setColorcountries(t.id)}).on("mouseout",function(){a.me.setCss(a.targetCss),null===a.selectedColorId?a.me.setColorcountries(-2):a.me.setColorcountries(a.selectedColorId)})},setSelectedColor:function(t){a.colorItems.classed("selected",!1),a.selectedColorId!==t?a.colorItems.filter(".s-"+t).classed("selected",!0):t=null,a.selectedColorId=t,a.me.setColorcountries(t),a.me.setCss(a.targetCss)},countries:function(t){if(!t)return a.countries.features;a.countries.features=t},cid:function(t){a.cid=t}}},countryNamesCsv:function(t){var e={countryNames:null};return{name:"countryNamesCsv",urls:t&&[t],onReady:function(t,n){e.me.data(n)},onInit:function(t){e.me=t},data:function(t){if(!t)return e.countryNames;e.countryNames=t},mergeData:function(t,n){var o=e.countryNames,r=n[0].split(":"),a=n[1].split(":");t.features.forEach(function(t){var e=o.find(function(e){return""+t[r[0]]===e[r[1]]});e&&(t[a[0]]=e[a[1]])})}}},colorScale:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[d3.rgb("#FFAAFF"),d3.rgb("#FF0000")],n={};return{name:"colorScale",onInit:function(e){n.me=e,n.me.data(t)},data:function(t){n.mnMax=d3.extent(t),n.color=d3.scaleLinear().domain(n.mnMax).interpolate(d3.interpolateHcl).range(e)},color:function(t){return n.color(t)},colors:function(t){return t.map(function(t){return n.color(t)})},colorScale:function(t){for(var e=0,o=[[0,n.me.color(0)]],r=n.mnMax[1]/t,a=0;a<t;a++)e+=r,o.push([e,n.me.color(e)]);return o},colorRange:function(t){if(!t)return e;e=t}}},dotRegion:function(t){function e(t){return t.split(",").reduce(function(t,e){return 256*+t+ +e})}function n(t){for(var e=t%256,n=2;n>0;n--)e=(t=Math.floor(t/256))%256+","+e;return e}function o(){var t=[800,400];i.canvas=d3.select("body").append("canvas").attr("class","ej-hidden").attr("width",1600).attr("height",800).node(),i.context=i.canvas.getContext("2d"),i.proj=d3.geoEquirectangular().translate(t).scale(t[1]/1.2),i.path=d3.geoPath().projection(i.proj).context(i.context)}function r(){if(i.recreate){i.recreate=!1,i.context.clearRect(0,0,1024,512);for(var t=i.dataDots.features,e=0;e<t.length;e++){i.context.beginPath();var o=i.proj(t[e].geometry.coordinates);i.context.arc(o[0],o[1],a,0,2*Math.PI),i.context.fillStyle="rgb("+n(e+2)+")",i.context.fill()}}}var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1.5,i={recreate:!0};return{name:"dotRegion",urls:t&&[t],onReady:function(t,e){i.me.data(e)},onInit:function(t){i.me=t,o.call(this)},onCreate:function(){r.call(this)},data:function(t){if(!t)return i.dataDots;i.dataDots=t},detect:function(t){var n=i.proj(t);if(n[0]>0){var o=i.context.getImageData(n[0],n[1],1,1).data,r=i.dataDots.features[e(o.slice(0,3).join(","))-2];if(r){var a=r.geometry.coordinates;if(Math.floor(a[0])===Math.floor(t[0])&&Math.floor(a[1])===Math.floor(t[1]))return r}}}}},hoverCanvas:function(){function t(){if(this.worldCanvas){var t=this.worldCanvas.data();t&&(n.world=t,n.countries=topojson.feature(t,t.objects.countries))}var o=this._,r=this;n.hoverHandler=function(){var t=this,a=d3.event;if(!o.drag&&a){a.sourceEvent&&(a=a.sourceEvent);var i=[a.clientX,a.clientY],s=o.proj.invert(d3.mouse(this));n.pos=s,n.dot=null,n.mouse=i,n.country=null,o.options.showDots&&n.onCircleVals.forEach(function(e){n.dot=e.call(t,a,s)}),o.options.showLand&&n.countries&&!n.dot&&(o.drag||(r.countryCanvas?n.country=r.countryCanvas.detectCountry(s):n.country=e(s),n.ocountry!==n.country&&r.canvasThreejs&&(n.ocountry=n.country,r.canvasThreejs.refresh())),n.onCountryVals.forEach(function(e){e.tooltips?e.call(t,a,n.country):n.ocountry2!==n.country&&e.call(t,a,n.country)}),n.ocountry2=n.country)}},n.svg.on("mousemove",n.hoverHandler),this.mousePlugin&&this.mousePlugin.onDrag({hoverCanvas:n.hoverHandler})}function e(t){return n.countries.features.find(function(e){return e.geometry.coordinates.find(function(e){return d3.polygonContains(e,t)||e.find(function(e){return d3.polygonContains(e,t)})})})}var n={svg:null,mouse:null,country:null,ocountry:null,countries:null,hoverHandler:null,onCircle:{},onCircleVals:[],onCountry:{},onCountryVals:[]};return{name:"hoverCanvas",onInit:function(e){n.me=e,n.svg=this._.svg,this._.options.showSelectedCountry=!1,t.call(this)},selectAll:function(e){return e&&(n.q=e,n.svg.on("mousemove",null),n.svg=d3.selectAll(e),t.call(this)),n.svg},onCreate:function(){this.worldJson&&!n.world&&n.me.data(this.worldJson.data())},onCircle:function(t){Object.assign(n.onCircle,t),n.onCircleVals=Object.keys(n.onCircle).map(function(t){return n.onCircle[t]})},onCountry:function(t){Object.assign(n.onCountry,t),n.onCountryVals=Object.keys(n.onCountry).map(function(t){return n.onCountry[t]})},data:function(t){if(!t)return n.world;n.world=t,n.countries=topojson.feature(t,t.objects.countries)},allData:function(t){if(!t)return{world:n.world,countries:n.countries};n.world=t.world,n.countries=t.countries},states:function(){return{pos:n.pos,dot:n.dot,mouse:n.mouse,country:n.country}},registerMouseDrag:function(){this.mousePlugin.onDrag({hoverCanvas:n.hoverHandler})}}},clickCanvas:function(){function t(){if(this.worldCanvas){var t=this.worldCanvas.data();t&&(n.world=t,n.countries=topojson.feature(t,t.objects.countries))}var o=this._,r=this;this.mousePlugin&&this.mousePlugin.onClick({clickCanvas:function(t,a){var i=this;if(t){t.sourceEvent&&(t=t.sourceEvent);var s=[t.clientX,t.clientY],l=o.proj.invert(a);n.pos=l,n.dot=null,n.mouse=s,n.country=null,o.options.showDots&&n.onCircleVals.forEach(function(e){n.dot=e.call(i,t,l)}),o.options.showLand&&!n.dot&&(o.drag||(r.countryCanvas?n.country=r.countryCanvas.detectCountry(l):n.country=e(l)),n.onCountryVals.forEach(function(e){e.call(i,t,n.country)}))}}}),o.options.showLand=!0}function e(t){return n.countries.features.find(function(e){return e.geometry.coordinates.find(function(e){return d3.polygonContains(e,t)||e.find(function(e){return d3.polygonContains(e,t)})})})}var n={mouse:null,country:null,countries:null,onCircle:{},onCircleVals:[],onCountry:{},onCountryVals:[]};return{name:"clickCanvas",onInit:function(e){n.me=e,t.call(this)},onCreate:function(){this.worldJson&&!n.world&&n.me.data(this.worldJson.data())},onCircle:function(t){Object.assign(n.onCircle,t),n.onCircleVals=Object.keys(n.onCircle).map(function(t){return n.onCircle[t]})},onCountry:function(t){Object.assign(n.onCountry,t),n.onCountryVals=Object.keys(n.onCountry).map(function(t){return n.onCountry[t]})},data:function(t){if(!t)return n.world;n.world=t,n.countries=topojson.feature(t,t.objects.countries)},allData:function(t){if(!t)return{world:n.world,countries:n.countries};n.world=t.world,n.countries=t.countries},state:function(){return{pos:n.pos,dot:n.dot,mouse:n.mouse,country:n.country}}}},mousePlugin:function(){function t(){c.onClickVals.forEach(function(t){t.call(c._this,c.event,c.mouse)})}function e(){c.onDblClickVals.forEach(function(t){t.call(c._this,c.event,c.mouse)})}function n(t){var e=t.versor,n=e.cartesian(t.proj.rotate(d).invert(c.mouse)),o=e.multiply(h,e.delta(u,n));c.r=e.rotation(o)}function o(t){var e=this;n(t),t.rotate(c.r),c.onDragVals.forEach(function(t){t.call(e,c.mouse)})}function r(){function r(t){var e=t[0]-d[0];t[0]=e+this._.proj.rotate()[0],t[0]>=180&&(t[0]-=360),this._.rotate(t)}var a=this._,i=a.versor,f=a.proj.scale(),p=[a.options.width,a.options.height];c.scale=d3.scaleLinear().domain([30,a.proj.scale()]).range([.1,1]),c.zoom=d3.zoom().on("zoom",function(){var t=s,e=f*d3.event.transform.k;e>=t[0]&&e<=t[1]&&(a.scale(e),c.sync.forEach(function(t){return t._.scale(e)}))}).scaleExtent([.1,160]).translateExtent([[0,0],p]),c.svg.call(d3.drag().filter(function(){var t=d3.event.touches;return void 0===t||1===t.length}).on("start",function(){var t=this,e=d3.mouse(this);u=i.cartesian(a.proj.invert(e)),d=a.proj.rotate(),h=i(d),a.drag=null,c.onDragStartVals.forEach(function(n){return n.call(t,e)}),c.onDragVals.forEach(function(n){return n.call(t,e)}),a.refresh(),c.mouse=e,c._this=this,c.t1=0,c.t2=0}).on("end",function(){var o=this,i=a.drag;a.drag=!1,null===i?(c.event=d3.event,a.options.spin?t():c.wait?(c.wait=null,e()):null===c.wait&&(c.wait=setTimeout(function(){c.wait&&(c.wait=!1)},250))):i&&(n(a),a.rotate(c.r),c.onDragVals.forEach(function(t){return t.call(c._this,c.mouse)}),c.sync.forEach(function(t){return r.call(t,c.r)})),c.onDragEndVals.forEach(function(t){return t.call(o,c.mouse)}),a.refresh()}).on("drag",function(){a.drag=!0,c._this=this,c.mouse=d3.mouse(this),!l&&o(a)})),c.svg.call(c.zoom)}function a(){var e=this._;e.drag&&l?c.oMouse[0]!==c.mouse[0]&&c.oMouse[1]!==c.mouse[1]&&(c.oMouse=c.mouse,o(e)):!1===c.wait&&(c.wait=null,t())}var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{zoomScale:[0,5e4]},s=i.zoomScale,l=i.intervalDrag,c={svg:null,wait:null,zoom:null,mouse:null,q:null,sync:[],onDrag:{},onDragVals:[],onDragStart:{},onDragStartVals:[],onDragEnd:{},onDragEndVals:[],onClick:{},onClickVals:[],onDblClick:{},onDblClickVals:[]};window._mouse=c,void 0===s&&(s=[0,5e4]);var u=void 0,d=void 0,h=void 0;return{name:"mousePlugin",onInit:function(t){c.me=t,c.oMouse=[],c.svg=this._.svg,r.call(this)},onInterval:function(){a.call(this)},selectAll:function(t){return t&&(c.q=t,c.svg.call(d3.zoom().on("zoom start end",null)),c.svg.call(d3.drag().on("start",null).on("end",null).on("drag",null)),c.svg=d3.selectAll(t),r.call(this),this.hoverCanvas&&this.hoverCanvas.selectAll(t)),c.svg},sync:function(t){c.sync=t},zoom:function(t){c.zoom.scaleTo(c.svg,t?c.scale(t):1)},mouse:function(){return c.mouse},onDrag:function(t){Object.assign(c.onDrag,t),c.onDragVals=Object.keys(c.onDrag).map(function(t){return c.onDrag[t]})},onDragStart:function(t){Object.assign(c.onDragStart,t),c.onDragStartVals=Object.keys(c.onDragStart).map(function(t){return c.onDragStart[t]})},onDragEnd:function(t){Object.assign(c.onDragEnd,t),c.onDragEndVals=Object.keys(c.onDragEnd).map(function(t){return c.onDragEnd[t]})},onClick:function(t){Object.assign(c.onClick,t),c.onClickVals=Object.keys(c.onClick).map(function(t){return c.onClick[t]})},onDblClick:function(t){Object.assign(c.onDblClick,t),c.onDblClickVals=Object.keys(c.onDblClick).map(function(t){return c.onDblClick[t]})}}},configPlugin:function(){return{name:"configPlugin",set:function(t){if(t){if(Object.assign(this._.options,t),void 0!==t.spin){var e=this.autorotatePlugin;t.spin?e.start():e.stop()}this.create()}return Object.assign({},this._.options)}}},canvasPlugin:function(){function t(){var t=this._;t.options.showCanvas=!0,o.path=d3.geoPath().projection(t.proj)}function e(){var t=this._;if(t.options.showCanvas){if(!o.canvas){r.g=t.svg.append("g").attr("class",o.me.name);var e=r.g.append("foreignObject").attr("x",0).attr("y",0).attr("width",t.options.width).attr("height",t.options.height).append("xhtml:body").style("margin","0px").style("padding","0px").style("background-color","none").style("width",t.options.width+"px").style("height",t.options.height+"px");o.canvas=e.append("canvas")}o.canvas.attr("x",0).attr("y",0).attr("width",t.options.width).attr("height",t.options.height)}o.canvas&&n.call(this)}function n(){var t=this._.options,e=t.width,n=t.height;o.canvas.each(function(){this.getContext("2d").clearRect(0,0,e,n)})}var o={canvas:null,path:null,q:null},r={};return{name:"canvasPlugin",onInit:function(e){o.me=e,t.call(this)},onCreate:function(){e.call(this)},onRefresh:function(){n.call(this)},selectAll:function(t){return t&&(o.q=t,o.canvas=d3.selectAll(t)),o.canvas},render:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=this._;if(r.options.showCanvas){var a=!1,i=r.proj,s=i.rotate(),l=this;o.canvas.each(function(r,c){if(!e||e.indexOf(c)>-1){var u=n[c]||{};u.rotate?(a=!0,i.rotate([s[0]+u.rotate,s[1],s[2]])):a&&(a=!1,i.rotate(s));var d=this.getContext("2d");t.call(l,d,o.path.context(d))}}),a&&(a=!1,i.rotate(s))}},flipRender:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=this._,a=r.center[0],i=r.proj.rotate();o.me.render(function(e,n){e.save(),e.translate(a,0),e.scale(-1,1),e.translate(-a,0),r.proj.rotate([i[0]+180,-i[1],-i[2]]),t.call(this,e,n),e.restore(),r.proj.rotate(i)},e,n)}}},countryCanvas:function(t){function e(){o.canvas=d3.select("body").append("canvas").attr("class","ej-hidden").attr("width","1024").attr("height","512").node(),o.context=o.canvas.getContext("2d"),o.proj=d3.geoEquirectangular().precision(.5).translate([512,256]).scale(163),o.path=d3.geoPath().projection(o.proj).context(o.context)}function n(){if(o.recreate){o.recreate=!1,o.context.clearRect(0,0,1024,512);for(var t=o.countries.features.length;t--;)o.context.beginPath(),o.path(o.countries.features[t]),o.context.fillStyle="rgb("+(t+1)+",0,0)",o.context.fill()}}var o={recreate:!0};return{name:"countryCanvas",urls:t&&[t],onReady:function(t,e){o.me.data(e)},onInit:function(t){o.me=t,e.call(this)},onCreate:function(){this.worldJson&&!o.world&&o.me.data(this.worldJson.data()),n.call(this)},data:function(t){if(!t)return o.world;o.world=t,o.countries=topojson.feature(t,t.objects.countries)},allData:function(t){if(!t)return{world:o.world,countries:o.countries};o.world=t.world,o.countries=t.countries},detectCountry:function(t){var e=o.proj(t);if(e[0]>0){var n=o.context.getImageData(e[0],e[1],1,1).data;return o.countries.features[n[0]-1]}}}},threejsPlugin:function(){function t(t){var e=t[0]*Math.PI/180,n=t[1]*Math.PI/180,o=Math.cos(n);return new THREE.Vector3(u*o*Math.cos(e),u*Math.sin(n),-u*o*Math.sin(e))}function e(e,n){var o=new THREE.Geometry;return e.coordinates.forEach(function(e){d3.pairs(e.map(t),function(t,e){o.vertices.push(t,e)})}),new THREE.LineSegments(o,n)}function n(){var t=this._;u=t.proj.scale();var e=t.options,n=e.width,o=e.height,r=document.getElementById(i);s.scale=d3.scaleLinear().domain([0,u]).range([0,1]),s.camera=new THREE.OrthographicCamera(-n/2,n/2,o/2,-o/2,.1,3e4),s.light=new THREE.PointLight(16777215,0),s.scene=new THREE.Scene,s.group=new THREE.Group,s.node=r,s.camera.position.z=3010,s.camera.name="camera",s.group.name="group",s.light.name="light",s.scene.add(s.camera),s.scene.add(s.group),s.camera.add(s.light),s.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0,canvas:r}),s.renderer.setClearColor(0,0),s.renderer.setSize(n,o),s.renderer.sortObjects=!0,this.renderThree=a,window.THREEx&&window.THREEx.DomEvents&&(s.domEvents=new window.THREEx.DomEvents(s.camera,s.renderer.domElement)),Object.defineProperty(s.me,"group",{get:function(){return s.group}}),Object.defineProperty(s.me,"camera",{get:function(){return s.camera}}),Object.defineProperty(s.me,"renderer",{get:function(){return s.renderer}}),Object.defineProperty(s.me,"domEvents",{get:function(){return s.domEvents}})}function o(t){t||(t=s.group);var e=s.scale(this._.proj.scale());t.scale.x=e,t.scale.y=e,t.scale.z=e,a.call(this)}function r(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=this._,r=o.proj.rotate();r[0]-=90;var i=o.versor(r),l=new THREE.Quaternion(-i[2],i[1],i[3],i[0]);(t||s.group).setRotationFromQuaternion(l),a.call(this,e,!1,n)}function a(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments[1];e?(s.renderer.render(s.scene,s.camera),d&&(d=null,clearTimeout(d))):null===d&&(d=setTimeout(function(){n&&n.call(t,s.group),s.renderer.render(s.scene,s.camera),d=null},0))}var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"three-js",s={renderer:null,scene:null,camera:null},l=new THREE.LoadingManager,c=new THREE.TextureLoader(l),u=void 0,d=null;return{name:"threejsPlugin",onInit:function(t){s.me=t,n.call(this)},onCreate:function(){s.group.children=[],r.call(this)},onRefresh:function(){r.call(this,null,!0)},onResize:function(){o.call(this)},group:function(){return s.group},addGroup:function(t){var e=this;s.group.add(t),t.name&&this[t.name]&&(this[t.name].add=function(){s.group.add(t),e.__addEventQueue(t.name),a.call(e)},this[t.name].remove=function(){s.group.remove(t),e.__removeEventQueue(t.name),a.call(e)},this[t.name].isAdded=function(){return s.group.children.filter(function(e){return e.name===t.name}).length>0})},emptyGroup:function(){for(var t=s.group.children,e=t.length-1;e>-1;--e){var n=t[e];s.group.remove(n),n.name&&this.__removeEventQueue(n.name),a.call(this)}},scale:function(t){o.call(this,t)},rotate:function(t){r.call(this,t)},vertex:function(e){return t(e)},wireframe:function(t,n){return e(t,n)},texture:function(t){return c.load(t,function(t){return t})},renderThree:function(){a.call(this)},light:function(){return s.camera.children[0]},node:function(){return s.node}}},dblClickCanvas:function(){function t(t){return n.countries.features.find(function(e){return e.geometry.coordinates.find(function(e){return d3.polygonContains(e,t)||e.find(function(e){return d3.polygonContains(e,t)})})})}function e(){if(this.worldCanvas){var e=this.worldCanvas.data();e&&(n.countries=topojson.feature(e,e.objects.countries))}var o=this._,r=this;this.mousePlugin&&this.mousePlugin.onDblClick({dblClickCanvas:function(e,a){var i=this;if(e){e.sourceEvent&&(e=e.sourceEvent);var s=[e.clientX,e.clientY],l=o.proj.invert(a);n.pos=l,n.dot=null,n.mouse=s,n.country=null,o.options.showDots&&n.onCircleVals.forEach(function(t){n.dot=t.call(i,e,l)}),o.options.showLand&&!n.dot&&(o.drag||(r.countryCanvas?n.country=r.countryCanvas.detectCountry(l):n.country=t(l)),n.onCountryVals.forEach(function(t){t.call(i,e,n.country)}))}}})}var n={mouse:null,country:null,countries:null,onCircle:{},onCircleVals:[],onCountry:{},onCountryVals:[]};return{name:"dblClickCanvas",onInit:function(t){n.me=t,e.call(this)},onCreate:function(){this.worldJson&&!n.world&&n.me.data(this.worldJson.data())},onCircle:function(t){Object.assign(n.onCircle,t),n.onCircleVals=Object.keys(n.onCircle).map(function(t){return n.onCircle[t]})},onCountry:function(t){Object.assign(n.onCountry,t),n.onCountryVals=Object.keys(n.onCountry).map(function(t){return n.onCountry[t]})},data:function(t){if(!t)return n.world;n.world=t,n.countries=topojson.feature(t,t.objects.countries)},allData:function(t){if(!t)return{world:n.world,countries:n.countries};n.world=t.world,n.countries=t.countries},state:function(){return{pos:n.pos,dot:n.dot,mouse:n.mouse,country:n.country}}}},autorotatePlugin:function(){function t(){var t=this._.options;this.clickCanvas&&this.clickCanvas.onCountry({autorotatePlugin:function(e,n){n||(t.spin=!t.spin)}})}function e(t){if(t-a>40){a=t;var e=new Date;if(this._.options.spin&&!1===this._.drag){var o=e-r.lastTick;n.call(this,o),r.sync.forEach(function(t){return n.call(t,o)})}r.lastTick=e}}function n(t){var e=this._.proj.rotate();e[0]+=r.degree*t,this._.rotate(e)}var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,r={lastTick:new Date,degree:o/1e3,sync:[]},a=0;return{name:"autorotatePlugin",onInit:function(t){r.me=t,this._.options.spin=!0},onCreate:function(){t.call(this)},onInterval:function(t){e.call(this,t)},speed:function(t){r.degree=t/1e3},sync:function(t){r.sync=t},start:function(){this._.options.spin=!0},stop:function(){this._.options.spin=!1},spin:function(t){if(void 0===t)return this._.options.spin;this._.options.spin=t}}},oceanSvg:function(){function t(){var t=this._;this._.options.showOcean=!0,Object.defineProperty(t.options,"oceanColor",{get:function(){return o.oceanColor},set:function(t){o.oceanColor=t}}),o.svg=t.svg}function e(){if(o.svg.selectAll("#ocean,.ocean").remove(),this._.options.showOcean){var t=o.oceanColor,e=this.$slc.defs.append("radialGradient").attr("id","ocean").attr("cx","75%").attr("cy","25%");"string"==typeof t&&(t=[t,t]),e.append("stop").attr("offset","100%").attr("stop-color",t[1]),r.ocean=o.svg.append("g").attr("class","ocean").append("circle").attr("cx",this._.center[0]).attr("cy",this._.center[1]).attr("class","noclicks"),n.call(this)}}function n(){r.ocean&&this._.options.showOcean&&r.ocean.attr("r",this._.proj.scale()+o.scale)}var o={svg:null,q:null,scale:0,oceanColor:["rgba(221, 221, 255, 0.6)","rgba(153, 170, 187,0.8)"]},r={};return{name:"oceanSvg",onInit:function(e){o.me=e,t.call(this)},onCreate:function(){e.call(this)},onResize:function(){n.call(this)},selectAll:function(t){return t&&(o.q=t,o.svg=d3.selectAll(t)),o.svg},scale:function(t){if(!t)return o.scale;o.scale=t,n.call(this)},recreate:function(){e.call(this)},$ocean:function(){return r.ocean}}},sphereSvg:function(){function t(){var t=this._;t.options.showSphere=!0,o.svg=t.svg}function e(){o.svg.selectAll("#glow,.sphere").remove(),this._.options.showSphere&&(this.$slc.defs.nodes()[0].append("\n<filter id='glow'>\n    <feColorMatrix type='matrix'\n        values=\n        '0 0 0 0   0\n         0 0 0 0.9 0\n         0 0 0 0.9 0\n         0 0 0 1   0'/>\n    <feGaussianBlur stdDeviation='5.5' result='coloredBlur'/>\n    <feMerge>\n        <feMergeNode in='coloredBlur'/>\n        <feMergeNode in='SourceGraphic'/>\n    </feMerge>\n</filter>\n"),r.sphere=o.svg.append("g").attr("class","sphere").append("circle").attr("cx",this._.center[0]).attr("cy",this._.center[1]).attr("class","noclicks").attr("filter","url(#glow)"),n.call(this))}function n(){r.sphere.attr("r",this._.proj.scale())}var o={svg:null,q:null,sphereColor:0},r={};return{name:"sphereSvg",onInit:function(e){o.me=e,t.call(this)},onCreate:function(){e.call(this)},onResize:function(){n.call(this)},selectAll:function(t){return t&&(o.q=t,o.svg=d3.selectAll(t)),o.svg},$sphere:function(){return r.sphere}}},zoomPlugin:function(){function t(){var t=this._,e=t.proj.scale(),n=[t.options.width,t.options.height];t.svg.call(d3.zoom().on("zoom start end",function(){var n=d3.event.transform;t.proj.scale(e*n.k),t.resize(),t.refresh()}).scaleExtent([.1,5]).translateExtent([[0,0],n]))}var e={};return{name:"zoomPlugin",onInit:function(n){e.me=n,t.call(this)}}},fauxGlobeSvg:function(){function t(){var t=this._;t.options.showGlobeShading=!0,t.options.showGlobeHilight=!0,a.svg=t.svg}function e(){n.call(this),o.call(this)}function n(){var t=this._;if(a.svg.selectAll("#shading,.shading").remove(),t.options.showGlobeShading){var e=this.$slc.defs.append("radialGradient").attr("id","shading").attr("cx","50%").attr("cy","40%");e.append("stop").attr("offset","50%").attr("stop-color","#9ab").attr("stop-opacity","0"),e.append("stop").attr("offset","100%").attr("stop-color","#3e6184").attr("stop-opacity","0.3"),i.globeShading=a.svg.append("g").attr("class","shading").append("circle").attr("cx",t.center[0]).attr("cy",t.center[1]).attr("r",t.proj.scale()).attr("class","noclicks").style("fill","url(#shading)")}}function o(){var t=this._;if(a.svg.selectAll("#hilight,.hilight").remove(),t.options.showGlobeHilight){var e=this.$slc.defs.append("radialGradient").attr("id","hilight").attr("cx","75%").attr("cy","25%");e.append("stop").attr("offset","5%").attr("stop-color","#ffd").attr("stop-opacity","0.6"),e.append("stop").attr("offset","100%").attr("stop-color","#ba9").attr("stop-opacity","0.2"),i.globeHilight=a.svg.append("g").attr("class","hilight").append("circle").attr("cx",t.center[0]).attr("cy",t.center[1]).attr("r",t.proj.scale()).attr("class","noclicks").style("fill","url(#hilight)")}}function r(){var t=this._,e=t.options,n=t.proj.scale();i.globeShading&&e.showGlobeShading&&i.globeShading.attr("r",n),i.globeHilight&&e.showGlobeHilight&&i.globeHilight.attr("r",n)}var a={svg:null,q:null},i={};return{name:"fauxGlobeSvg",onInit:function(e){a.me=e,t.call(this)},onCreate:function(){e.call(this)},onResize:function(){r.call(this)},selectAll:function(t){return t&&(a.q=t,a.svg=d3.selectAll(t)),a.svg},$globeShading:function(){return i.globeShading},$globeHilight:function(){return i.globeHilight}}},graticuleSvg:function(){function t(){var t=this._;t.options.showGraticule=!0,t.options.transparentGraticule=!1,o.svg=t.svg}function e(){o.svg.selectAll(".graticule").remove(),this._.options.showGraticule&&(r.graticule=o.svg.append("g").attr("class","graticule").append("path").datum(o.graticule).attr("class","noclicks"),n.call(this))}function n(){var t=this._;r.graticule&&t.options.showGraticule&&(t.options.transparent||t.options.transparentGraticule?(t.proj.clipAngle(180),r.graticule.attr("d",this._.path),t.proj.clipAngle(90)):r.graticule.attr("d",this._.path))}var o={svg:null,q:null,graticule:d3.geoGraticule()},r={};return{name:"graticuleSvg",onInit:function(e){o.me=e,t.call(this)},onCreate:function(){e.call(this)},onRefresh:function(){n.call(this)},selectAll:function(t){return t&&(o.q=t,o.svg=d3.selectAll(t)),o.svg},$graticule:function(){return r.graticule}}},dropShadowSvg:function(){function t(){var t=this._;t.options.showDropShadow=!0,o.svg=t.svg}function e(){var t=this._;if(o.svg.selectAll("#drop_shadow,.drop_shadow").remove(),t.options.showDropShadow){var e=this.$slc.defs.append("radialGradient").attr("id","drop_shadow").attr("cx","50%").attr("cy","50%");e.append("stop").attr("offset","20%").attr("stop-color","#000").attr("stop-opacity",".5"),e.append("stop").attr("offset","100%").attr("stop-color","#000").attr("stop-opacity","0"),r.dropShadow=o.svg.append("g").attr("class","drop_shadow").append("ellipse").attr("cx",t.center[0]).attr("class","noclicks").style("fill","url(#drop_shadow)"),n.call(this)}}function n(){var t=this._.proj.scale();r.dropShadow.attr("cy",t+this._.center[1]).attr("rx",.9*t).attr("ry",.25*t)}var o={svg:null,q:null},r={};return{name:"dropShadowSvg",onInit:function(e){o.me=e,t.call(this)},onCreate:function(){e.call(this)},onResize:function(){r.dropShadow&&this._.options.showDropShadow&&n.call(this)},selectAll:function(t){return t&&(o.q=t,o.svg=d3.selectAll(t)),o.svg},$dropShadow:function(){return r.dropShadow}}},dotTooltipSvg:function(){function t(t,e){var n=t.properties,o=Object.keys(n).map(function(t){return t+": "+n[t]}).join("<br/>");return e.html(o)}function e(){var e=this;this.dotsSvg.$dots().on("mouseover",function(){if(e._.options.showBarTooltip){r.visible=!0,r.mouseXY=[d3.event.pageX+7,d3.event.pageY-15];var o=+this.dataset.index,i=e.dotsSvg.data().features[o];(r.me.show||t)(i,a).style("display","block").style("opacity",1),n()}}).on("mouseout",function(){r.visible=!1,a.style("opacity",0).style("display","none")}).on("mousemove",function(){e._.options.showBarTooltip&&(r.mouseXY=[d3.event.pageX+7,d3.event.pageY-15],n())})}function n(){a.style("left",r.mouseXY[0]+7+"px").style("top",r.mouseXY[1]-15+"px")}function o(){e.call(this),a.style("opacity",0).style("display","none")}var r={mouseXY:[0,0],visible:!1},a=d3.select("body").append("div").attr("class","ej-dot-tooltip");return{name:"dotTooltipSvg",onInit:function(t){r.me=t,this._.options.showBarTooltip=!0},onCreate:function(){e.call(this)},onRefresh:function(){n.call(this)},onResize:function(){o.call(this)},visible:function(){return r.visible}}},dotSelectCanvas:function(){function t(t){var e=null;if(n.dots){var o=this.hoverCanvas.states().mouse;n.dots.forEach(function(n){o&&!e&&d3.geoDistance(n.coordinates,t)<=.02&&(e=n)})}return e}function e(){var e=this;if(this.hoverCanvas){var o=function(o,r){var a=t.call(e,r);return n.onHoverVals.forEach(function(t){t.call(e,o,a)}),a};o.tooltips=!0,this.hoverCanvas.onCircle({dotsCanvas:o})}if(this.clickCanvas){var r=function(o,r){var a=t.call(e,r);return n.onClickVals.forEach(function(t){t.call(e,o,a)}),a};this.clickCanvas.onCircle({dotsCanvas:r})}if(this.dblClickCanvas){var a=function(o,r){var a=t(o,r);return n.onDblClickVals.forEach(function(t){t.call(e,o,a)}),a};this.dblClickCanvas.onCircle({dotsCanvas:a})}}var n={dataDots:null,dots:null,radiusPath:null,onHover:{},onHoverVals:[],onClick:{},onClickVals:[],onDblClick:{},onDblClickVals:[]};return{name:"dotSelectCanvas",onInit:function(t){n.me=t,e.call(this)},onCreate:function(){this.dotsCanvas&&!n.dots&&n.me.dots(this.dotsCanvas.dots())},onHover:function(t){Object.assign(n.onHover,t),n.onHoverVals=Object.keys(n.onHover).map(function(t){return n.onHover[t]})},onClick:function(t){Object.assign(n.onClick,t),n.onClickVals=Object.keys(n.onClick).map(function(t){return n.onClick[t]})},onDblClick:function(t){Object.assign(n.onDblClick,t),n.onDblClickVals=Object.keys(n.onDblClick).map(function(t){return n.onDblClick[t]})},dots:function(t){n.dots=t}}},graticuleCanvas:function(){function t(){var t=this._;t.options.showGraticule=!0,t.options.transparentGraticule=!1}function e(){var t=this._;t.options.showGraticule&&((t.options.transparent||t.options.transparentGraticule)&&t.proj.clipAngle(180),this.canvasPlugin.render(function(t,e){t.beginPath(),e(n),t.lineWidth=.4,t.strokeStyle=o.style.line||"rgba(119,119,119,0.6)",t.stroke()},o.drawTo),(t.options.transparent||t.options.transparentGraticule)&&t.proj.clipAngle(90))}var n=d3.geoGraticule()(),o={style:{},drawTo:null};return{name:"graticuleCanvas",onInit:function(e){o.me=e,t.call(this)},onCreate:function(){e.call(this)},onRefresh:function(){e.call(this)},drawTo:function(t){o.drawTo=t},style:function(t){return t&&(o.style=t),o.style}}},dotTooltipCanvas:function(){function t(t,e){var n=t.properties,o=Object.keys(n).map(function(t){return t+": "+n[t]}).join("<br/>");return e.html(o)}function e(e,n){var o=[e.clientX,e.clientY];(r.me.show||t)(n,a).style("display","block").style("opacity",1).style("left",o[0]+7+"px").style("top",o[1]-15+"px"),r.oldData=n,r.hidden=!1}function n(){r.hidden||(r.hidden=!0,a.style("opacity",0).style("display","none"))}function o(){var t=this;this.dotSelectCanvas.onHover({dotTooltipCanvas:function(o,r){r&&null!==t._.drag?e(o,r):n()}})}var r={hidden:null},a=d3.select("body").append("div").attr("class","ej-dot-tooltip");return{name:"dotTooltipCanvas",onInit:function(t){r.me=t,o.call(this)}}},countrySelectCanvas:function(){function t(){var t=this;if(this.hoverCanvas){var e=function(e,o){return n.onHoverVals.forEach(function(n){n.call(t,e,o)}),o};this.hoverCanvas.onCountry({countrySelectCanvas:e})}if(this.clickCanvas){var o=function(e,o){return n.onClickVals.forEach(function(n){n.call(t,e,o)}),o};this.clickCanvas.onCountry({countrySelectCanvas:o})}if(this.dblClickCanvas){var r=function(e,o){return n.onDblClickVals.forEach(function(n){n.call(t,e,o)}),o};this.dblClickCanvas.onCountry({countrySelectCanvas:r})}}function e(){if(this.worldCanvas&&!n.countries){var t=this.worldCanvas.data();t&&(n.world=t,n.countries=topojson.feature(t,t.objects.countries))}}var n={countries:null,onHover:{},onHoverVals:[],onClick:{},onClickVals:[],onDblClick:{},onDblClickVals:[]};return{name:"countrySelectCanvas",onInit:function(e){n.me=e,t.call(this)},onCreate:function(){e.call(this)},onHover:function(t){Object.assign(n.onHover,t),n.onHoverVals=Object.keys(n.onHover).map(function(t){return n.onHover[t]})},onClick:function(t){Object.assign(n.onClick,t),n.onClickVals=Object.keys(n.onClick).map(function(t){return n.onClick[t]})},onDblClick:function(t){Object.assign(n.onDblClick,t),n.onDblClickVals=Object.keys(n.onDblClick).map(function(t){return n.onDblClick[t]})},data:function(t){if(!t)return n.world;n.world=t,n.countries=topojson.feature(t,t.objects.countries)}}},countryTooltipCanvas:function(t){function e(t){var e="";return s.countryNames&&(e=s.countryNames.find(function(e){return e.id==t.id})),e}function n(t){return l.style("left",t[0]+7+"px").style("top",t[1]-15+"px")}function o(t,e){var n=Object.keys(t).map(function(e){return e+": "+t[e]}).join("<br/>");return e.html(n)}function r(t,e){n([t.clientX,t.clientY]),(s.me.show||o)(e,l).style("display","block").style("opacity",1),s.hidden=!1}function a(){s.hidden||(s.hidden=!0,l.style("opacity",0).style("display","none"))}function i(){var t=this,n=function(n,o){if(null!==t._.drag&&o&&t._.options.showCountryTooltip){var i=e(o);!i||t.barTooltipSvg&&t.barTooltipSvg.visible()?a():r(n,i)}else a()};n.tooltips=!0,this.hoverCanvas.onCountry({countryTooltipCanvas:n}),this._.options.showCountryTooltip=!0}var s={hidden:null},l=d3.select("body").append("div").attr("class","ej-country-tooltip");return{name:"countryTooltipCanvas",urls:t&&[t],onReady:function(t,e){s.countryNames=e},onInit:function(t){s.me=t,i.call(this)},onRefresh:function(){this._.drag&&n(this.mousePlugin.mouse())},data:function(t){if(!t)return s.countryNames;s.countryNames=t}}},countryTooltipSvg:function(t){function e(t){var e="";return a.countryNames&&(e=a.countryNames.find(function(e){return e.id==t.id})),e}function n(t,e){var n=Object.keys(t).map(function(e){return e+": "+t[e]}).join("<br/>");return e.html(n)}function o(){var t=this;this.worldSvg.$countries().on("mouseover",function(o){if(t._.options.showCountryTooltip){a.show=!0;var s=e(o);r(),(a.me.show||n)(s,i).style("display","block").style("opacity",1)}}).on("mouseout",function(){a.show=!1,i.style("opacity",0).style("display","none")}).on("mousemove",function(){t._.options.showCountryTooltip&&r()})}function r(t){return t||(t=[d3.event.pageX,d3.event.pageY]),i.style("left",t[0]+7+"px").style("top",t[1]-15+"px")}var a={show:!1},i=d3.select("body").append("div").attr("class","ej-country-tooltip");return{name:"countryTooltipSvg",urls:t&&[t],onReady:function(t,e){a.countryNames=e},onInit:function(t){a.me=t,this._.options.showCountryTooltip=!0},onCreate:function(){o.call(this)},onRefresh:function(){this._.drag&&a.show&&r(this.mousePlugin.mouse())},data:function(t){if(!t)return a.countryNames;a.countryNames=t}}},barTooltipSvg:function(){function t(t,e){var n=t.properties,o=Object.keys(n).map(function(t){return t+": "+n[t]}).join("<br/>");return e.html(o)}function e(){var e=this;this.barSvg.$bar().on("mouseover",function(){if(e._.options.showBarTooltip){r.visible=!0,r.mouseXY=[d3.event.pageX+7,d3.event.pageY-15];var o=+this.dataset.index,i=e.barSvg.data().features[o];(r.me.show||t)(i,a).style("display","block").style("opacity",1),n()}}).on("mouseout",function(){r.visible=!1,a.style("opacity",0).style("display","none")}).on("mousemove",function(){e._.options.showBarTooltip&&(r.mouseXY=[d3.event.pageX+7,d3.event.pageY-15],n())})}function n(){a.style("left",r.mouseXY[0]+7+"px").style("top",r.mouseXY[1]-15+"px")}function o(){e.call(this),a.style("opacity",0).style("display","none")}var r={mouseXY:[0,0],visible:!1},a=d3.select("body").append("div").attr("class","ej-bar-tooltip");return{name:"barTooltipSvg",onInit:function(t){r.me=t,this._.options.showBarTooltip=!0},onCreate:function(){e.call(this)},onRefresh:function(){n.call(this)},onResize:function(){o.call(this)},visible:function(){return r.visible}}},worldCanvas:function(t){function e(){var t=this,e=this._;if(a.world&&((e.options.transparent||e.options.transparentLand)&&this.canvasPlugin.flipRender(function(t,e){t.beginPath(),e(a.land),t.fillStyle=a.style.backLand||"rgba(119,119,119,0.2)",t.fill()},a.drawTo,a.options),e.options.showLand?(e.options.showCountries||a.me.showCountries?o.call(this,e.options.showBorder):n.call(this),!e.drag&&e.options.showLakes&&r.call(this)):e.options.showBorder&&o.call(this,!0),this.hoverCanvas&&e.options.showSelectedCountry)){if(a.selected.features.length>0)if(a.selected.multiColor){var i=!0,s=!1,l=void 0;try{for(var c,u=function(){var e=c.value;t.canvasPlugin.render(function(t,n){t.beginPath(),n(e),t.fillStyle=e.color,t.fill()},a.drawTo,a.options)},d=a.selected.features[Symbol.iterator]();!(i=(c=d.next()).done);i=!0)u()}catch(t){s=!0,l=t}finally{try{!i&&d.return&&d.return()}finally{if(s)throw l}}}else this.canvasPlugin.render(function(t,e){t.beginPath(),e(a.selected),t.fillStyle=a.style.selected||"rgba(87, 255, 99, 0.5)",t.fill()},a.drawTo,a.options);var h=this.hoverCanvas.states().country;h&&!a.selected.features.find(function(t){return t.id===h.id})&&this.canvasPlugin.render(function(t,e){t.beginPath(),e(h),t.fillStyle=a.style.hover||"rgba(117, 0, 0, 0.5)",t.fill()},a.drawTo,a.options)}}function n(){this.canvasPlugin.render(function(t,e){t.beginPath(),e(a.land),t.fillStyle=a.style.land||"rgba(2, 20, 37,0.8)",t.fill()},a.drawTo,a.options)}function o(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.canvasPlugin.render(function(e,n){e.beginPath(),n(a.countries),t||(e.fillStyle=a.style.countries||"rgba(2, 20, 37,0.8)",e.fill()),e.lineWidth=.1,e.strokeStyle=a.style.border||"rgb(239, 237, 234)",e.stroke()},a.drawTo,a.options)}function r(){this.canvasPlugin.render(function(t,e){t.beginPath(),e(a.lakes),t.fillStyle=a.style.lakes||"rgba(80, 87, 97, 0.5)",t.fill()},a.drawTo,a.options)}var a={style:{},options:{},drawTo:null,world:null,land:null,lakes:{type:"FeatureCollection",features:[]},countries:{type:"FeatureCollection",features:[]},selected:{type:"FeatureCollection",features:[],multiColor:!1}};return{name:"worldCanvas",urls:t&&[t],onReady:function(t,e){a.me.data(e)},onInit:function(t){a.me=t;var e=this._.options;e.showLand=!0,e.showLakes=!0,e.showBorder=!1,e.showCountries=!0,e.transparentLand=!1},onCreate:function(){var t=this;if(this.worldJson&&!a.world&&a.me.allData(this.worldJson.allData()),e.call(this),this.hoverCanvas){var n={};n[a.me.name]=function(){t._.options.spin||t._.refresh()},this.hoverCanvas.onCountry(n)}},onRefresh:function(){e.call(this)},countries:function(t){if(!t)return a.countries.features;a.countries.features=t},selectedCountries:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t)return a.selected.features;a.selected.features=t,a.selected={type:"FeatureCollection",features:t,multiColor:e}},data:function(t){if(!t)return a.world;a.world=t,a.land=topojson.feature(t,t.objects.land),a.lakes.features=topojson.feature(t,t.objects.ne_110m_lakes).features,a.countries.features=topojson.feature(t,t.objects.countries).features},allData:function(t){if(!t)return{world:a.world,land:a.land,lakes:a.lakes,countries:a.countries};a.world=t.world,a.land=t.land,a.lakes=t.lakes,a.countries=t.countries},drawTo:function(t){a.drawTo=t},style:function(t){return t&&(a.style=t),a.style},options:function(t){a.options=t}}},centerSvg:function(){function t(t,e){e=e.replace("x","");for(var n=0,o=t.length;n<o;n++)if(t[n].id==e)return t[n]}function e(t){var e=this._,n=d3.interpolate(e.proj.rotate(),[-t[0],-t[1],0]),o=function(t){return e.rotate(n(t))};d3.transition().duration(2500).tween("rotate",function(){return o})}function n(){var n=this;this.worldSvg.$countries().on("click",function(){if(n._.options.enableCenter){var r=this.id.replace("x",""),a=t(n.worldSvg.countries(),r);e.call(n,d3.geoCentroid(a)),"function"==typeof o.focused&&o.focused.call(n)}})}var o={focused:null,svgAddCountriesOld:null};return{name:"centerSvg",onInit:function(t){o.me=t,this._.options.enableCenter=!0},onCreate:function(){n.call(this)},go:function(n){var o=t(this.worldSvg.countries(),n),r=d3.geoCentroid(o);e.call(this,r)},focused:function(t){o.focused=t}}},placesSvg:function(t){function e(){var t=this._;t.options.showPlaces=!0,s.svg=t.svg}function n(){s.svg.selectAll(".points,.labels").remove(),s.places&&this._.options.showPlaces&&(o.call(this),r.call(this),i.call(this))}function o(){l.placePoints=s.svg.append("g").attr("class","points").selectAll("path").data(s.places.features).enter().append("path").attr("class","point")}function r(){l.placeLabels=s.svg.append("g").attr("class","labels").selectAll("text").data(s.places.features).enter().append("text").attr("class","label").text(function(t){return t.properties.name})}function a(){var t=this,e=this._.proj.invert(this._.center);l.placeLabels.attr("text-anchor",function(e){var n=t._.proj(e.geometry.coordinates)[0];return n<t._.center[0]-20?"end":n<t._.center[0]+20?"middle":"start"}).attr("transform",function(e){var n=t._.proj(e.geometry.coordinates),o=n[0],r=n[1];return"translate("+(o+(o<t._.center[0]?-5:5))+","+(r-2)+")"}).style("display",function(t){return d3.geoDistance(t.geometry.coordinates,e)>1.57?"none":"inline"})}function i(){l.placePoints&&(l.placePoints.attr("d",this._.path),a.call(this))}var s={svg:null,q:null,places:null},l={};return{name:"placesSvg",urls:t&&[t],onReady:function(t,e){s.places=e},onInit:function(t){s.me=t,e.call(this)},onCreate:function(){n.call(this)},onRefresh:function(){i.call(this)},data:function(t){if(!t)return s.places;s.places=t},selectAll:function(t){return t&&(s.q=t,s.svg=d3.selectAll(t)),s.svg},$placePoints:function(){return l.placePoints},$placeLabels:function(){return l.placeLabels}}},worldSvg:function(t){function e(){var t=this._;s.svg.selectAll("."+s.me.name).remove(),t.options.showLand&&(l.g=s.svg.append("g").attr("class",s.me.name),s.world&&((t.options.transparent||t.options.transparentLand)&&s.svgAddWorldBg.call(this),t.options.showCountries||s.me.showCountries?s.svgAddCountries.call(this):s.svgAddWorld.call(this),!t.drag&&t.options.showLakes&&s.svgAddLakes.call(this)),n.call(this))}function n(){var t=this._;s.world&&(t.options.transparent||t.options.transparentLand?(l.worldBg||o(),t.proj.clipAngle(180),l.worldBg.attr("d",t.path),t.proj.clipAngle(90)):l.worldBg&&(l.worldBg.remove(),l.worldBg=null),t.options.showLand&&(t.options.showCountries?(l.countries||(l.world.remove(),l.world=null,a()),l.countries.attr("d",t.path)):(l.world||(l.countries.remove(),l.countries=null,r()),l.world.attr("d",t.path)),t.options.showLakes&&l.lakes.attr("d",t.path)))}function o(){l.worldBg=l.g.append("g").attr("class","landbg").append("path").datum(s.land).attr("fill","rgba(119,119,119,0.2)")}function r(){l.world=l.g.append("g").attr("class","land").append("path").datum(s.land)}function a(){l.countries=l.g.append("g").attr("class","countries").selectAll("path").data(s.countries.features).enter().append("path").attr("class",function(t){return"cid-"+t.properties.cid}).attr("id",function(t){return"x"+t.id})}function i(){l.lakes=l.g.append("g").attr("class","lakes").append("path").datum(s.lakes)}var s={q:null,svg:null,world:null,land:null,lakes:{type:"FeatureCollection",features:[]},selected:{type:"FeatureCollection",features:[]},countries:{type:"FeatureCollection",features:[]}},l={};return{name:"worldSvg",urls:t&&[t],onReady:function(t,e){s.me.data(e)},onInit:function(t){s.me=t;var e=this._,n=e.options;n.showLand=!0,n.showLakes=!0,n.showCountries=!0,n.transparentLand=!1,s.svgAddCountries=a,s.svgAddWorldBg=o,s.svgAddLakes=i,s.svgAddWorld=r,s.svg=e.svg},onCreate:function(){this.worldJson&&!s.world&&s.me.allData(this.worldJson.allData()),e.call(this)},onRefresh:function(){n.call(this)},countries:function(t){if(!t)return s.countries.features;s.countries.features=t},data:function(t){if(!t)return s.world;s.world=t,s.land=topojson.feature(t,t.objects.land),s.lakes.features=topojson.feature(t,t.objects.ne_110m_lakes).features,s.countries.features=topojson.feature(t,t.objects.countries).features},allData:function(t){if(!t)return{world:s.world,land:s.land,lakes:s.lakes,countries:s.countries};s.world=t.world,s.land=t.land,s.lakes=t.lakes,s.countries=t.countries},selectAll:function(t){return t&&(s.q=t,s.svg=d3.selectAll(t)),s.svg},$world:function(){return l.world},$lakes:function(){return l.lakes},$countries:function(){return l.countries}}},barSvg:function(t){function e(){var t=this._;t.options.showBars=!0,a.barProjection=t.projection(),a.svg=t.svg}function n(){var t=this._;if(r.call(this),a.svg.selectAll(".bar").remove(),a.bars&&t.options.showBars){var e=a.svg.append("g").attr("class","bar"),n=e.append("mask").attr("id","edge");n.append("rect").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").attr("fill","white"),n.append("use").attr("xlink:href","#edgeCircle").attr("fill","black"),a.max=d3.max(a.bars.features,function(t){return parseInt(t.geometry.value)});var l=t.proj.scale();a.heightScale=d3.scaleLinear().domain([0,a.max]).range([l,l+s(l)]),i.bar=e.selectAll("line").data(a.bars.features).enter().append("line").attr("stroke","red").attr("stroke-width","2").attr("data-index",function(t,e){return e}),o.call(this)}}function o(){var t=this._;if(a.bars&&t.options.showBars){var e=t.proj,n=a.heightScale,o=a.barProjection,r=e.invert(t.center);o.rotate(this._.proj.rotate()),i.bar.each(function(t){var a=t.geometry.coordinates;o.scale(n(t.geometry.value));var i=d3.geoDistance(a,r),s=e(a),l=o(a);d3.select(this).attr("x1",s[0]).attr("y1",s[1]).attr("x2",l[0]).attr("y2",l[1]).attr("mask",i<1.57?null:"url(#edge)")})}}function r(){var t=this._;this.$slc.defs.selectAll("clipPath").remove(),this.$slc.defs.append("clipPath").append("circle").attr("id","edgeCircle").attr("cx",t.center[0]).attr("cy",t.center[1]).attr("r",t.proj.scale())}var a={svg:null,barProjection:null,q:null,bars:null,valuePath:null},i={},s=d3.scaleLinear().domain([0,200]).range([5,50]);return{name:"barSvg",urls:t&&[t],onReady:function(t,e){a.me.data(e)},onInit:function(t){a.me=t,e.call(this)},onCreate:function(){n.call(this)},onRefresh:function(){o.call(this)},onResize:function(){n.call(this)},selectAll:function(t){return t&&(a.q=t,a.svg=d3.selectAll(t)),a.svg},valuePath:function(t){a.valuePath=t},data:function(t){var e=this;if(!t)return a.bars;if(a.valuePath){var n=a.valuePath.split(".");t.features.forEach(function(t){var e=t;n.forEach(function(t){return e=e[t]}),t.geometry.value=e})}a.bars=t,setTimeout(function(){return o.call(e)},1)},$bar:function(){return i.bar}}},mapSvg:function(t){function e(){i.svg=this._.svg;var t=this._.options,e=t.width,n=t.height,o=e/6.279;i.zoom=d3.zoom().on("zoom",function(){return s.g.attr("transform",d3.event.transform)}),i.proj=d3.geoEquirectangular().scale(o).translate([e/2,n/2]),i.path=d3.geoPath().projection(i.proj).context(i.context),i.svg.call(i.zoom)}function n(t,e){var n=t.properties,o=Object.keys(n).map(function(t){return t+": "+n[t]}).join("<br/>");return e.html(o)}function o(){var t=this;i.flexBox=d3.selectAll(a),i.svg.selectAll(".countries").remove(),this._.options.showMap&&(s.g=i.svg.append("g").attr("class","countries"),s.countries=s.g.selectAll("path").data(i.countries.features).enter().append("path").attr("class",function(t){return"cid-"+t.properties.cid}).attr("id",function(t){return"x"+t.id}),s.countries.on("click",function(e){var n=this,o=e.properties.cid;if(s.countries.classed("selected",!1),t.choroplethCsv){var r=-1,a=t.choroplethCsv.colorScale(),l=a.scale(e.properties.value);i.selectedCountry&&(r=a.scale(i.selectedCountry.properties.value)),r===l&&i.selectedCountry!==e||t.choroplethCsv.setSelectedColor(l-1),t.choroplethCsv.cid(o),d3.selectAll(".color-countries-item").classed("selected",!1),d3.selectAll(".color-countries-item.cid-"+o).classed("selected",!0)}i.selectedCountry!==e?(i.selectedCountry=e,s.countries.filter("#x"+e.id).classed("selected",!0)):i.selectedCountry=null,i.onCountryVals.forEach(function(t){t.call(n,d3.event,e)})}).on("mouseover",function(t){var e=d3.event,o=e.pageX,r=e.pageY;(i.me.show||n)(t,i.mapTooltip).style("display","block").style("left",o+7+"px").style("top",r-15+"px"),i.flexBox.style("display","flex")}).on("mouseout",function(t){i.me.hide&&i.me.hide(t,i.mapTooltip),i.mapTooltip.style("display","none"),null===i.selectedCountry&&i.flexBox.style("display","none")}).on("mousemove",function(){var t=d3.event,e=t.pageX,n=t.pageY;i.mapTooltip.style("left",e+7+"px").style("top",n-15+"px")}),r.call(this))}function r(){this._.options.showMap&&s.countries.attr("d",i.path)}var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".ej-flexbox",i={q:null,svg:null,world:null,land:null,onCountry:{},onCountryVals:[],selectedCountry:null,lakes:{type:"FeatureCollection",features:[]},selected:{type:"FeatureCollection",features:[]},countries:{type:"FeatureCollection",features:[]}},s={};return i.mapTooltip=d3.select("body").append("div").attr("class","ej-country-tooltip"),{name:"mapSvg",urls:t&&[t],onReady:function(t,e){i.me.data(e)},onInit:function(t){i.me=t,this._.options.showMap=!0,e.call(this)},onCreate:function(){this.worldJson&&!i.world&&i.me.allData(this.worldJson.allData()),o.call(this)},onRefresh:function(){r.call(this)},onCountry:function(t){Object.assign(i.onCountry,t),i.onCountryVals=Object.keys(i.onCountry).map(function(t){return i.onCountry[t]})},selectedCountry:function(){return i.selectedCountry},data:function(t){if(!t)return i.world;i.world=t,i.land=topojson.feature(t,t.objects.land),i.lakes.features=topojson.feature(t,t.objects.ne_110m_lakes).features,i.countries.features=topojson.feature(t,t.objects.countries).features},allData:function(t){if(!t)return{world:i.world,land:i.land,lakes:i.lakes,countries:i.countries};i.world=t.world,i.land=t.land,i.lakes=t.lakes,i.countries=t.countries},selectAll:function(t){return t&&(i.q=t,i.svg=d3.selectAll(t)),i.svg},resetZoom:function(){i.svg.call(i.zoom.transform,d3.zoomIdentity)}}},haloSvg:function(){function t(){var t=this._;t.options.showHalo=!0,r.svg=t.svg}function e(){r.svg.selectAll("#halo,.halo").remove(),this._.options.showHalo&&(this.$slc.defs.append("radialGradient").attr("id","halo").attr("cx","50%").attr("cy","50%").html('\n<stop offset="85%" stop-color="'+o+'" stop-opacity="1"></stop>\n<stop offset="100%" stop-color="'+o+'" stop-opacity="0"></stop>\n'),a.halo=r.svg.append("g").attr("class","halo").append("ellipse").attr("class","noclicks").attr("cx",this._.center[0]).attr("cy",this._.center[1]),n.call(this))}function n(){var t=i(this._.proj.scale());a.halo.attr("rx",t).attr("ry",t)}var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#fff",r={svg:null,q:null},a={},i=d3.scaleLinear().domain([100,300]).range([110,330]);return{name:"haloSvg",onInit:function(e){r.me=e,t.call(this)},onCreate:function(){e.call(this)},onResize:function(){n.call(this)},selectAll:function(t){return t&&(r.q=t,r.svg=d3.selectAll(t)),r.svg},$halo:function(){return a.halo}}},dotsSvg:function(t){function e(){var t=this._;t.options.showDots=!0,i.svg=t.svg}function n(){var t=this._;if(i.svg.selectAll(".dot").remove(),i.dataDots&&t.options.showDots){var e=[];if(i.circles.forEach(function(t){e.push(t.circle)}),s.dots=i.svg.append("g").attr("class","dot").selectAll("path").data(e).enter().append("path"),i.dataDots.geometry){var n=i.dataDots.geometry||{};s.dots.style("stroke-width",n.lineWidth||.2).style("fill",n.fillStyle||"rgba(100,0,0,.4)").style("stroke",n.strokeStyle||"rgba(119,119,119,.4)").attr("data-index",function(t,e){return e})}o.call(this)}}function o(){var t=this._,e=void 0,n=void 0;if(s.dots&&t.options.showDots){var o=i.dataDots.geometry||{};t.options.transparent||t.options.transparentDots?(t.proj.clipAngle(180),s.dots.style("fill",function(r,a){return e=r.coordinates[0][a],(n=d3.geoDistance(e,t.proj.invert(t.center)))>1.57?"none":o.fillStyle||"rgba(100,0,0,.4)"}),s.dots.style("display",function(){return t.drag&&!a?"none":"inline"}),s.dots.attr("d",t.path),t.proj.clipAngle(90)):(s.dots.style("display",function(o,r){return e=o.coordinates[0][r],(n=d3.geoDistance(e,t.proj.invert(t.center)))>1.57||t.drag&&!a?"none":"inline"}),s.dots.style("fill",o.fillStyle||"rgba(100,0,0,.4)"),s.dots.attr("d",t.path))}}function r(){var t=d3.geoCircle(),e=(i.dataDots.geometry||{}).radius||.5;i.circles=i.dataDots.features.map(function(n){var o=n.geometry.coordinates,r=n.properties,a=n.geometry.radius||e;return{properties:r,coordinates:o,circle:t.center(o).radius(a)()}})}var a=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).important,i={dataDots:null,radiusPath:null},s={};return{name:"dotsSvg",urls:t&&[t],onReady:function(t,e){i.me.data(e)},onInit:function(t){i.me=t,e.call(this)},onCreate:function(){n.call(this)},onRefresh:function(){o.call(this)},radiusPath:function(t){i.radiusPath=t},data:function(t){var e=this;if(!t)return i.dataDots;if(i.radiusPath){var n=i.radiusPath.split("."),a=t.features.map(function(t){var e=t;return n.forEach(function(t){return e=e[t]}),e}).sort(),s=d3.scaleLinear().domain([a[0],a.pop()]).range([.5,2]);t.features.forEach(function(t){var e=t;n.forEach(function(t){return e=e[t]}),t.geometry.radius=s(e)})}i.dataDots=t,r(),setTimeout(function(){return o.call(e)},1)},selectAll:function(t){return t&&(i.q=t,i.svg=d3.selectAll(t)),i.svg},$dots:function(){return s.dots}}},pingsSvg:function(){function t(){var t=this,e=this._;e.options.showPings=!0,setInterval(function(){return n.call(t)},3e3),r.svg=e.svg}function e(){if(r.svg.selectAll(".pings").remove(),r.dataPings&&this._.options.showPings){var t=r.svg.append("g").attr("class","pings");a.ping2=t.selectAll(".ping-2").data(r.dataPings.features).enter().append("circle").attr("class","ping-2").attr("id",function(t,e){return"ping-"+e}),a.pings=t.selectAll(".ping-2"),o.call(this),n.call(this)}}function n(){var t=a.ping2.nodes().filter(function(t){return"inline"==t.style.display});t.length>0&&d3.select("#"+t[Math.floor(Math.random()*(t.length-1))].id).attr("r",2).attr("stroke","#F00").attr("stroke-opacity",1).attr("stroke-width","10px").transition().duration(1e3).attr("r",30).attr("fill","none").attr("stroke-width","0.1px")}function o(){if(null==this._.drag)a.pings.style("display","none");else if(!this._.drag&&a.pings&&this._.options.showPings){var t=this._.proj,e=this._.proj.invert(this._.center);a.pings.attr("cx",function(e){return t(e.geometry.coordinates)[0]}).attr("cy",function(e){return t(e.geometry.coordinates)[1]}).style("display",function(t){return d3.geoDistance(t.geometry.coordinates,e)>1.57?"none":"inline"})}}var r={svg:null,dataPings:null},a={};return{name:"pingsSvg",onInit:function(e){r.me=e,t.call(this)},onCreate:function(){e.call(this)},onRefresh:function(){o.call(this)},data:function(t){if(!t)return r.dataPings;r.dataPings=t},selectAll:function(t){return t&&(r.q=t,r.svg=d3.selectAll(t)),r.svg},$pings:function(){return a.pings}}},pinCanvas:function(t,e){function n(t){this._.options.showPin=!0;var e=this._.proj.scale();i.w=d3.scaleLinear().domain([0,e]).range([0,t[0]]),i.h=d3.scaleLinear().domain([0,e]).range([0,t[1]]),r.call(this)}function o(){if(this._.options.showPin){var t=this._,e=t.proj.invert(t.center);this.canvasPlugin.render(function(n){i.dataPin.features.forEach(function(o){var r=o.geometry.coordinates;if(d3.geoDistance(r,e)<=1.57){var a=t.path.centroid(o);n.drawImage(i.image,a[0]-i.pX,a[1]-i.pY,i.wh[0],i.wh[1])}})},i.drawTo)}}function r(){var t=this._.proj.scale(),e=[i.w(t),i.h(t)];i.wh=e,i.pX=e[0]/2,i.pY=e[1]}var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[15,25],i={dataPin:null,image:null,w:null,h:null};return d3.select("body").append("img").attr("src",e).attr("id","pin").attr("width","0").attr("height","0"),i.image=document.getElementById("pin"),{name:"pinCanvas",urls:t&&[t],onReady:function(t,e){i.me.data(e)},onInit:function(t){i.me=t,n.call(this,a)},onCreate:function(){var t=this;setTimeout(function(){return o.call(t)},1)},onResize:function(){r.call(this)},onRefresh:function(){o.call(this)},data:function(t){if(!t)return i.dataPin;i.dataPin=t},drawTo:function(t){i.drawTo=t},image:function(){return i.image},size:function(t){if(!t)return i.wh;i.wh=t,n.call(this,t)}}},dotsCanvas:function(t){function e(){var t=this._;if((!t.drag||o)&&r.dataDots&&this._.options.showDots){var e=this._.proj,n=r.dataDots.geometry||{},a=e.invert(this._.center),i=[],s=[];r.dots.forEach(function(t){d3.geoDistance(t.coordinates,a)>1.57?i.push(t.circle):s.push(t.circle)}),(t.options.transparent||t.options.transparentDots)&&this.canvasPlugin.flipRender(function(t,e){t.beginPath(),e({type:"GeometryCollection",geometries:i}),t.lineWidth=.2,t.strokeStyle="rgba(119,119,119,.4)",t.stroke()},r.drawTo),this.canvasPlugin.render(function(t,e){t.beginPath(),e({type:"GeometryCollection",geometries:s}),t.lineWidth=n.lineWidth||.2,t.fillStyle=n.fillStyle||"rgba(100,0,0,.4)",t.strokeStyle=n.strokeStyle||"rgba(100,0,0,.6)",t.fill(),t.stroke()},r.drawTo)}}function n(){var t=d3.geoCircle(),e=(r.dataDots.geometry||{}).radius||.5;r.dots=r.dataDots.features.map(function(n){var o=n.geometry.coordinates,r=n.properties,a=n.geometry.radius||e;return{properties:r,coordinates:o,circle:t.center(o).radius(a)()}})}var o=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).important,r={dataDots:null,dots:[],radiusPath:null};return{name:"dotsCanvas",urls:t&&[t],onReady:function(t,e){r.me.data(e)},onInit:function(t){r.me=t,this._.options.transparentDots=!1,this._.options.showDots=!0},onCreate:function(){e.call(this)},onRefresh:function(){(o||!0!==this._.drag)&&e.call(this)},radiusPath:function(t){r.radiusPath=t},data:function(t){var o=this;if(!t)return r.dataDots;if(r.radiusPath){var a=r.radiusPath.split("."),i=t.features.map(function(t){var e=t;return a.forEach(function(t){return e=e[t]}),e}).sort(),s=d3.scaleLinear().domain([i[0],i.pop()]).range([.5,2]);t.features.forEach(function(t){var e=t;a.forEach(function(t){return e=e[t]}),t.geometry.radius=s(e)})}r.dataDots=t,n(),setTimeout(function(){return e.call(o)},1)},drawTo:function(t){r.drawTo=t},dots:function(){return r.dots}}},pingsCanvas:function(){function t(t){if(t-n>40&&(n=t,!this._.drag&&this._.options.showPings)){var o=void 0,r=this._.proj;if(e.pings.length<=7){o=this._.proj.invert(this._.center);var a=e.dataPings.features.filter(function(t){return d3.geoDistance(t.geometry.coordinates,o)<=1.57}),i=a[Math.floor(Math.random()*(a.length-1))];e.pings.push({r:2.5,l:i.geometry.coordinates})}var s=e.pings[0];d3.geoDistance(s.l,this._.proj.invert(this._.center))>1.57?e.pings.shift():(this._.options.spin||this._.refresh(/anvas/),this.canvasPlugin.render(function(t){if(t.beginPath(),t.fillStyle="#F80",t.arc(r(s.l)[0],r(s.l)[1],s.r,0,2*Math.PI),t.fill(),t.closePath(),s.r=s.r+.2,s.r>5)e.pings.shift();else if(e.pings.length>1){var n=e.pings.shift();e.pings.push(n)}},e.drawTo))}}var e={dataPings:null,pings:[]},n=0;return{name:"pingsCanvas",onInit:function(t){e.me=t,this._.options.showPings=!0},onInterval:function(e){t.call(this,e)},data:function(t){if(!t)return e.dataPings;e.dataPings=t},drawTo:function(t){e.drawTo=t}}},centerCanvas:function(){function t(t,e){e=(""+e).replace("x","");for(var n=0,o=t.length;n<o;n++)if(t[n].id==e)return t[n]}function e(t){var e=this._,n=d3.interpolate(e.proj.rotate(),[-t[0],-t[1],0]),o=function(t){return e.rotate(n(t))};d3.transition().duration(2500).tween("rotate",function(){return o})}function n(){var t=this;this.clickCanvas&&this.clickCanvas.onCountry({centerCanvas:function(n,r){r&&(e.call(t,d3.geoCentroid(r)),"function"==typeof o.focused&&(o.focused.call(t,n,r),t.threejsPlugin&&t.threejsPlugin.rotate()))}})}var o={focused:null};return{name:"centerCanvas",onInit:function(t){o.me=t,this._.options.enableCenter=!0},onCreate:function(){n.call(this)},go:function(n){var o=t(this.worldCanvas.countries(),n),r=d3.geoCentroid(o);e.call(this,r)},focused:function(t){o.focused=t}}},flattenSvg:function(){function t(){var t=this._.proj,e=d3.geoEquirectangular().scale(this._.options.width/6.3).translate(this._.center);r.g1=t,r.g2=e}function e(){var t=this;return t._.svg.transition().duration(10500).tween("projection",function(){return function(n){e.alpha(n),t._.refresh()}})}function n(t,n){var o=d3.geoProjection(function(e,o){var a=t([e*=180/Math.PI,o*=180/Math.PI]),i=n([e,o]);return[(1-r)*a[0]+r*i[0],(r-1)*a[1]-r*i[1]]}).scale(1),r=void 0;return e.alpha=function(e){if(!arguments.length)return r;r=+e;var a=t.center(),i=n.center(),s=t.translate(),l=n.translate();return o.center([(1-r)*a[0]+r*i[0],(1-r)*a[1]+r*i[1]]),o.translate([(1-r)*s[0]+r*l[0],(1-r)*s[1]+r*l[1]]),o},e.alpha(0),o}function o(){var t=this._;return d3.transition().duration(1500).tween("rotate",function(){t.rotate(t.proj.rotate());var e=d3.interpolate(t.proj.rotate(),[0,0,0]);return function(n){t.rotate(e(n))}})}var r={};return{name:"flattenSvg",onInit:function(e){r.me=e,t.call(this)},toMap:function(){var t=this;o.call(this).on("end",function(){var o=n(r.g1,r.g2);t._.path=d3.geoPath().projection(o),e.call(t).on("end",function(){t._.options.enableCenter=!1})})},toGlobe:function(){var t=this;this._.rotate([0,0,0]);var o=n(r.g2,r.g1);this._.path=d3.geoPath().projection(o),e.call(this).on("end",function(){t._.path=d3.geoPath().projection(t._.proj),t._.options.enableCenter=!0,t._.refresh()})}}},barThreejs:function(t){function e(t){for(var e=new THREE.BoxGeometry(2,2,t),n=0;n<e.faces.length;n+=2){var o=16777215*Math.random();e.faces[n].color.setHex(o),e.faces[n+1].color.setHex(o)}return e}function n(t,e){var n=.017453292519943295*(90-t.coordinates[1]),o=.017453292519943295*(360-t.coordinates[0]);t.position.x=e*Math.sin(n)*Math.cos(o),t.position.y=e*Math.cos(n),t.position.z=e*Math.sin(n)*Math.sin(o),t.lookAt({x:0,y:0,z:0})}function o(){var t=this.threejsPlugin;if(!a.sphereObject){var o=new THREE.Group,s=this._.proj.scale();a.max=d3.max(a.data.features,function(t){return parseInt(t.geometry.value)}),a.scale=d3.scaleLinear().domain([0,a.max]).range([2,70]),a.data.features.forEach(function(t){var l=t.geometry.value,c=l?a.scale(l):r,u=e(c),d=new THREE.Mesh(u,i);d.coordinates=t.geometry.coordinates,n(d,c/2+s),d.ov=c,o.add(d)}),a.sphereObject=o,a.sphereObject.name=a.me.name}t.addGroup(a.sphereObject)}var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,a={sphereObject:null,data:null},i=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,morphTargets:!1,color:11206655});return{name:"barThreejs",urls:t&&[t],onReady:function(t,e){a.me.data(e)},onInit:function(t){a.me=t},onCreate:function(){o.call(this)},data:function(t){if(!t)return a.data;if(a.valuePath){var e=a.valuePath.split(".");t.features.forEach(function(t){var n=t;e.forEach(function(t){return n=n[t]}),t.geometry.value=n})}a.data=t},scale:function(t){a.sphereObject.children.forEach(function(e){e.scale.x=t,e.scale.y=t,e.scale.z=t})},sphere:function(){return a.sphereObject},color:function(t){i.color.set(t),i.needsUpdate=!0,this.threejsPlugin.renderThree()}}},hmapThreejs:function(t){function e(){this._.options.showHmap=!0;var e=this._.proj.scale();if(r.geometry=new THREE.SphereGeometry(e,30,30),a.canvas=d3.select("body").append("canvas").style("position","absolute").style("display","none").style("top","450px").attr("id","webgl-hmap"),r.canvas=a.canvas.node(),r.heatmap=createWebGLHeatmap({intensityToAlpha:!0,width:1024,height:512,canvas:r.canvas}),r.texture=new THREE.Texture(r.canvas),r.material.map=r.texture,!t){a.canvas.style("display","inherit");var n=function(t,e){for(var n=0;n<200;){var o=2*Math.random()-1,a=2*Math.random()-1,i=o*o+a*a;if(!(i>1)){var s=Math.sqrt(i);o/=s,a/=s,o*=1-i,a*=1-i,n+=1,r.heatmap.addPoint(t+50*o,e+50*a,30,2/300)}}},o=function(t){t.preventDefault();for(var e=t.changedTouches,o=0;o<e.length;o++){var r=e[o];n(r.pageX,r.pageY)}};r.canvas.addEventListener("touchmove",o,!1),r.canvas.onmousemove=function(t){var e=t.offsetX||t.clientX,o=t.offsetY||t.clientY;n(e,o)},r.canvas.onclick=function(){r.heatmap.clear()}}}function n(){var t=this.threejsPlugin;r.sphereObject||(r.sphereObject=new THREE.Mesh(r.geometry,r.material),r.sphereObject.name=r.me.name),r.texture.needsUpdate=!0,t.addGroup(r.sphereObject)}function o(){r.heatmap.update(),r.heatmap.display()}var r={sphereObject:null,material:new THREE.MeshBasicMaterial({transparent:!0})},a={canvas:null};return{name:"hmapThreejs",urls:t&&[t],onReady:function(t,e){r.me.data(e)},onInit:function(t){r.me=t,e.call(this)},onInterval:function(){t||(r.texture.needsUpdate=!0)},onCreate:function(){n.call(this)},onRefresh:function(){o.call(this)},data:function(t){if(!t)return r.world;r.world=t,r.countries=topojson.feature(t,t.objects.countries)},sphere:function(){return r.sphereObject}}},dotsThreejs:function(t){function e(){this._.options.showDots=!0}function n(t){var e=this.threejsPlugin,n=new THREE.MeshBasicMaterial({color:t.geometry.color||12687769,side:THREE.DoubleSide,transparent:!0,depthWrite:!1,depthTest:!0,opacity:.5}),o=10*(t.geometry.radius||.5),r=new THREE.CircleBufferGeometry(o,25),a=new THREE.Mesh(r,n),i=e.vertex(t.geometry.coordinates);return a.position.set(i.x,i.y,i.z),a.lookAt({x:0,y:0,z:0}),a}function o(t){var e=!0,n=!1,o=void 0;try{for(var r,i=a.onHoverVals[Symbol.iterator]();!(e=(r=i.next()).done);e=!0)r.value.call(t.target,t)}catch(t){n=!0,o=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw o}}}function r(){var t=this,e=this.threejsPlugin;a.sphereObject||(a.sphereObject=new THREE.Group,a.sphereObject.name=a.me.name,a.dataDots.features.forEach(function(r){var i=n.call(t,r);i.__data__=r,a.sphereObject.add(i),e.domEvents&&e.domEvents.addEventListener(i,"mousemove",o,!1)})),e.addGroup(a.sphereObject)}var a={dataDots:null,onHover:{},onHoverVals:[]};return{name:"dotsThreejs",urls:t&&[t],onReady:function(t,e){a.me.data(e)},onInit:function(t){a.me=t,e.call(this)},onCreate:function(){r.call(this)},data:function(t){if(!t)return a.dataDots;a.dataDots=t},onHover:function(t){Object.assign(a.onHover,t),a.onHoverVals=Object.keys(a.onHover).map(function(t){return a.onHover[t]})},sphere:function(){return a.sphereObject}}},dotsCThreejs:function(t){function e(){var t=void 0,e=this._.options;e.showDots=!0,this.canvasThreejs.onDraw({dotsCThreejs:function(n,r){if(e.showDots){t||(t=o.dots.map(function(t){return t.circle}));var a=o.dataDots.geometry||{};n.beginPath(),r({type:"GeometryCollection",geometries:t}),n.lineWidth=a.lineWidth||.2,n.fillStyle=a.fillStyle||"rgba(100,0,0,.4)",n.strokeStyle=a.strokeStyle||"rgba(100,0,0,.6)",n.fill(),n.stroke()}}})}function n(){var t=d3.geoCircle(),e=(o.dataDots.geometry||{}).radius||.5;o.dots=o.dataDots.features.map(function(n){var o=n.geometry.coordinates,r=n.properties,a=n.geometry.radius||e;return{properties:r,coordinates:o,circle:t.center(o).radius(a)()}})}var o={dataDots:null};return{name:"dotsCThreejs",urls:t&&[t],onReady:function(t,e){o.me.data(e)},onInit:function(t){o.me=t,e.call(this)},data:function(t){if(!t)return o.dataDots;o.dataDots=t,n()}}},iconsThreejs:function(t,e){function n(t,e){var n=.017453292519943295*(90-t.coordinates[1]),o=.017453292519943295*(360-t.coordinates[0]);t.position.x=e*Math.sin(n)*Math.cos(o),t.position.y=e*Math.cos(n),t.position.z=e*Math.sin(n)*Math.sin(o),t.lookAt({x:0,y:0,z:0})}function o(){var t=this.threejsPlugin;if(!i.sphereObject){var e=new THREE.Group,o=this._.proj.scale();i.data.features.forEach(function(t){var r=new THREE.PlaneGeometry(1,1,1,1),a=new THREE.Mesh(r,i.material);a.coordinates=t.geometry.coordinates,n(a,o+1),a.scale.set(6,6,1),e.add(a)}),i.sphereObject=e,i.sphereObject.name=i.me.name}t.addGroup(i.sphereObject)}function r(){var t=this.threejsPlugin;this._.options.showIcons=!0,i.material=new THREE.MeshPhongMaterial({side:THREE.DoubleSide,transparent:!0,map:t.texture(e)}),i.data&&!i.loaded&&(o.call(this),t.rotate())}function a(){i.material&&!i.loaded&&o.call(this)}var i={sphereObject:null};return{name:"iconsThreejs",urls:t&&[t],onReady:function(t,e){i.me.data(e)},onInit:function(t){i.me=t,r.call(this)},onCreate:function(){a.call(this)},data:function(t){if(!t)return i.data;if(i.valuePath){var e=i.valuePath.split(".");t.features.forEach(function(t){var n=t;e.forEach(function(t){return n=n[t]}),t.geometry.value=n})}i.data=t},scale:function(t){i.sphereObject.children.forEach(function(e){e.scale.set(t+2,t+2,1)})},sphere:function(){return i.sphereObject}}},canvasThreejs:function(t){function e(){var t=2*l,e=this._.proj.scale();c.geometry=new THREE.SphereGeometry(e,30,30),c.newCanvas=d3.select("body").append("canvas").style("display","none").attr("class","ej-canvas-new").node(),c.newContext=c.newCanvas.getContext("2d"),c.texture=new THREE.Texture(c.newCanvas),c.texture.transparent=!0,c.material.map=c.texture,c.canvas=d3.select("body").append("canvas").style("display","none").attr("width",t).attr("height",l).attr("class","ej-canvas-ctx").node(),c.context=c.canvas.getContext("2d"),c.proj=d3.geoEquirectangular().scale(t/s).translate([t/2,l/2]),c.path=d3.geoPath().projection(c.proj).context(c.context),c.path2=d3.geoPath().projection(c.proj).context(c.newContext),c.newCanvas.width=c.canvas.width,c.newCanvas.height=c.canvas.height,c.me._=c}function n(t){var e=!0,n=!1,o=void 0;try{for(var r,a=c.onHoverVals[Symbol.iterator]();!(e=(r=a.next()).done);e=!0)r.value.call(t.target,t)}catch(t){n=!0,o=t}finally{try{!e&&a.return&&a.return()}finally{if(n)throw o}}}function o(){var t=this,e=this.threejsPlugin;c.sphereObject||(a.call(this),c.sphereObject=new THREE.Mesh(c.geometry,c.material),c.sphereObject.name=c.me.name,e.domEvents&&e.domEvents.addEventListener(c.sphereObject,"mousemove",n,!1)),c.onDrawVals.forEach(function(e){e.call(t,c.newContext,c.path)}),c.texture.needsUpdate=!0,e.addGroup(c.sphereObject)}function r(){if(this._.options.choropleth){for(var t=c.countries.features.length;t--;){var e=c.countries.features[t];c.context.beginPath(),c.path(e),c.context.fillStyle=e.properties.color||c.style.countries||"rgba(2, 20, 37,0.8)",c.context.fill()}return!0}return c.path(c.countries),c.context.fillStyle=c.style.countries||"rgba(2, 20, 37,0.8)",c.context.fill(),!1}function a(){var t=this._.options;c.style.ocean?(c.context.fillStyle=c.style.ocean,c.context.fillRect(0,0,c.canvas.width,c.canvas.height)):c.context.clearRect(0,0,c.canvas.width,c.canvas.height);var e=t.showBorder;if(c.context.beginPath(),e||r.call(this),t.showBorder||void 0===t.showBorder){var n=u(this._.proj.scale());n<1&&(n=1),e&&c.path(c.allCountries),c.context.lineWidth=n,c.context.strokeStyle=c.style.border||"rgb(239, 237, 234)",c.context.stroke()}c.newContext.drawImage(c.canvas,0,0),c.refresh=!0}function i(){if(c.refresh&&this.hoverCanvas&&this._.options.showSelectedCountry){c.refresh=!1,c.newContext.clearRect(0,0,c.canvas.width,c.canvas.height),c.newContext.drawImage(c.canvas,0,0),c.selected.features.length>0&&(c.newContext.beginPath(),c.path2(c.selected),c.newContext.fillStyle=c.style.selected||"rgba(87, 255, 99, 0.5)",c.newContext.fill());var t=this.hoverCanvas.states().country;t&&!c.selected.features.find(function(e){return e.id===t.id})&&(c.newContext.beginPath(),c.path2(t),c.newContext.fillStyle=c.style.hover||"rgba(117, 0, 0, 0.5)",c.newContext.fill()),c.texture.needsUpdate=!0,this.threejsPlugin.renderThree()}}var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6.279,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2048,c={world:null,sphereObject:null,onHover:{},onHoverVals:[],style:{},onDraw:{},onDrawVals:[],countries:{type:"FeatureCollection",features:[]},selected:{type:"FeatureCollection",features:[]},material:new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,alphaTest:.5})},u=d3.scaleLinear().domain([30,450]).range([10,2]);return{name:"canvasThreejs",urls:t&&[t],onReady:function(t,e){c.me.data(e)},onInit:function(t){c.me=t,e.call(this)},onCreate:function(){this.worldJson&&!c.world&&c.me.data(this.worldJson.data()),o.call(this)},onResize:function(){a.call(this)},onRefresh:function(){i.call(this)},onDraw:function(t){Object.assign(c.onDraw,t),c.onDrawVals=Object.keys(c.onDraw).map(function(t){return c.onDraw[t]})},countries:function(t){if(!t)return c.countries.features;c.countries.features=t},selectedCountries:function(t){if(!t)return c.selected.features;c.selected.features=t},data:function(t){if(!t)return c.world;c.world=t,c.allCountries=topojson.feature(t,t.objects.countries),c.countries.features=c.allCountries.features},allData:function(t){if(!t)return{world:c.world,countries:c.countries};c.world=t.world,c.countries=t.countries},style:function(t){return t&&(c.style=t),c.style},reload:function(){a.call(this),i.call(this)},refresh:function(){c.refresh=!0,i.call(this)},onHover:function(t){Object.assign(c.onHover,t),c.onHoverVals=Object.keys(c.onHover).map(function(t){return c.onHover[t]})},sphere:function(){return c.sphereObject}}},pointsThreejs:function(t){function e(){this._.options.showPoints=!0}function n(t){var e=!0,n=!1,o=void 0;try{for(var a,i=r.onHoverVals[Symbol.iterator]();!(e=(a=i.next()).done);e=!0)a.value.call(t.target,t)}catch(t){n=!0,o=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw o}}}function o(){var t=this.threejsPlugin;if(!r.sphereObject){var e=new THREE.Geometry;r.dataPoints.features.forEach(function(n){var o=new THREE.Vector3,r=t.vertex(n.geometry.coordinates);o.x=r.x,o.y=r.y,o.z=r.z,e.vertices.push(o)});var o=new THREE.PointsMaterial({color:16711680,size:30}),a=new THREE.Points(e,o);r.sphereObject=a,r.sphereObject.name=r.me.name,t.domEvents&&t.domEvents.addEventListener(a,"mousemove",n,!1)}t.addGroup(r.sphereObject)}var r={dataPoints:null,onHover:{},onHoverVals:[]};return{name:"pointsThreejs",urls:t&&[t],onReady:function(t,e){r.me.data(e)},onInit:function(t){r.me=t,e.call(this)},onCreate:function(){o.call(this)},data:function(t){if(!t)return r.dataPoints;r.dataPoints=t},onHover:function(t){Object.assign(r.onHover,t),r.onHoverVals=Object.keys(r.onHover).map(function(t){return r.onHover[t]})},sphere:function(){return r.sphereObject}}},textureThreejs:function(){function t(){var t=this._,e=t.proj.scale(),o=t.options.width,i=t.options.height;this._.options.showDrawing=!0,a=new THREE.SphereGeometry(e,30,30);var s=d3.select("body").append("canvas");s.attr("height",i).attr("width",o),n.canvas=s.node(),n.context=n.canvas.getContext("2d"),n.texture=new THREE.Texture(n.canvas),n.canvas.width=n.canvas.height=512,n.texture.needsUpdate=!0,r.map=n.texture;var l=d3.geoMercator().scale(o/2/Math.PI).translate([o/2,i/2]).precision(.5);n.path=d3.geoPath(l,n.context)}function e(){var t=this._,e=this.threejsPlugin,i=t.options,s=i.width,l=i.height;n.sphereObject||(n.context.fillStyle="white",n.context.fillRect(0,0,s,l),n.context.beginPath(),n.path(o),n.context.lineWidth=.4,n.context.strokeStyle="rgba(119,119,119,0.6)",n.context.stroke(),n.sphereObject=new THREE.Mesh(a,r),n.sphereObject.name=n.me.name,n.texture.needsUpdate=!1),e.addGroup(n.sphereObject)}var n={},o=d3.geoGraticule()(),r=new THREE.MeshBasicMaterial,a=void 0;return{name:"textureThreejs",onInit:function(e){n.me=e,t.call(this)},onCreate:function(){e.call(this)},sphere:function(){return n.sphereObject}}},graticuleThreejs:function(){function t(){this._.options.showGraticule=!0,o.graticule10=e()}function e(){function t(t,e,o){var r=d3.range(t,e-n,o).concat(e);return function(t){return r.map(function(e){return[t,e]})}}function e(t,e,o){var r=d3.range(t,e-n,o).concat(e);return function(t){return r.map(function(e){return[e,t]})}}var n=1e-6,o=t(-80,80,2.5),r=e(-180,180,2.5),a=t(-90,90,2.5),i=e(-180,180,2.5);return{type:"MultiLineString",coordinates:d3.range(90*Math.ceil(-2),180,90).map(a).concat(d3.range(360*Math.ceil(-.25),90,360).map(i)).concat(d3.range(10*Math.ceil(-18),180,10).filter(function(t){return Math.abs(t%90)>n}).map(o)).concat(d3.range(10*Math.ceil(-8),80+n,10).filter(function(t){return Math.abs(t%360)>n}).map(r))}}function n(){var t=this.threejsPlugin;if(!o.sphereObject){var e=new THREE.LineBasicMaterial({color:11184810});o.sphereObject=t.wireframe(o.graticule10,e),o.sphereObject.name=o.me.name}t.addGroup(o.sphereObject)}var o={sphereObject:null};return{name:"graticuleThreejs",onInit:function(e){o.me=e,t.call(this)},onCreate:function(){n.call(this)},sphere:function(){return o.sphereObject}}},flightLineThreejs:function(t,e){function n(t){for(var e=0;e<y.data.length;++e){var n=y.data[e][0],i=y.data[e][1],s=y.data[e][2],l=y.data[e][3],c=y.data[e][4];if(n!==s||i!==l){for(var u=[],d=Math.random()*m+.05,h=0;h<9;h++){var f=180*h/8,p=t+Math.sin(f*b)*d,v=a(n,i,s,l,h/8),g=o(v.lat,v.lng,p);u.push(new THREE.Vector3(g.x,g.y,g.z))}for(var w=[],j=new THREE.CatmullRomCurve3(u),T=r(n,i,s,l,t),k=0;k<T;k+=x){var H=k/T;w.push(j.getPoint(H))}var S=T/(2*Math.PI)*24901;S<C&&(C=S),S>E&&(E=parseInt(1e3*Math.ceil(S/1e3)),_=E);var O=c?y.color(c):"rgb(255,255,255)",D=600*Math.random()+400,A=D*R,I=parseInt(T/x)+1,V=A*I;M+=I,P.push({spline:j,num_points:I,spd_points:V,arc_distance:T,arc_distance_miles:S,point_positions:w,default_speed:D,value:c,color:O,speed:A})}}}function o(t,e,n){var o=(90-t)*b,r=(360-e)*b;return{x:n*Math.sin(o)*Math.cos(r),y:n*Math.cos(o),z:n*Math.sin(o)*Math.sin(r)}}function r(t,e,n,o,r){var a=Math.sin((n-t)*b/2)*Math.sin((n-t)*b/2)+Math.cos(t*b)*Math.cos(n*b)*Math.sin((o-e)*b/2)*Math.sin((o-e)*b/2);return r*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))}function a(t,e,n,o,r){t*=b,e*=b,n*=b,o*=b;var a=2*Math.asin(Math.sqrt(Math.pow(Math.sin((t-n)/2),2)+Math.cos(t)*Math.cos(n)*Math.pow(Math.sin((e-o)/2),2))),i=Math.sin((1-r)*a)/Math.sin(a),s=Math.sin(r*a)/Math.sin(a),l=i*Math.cos(t)*Math.cos(e)+s*Math.cos(n)*Math.cos(o),c=i*Math.cos(t)*Math.sin(e)+s*Math.cos(n)*Math.sin(o),u=i*Math.sin(t)+s*Math.sin(n);return{lat:180*Math.atan2(u,Math.sqrt(Math.pow(l,2)+Math.pow(c,2)))/Math.PI,lng:180*Math.atan2(c,l)/Math.PI}}function i(){H=new Float32Array(3*M);for(var t=new Float32Array(3*M),e=new Float32Array(M),n=new Float32Array(M),o=0,r=0;r<P.length;++r){for(var a=P[r],i=a.value,s=a.color,l=a.point_positions,c=new THREE.Color(s),u=c.r,d=c.g,h=c.b,f=y.point(i||1),p=0;p<l.length;++p)H[3*o+0]=0,H[3*o+1]=0,H[3*o+2]=0,t[3*o+0]=u,t[3*o+1]=d,t[3*o+2]=h,e[o]=i||1,n[o]=f,++o;k[r]=[]}var v=new THREE.BufferGeometry;return v.addAttribute("position",new THREE.BufferAttribute(H,3)),v.addAttribute("customColor",new THREE.BufferAttribute(t,3)),v.addAttribute("value",new THREE.BufferAttribute(e,1)),v.addAttribute("size",new THREE.BufferAttribute(n,1)),v.computeBoundingBox(),y.track_points_object=new THREE.Points(v,y.shaderMaterial),y.attr_position=y.track_points_object.geometry.attributes.position,y.track_points_object}function s(){for(var t=P.length,e=Date.now(),n=0,o=0;o<t;++o){var r=P[o],a=r.speed,i=r.spline,s=r.num_points,c=r.spd_points,u=r.arc_distance;if(r.arc_distance_miles<=_)for(var d=x/u,h=e%a/c,f=0;f<s;f++){var p=l(o,f*d+h,i),v=p.x,g=p.y,m=p.z,w=3*n;H[w+0]=v,H[w+1]=g,H[w+2]=m,n++}else for(var b=0;b<s;b++){var j=3*n;H[j+0]=1/0,H[j+1]=1/0,H[j+2]=1/0,n++}}y.attr_position.needsUpdate=!0}function l(t,e,n){var o=k[t],r=parseInt(1e3*e);return void 0===o[r]&&(o[r]=n.getPoint(e)),o[r]}function c(){for(var t=P.length,e=6*t*S,n=new THREE.BufferGeometry,o=new Float32Array(e),r=new Float32Array(e),a=0;a<t;++a)for(var i=a*S,s=P[a],l=s.spline,c=s.color,u=new THREE.Color(c),d=u.r,h=u.g,f=u.b,p=0;p<O;++p){var v=p+1,g=l.getPoint(p/O),m=l.getPoint(v/O);r[w+0]=g.x,r[w+1]=g.y,r[w+2]=g.z,r[w+3]=m.x,r[w+4]=m.y,r[w+5]=m.z;var w=6*(p+i);o[w+0]=d,o[w+1]=h,o[w+2]=f,o[w+3]=d,o[w+4]=h,o[w+5]=f}return n.addAttribute("position",new THREE.BufferAttribute(r,3)),n.addAttribute("color",new THREE.BufferAttribute(o,3)),n.computeBoundingSphere(),y.track_lines_object=new THREE.Line(n,D,THREE.LineSegments),y.track_lines_object}function u(){for(var t=P.length,e=new THREE.Group,n=w(this._.proj.scale()),o=0;o<t;++o){for(var r=P[o],a=r.spline,i=r.color,s=new Float32Array(3*S),l=new MeshLineMaterial({color:new THREE.Color(i),useMap:!1,opacity:1,lineWidth:n}),c=0;c<=O;++c){var u=3*c,d=a.getPoint(c/O),h=d.x,f=d.y,p=d.z;s[u+0]=h,s[u+1]=f,s[u+2]=p}var v=new MeshLine;v.setGeometry(s),e.add(new THREE.Mesh(v.geometry,l))}return y.track_lines_object=e,y.track_lines_object}function d(){var t={color:{type:"c",value:new THREE.Color(11184810)},texture:{type:"t",value:y.texture},opacity:{type:"f",value:T}};y.shaderMaterial=new THREE.ShaderMaterial({uniforms:t,vertexShader:A,fragmentShader:I,blending:THREE.AdditiveBlending,depthTest:!0,depthWrite:!1,transparent:!0});var e=new THREE.Group;n(y.SCALE+1),e.add(window.MeshLineMaterial?u.call(this):c.call(this)),e.add(i.call(this)),e.name="flightLineThreejs",this.threejsPlugin.domEvents&&this.threejsPlugin.domEvents.addEventListener(y.track_lines_object,"mousemove",function(t){var e=!0,n=!1,o=void 0;try{for(var r,a=y.onHoverVals[Symbol.iterator]();!(e=(r=a.next()).done);e=!0)r.value.call(t.target,t)}catch(t){n=!0,o=t}finally{try{!e&&a.return&&a.return()}finally{if(n)throw o}}},!1),y.sphereObject=e,y.sphereObject.name=y.me.name,y.loaded=!0}function h(){y.SCALE=this._.proj.scale(),y.texture=this.threejsPlugin.texture(e)}function f(){!y.texture||y.sphereObject||y.loaded||d.call(this),this.threejsPlugin.addGroup(y.sphereObject)}function p(){P=[],k=[];var t=this.threejsPlugin;d.call(this);var e=t.group(),n=e.children,o=n.findIndex(function(t){return"flightLineThreejs"===t.name});e.remove(n[o]),e.add(y.sphereObject),t.renderThree()}function v(t){t-V>30&&(V=t,s(),this.threejsPlugin.renderThree())}function g(){var t=this._.proj.scale(),e=y.resize(t),n=y.sphereObject.children[1].geometry.attributes,o=n.size,r=n.value;o.array=r.array.map(function(t){return y.point(t)*e}),o.needsUpdate=!0,window.MeshLineMaterial&&y.track_lines_object.children.forEach(function(e){e.material.uniforms.lineWidth.value=w(t),e.material.needsUpdate=!0})}var m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:150,y={data:[],sphereObject:null,track_lines_object:null,track_points_object:null,lightFlow:!0,linewidth:3,texture:null,maxVal:1,onHover:{},onHoverVals:[]},w=d3.scaleLinear().domain([30,2500]).range([.001,.005]),b=Math.PI/180,j=[d3.rgb("#ff0000"),d3.rgb("#aaffff")],C=1/0,E=-1/0,_=0,x=100,T=.8,R=1,k=[],P=[],M=0,H=void 0,S=24,O=S-1,D=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,opacity:.4,transparent:!0,depthWrite:!1,depthTest:!0,color:16777215,linewidth:y.linewidth}),A="\n    attribute float size;\n    attribute vec3 customColor;\n    varying vec3 vColor;\n\n    void main() {\n        vColor = customColor;\n        vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n        gl_PointSize = size * ( 300.0 / length( mvPosition.xyz ) );\n        gl_Position = projectionMatrix * mvPosition;\n    }",I="\n    uniform vec3 color;\n    uniform sampler2D texture;\n    uniform float opacity;\n\n    varying vec3 vColor;\n\n    void main() {\n        gl_FragColor = vec4( color * vColor, opacity );\n        gl_FragColor = gl_FragColor * texture2D( texture, gl_PointCoord );\n    }",V=0;return{name:"flightLineThreejs",urls:t&&[t],onReady:function(t,e){y.me.data(e)},onInit:function(t){y.me=t,h.call(this),this._.options.showFlightLine=!0},onResize:function(){g.call(this)},onInterval:function(t){!this._.drag&&y.lightFlow&&v.call(this,t)},onCreate:function(){f.call(this)},onHover:function(t){Object.assign(y.onHover,t),y.onHoverVals=Object.keys(y.onHover).map(function(t){return y.onHover[t]})},reload:function(){p.call(this)},data:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[50,500],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:150,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.8;if(!t)return y.data;if(y.data=t,e){Array.isArray(e)||(e=["#ff0000","#aaffff"]);var a=d3.extent(t.map(function(t){return t[4]}));j=[d3.rgb(e[0]),d3.rgb(e[1])],y.color=d3.scaleLinear().domain(a).interpolate(d3.interpolateHcl).range(j),y.point=d3.scaleLinear().domain(a).range(n),y.maxVal=a[1]}else y.color=function(){return"rgb(255, 255, 255)"},y.point=function(){return 150},y.maxVal=1;m=o,T=r,y.resize=d3.scaleLinear().domain([30,this._.proj.scale()]).range([.1,1])},sphere:function(){return y.sphereObject},pointSize:function(t){var e=y.sphereObject.children[1].geometry.attributes.size;e.array=e.array.map(function(e){return e*t}),e.needsUpdate=!0},lightFlow:function(t){if(void 0===t)return y.lightFlow;y.lightFlow=t}}},debugThreejs:function(){function t(){this._.options.showDebugSpahre=!0}function e(){var t=this.threejsPlugin;if(!n.sphereObject){var e=this._.proj.scale();n.scale=d3.scaleLinear().domain([0,e]).range([0,1]);var o=new THREE.SphereGeometry(e,100,100),r=new THREE.MeshNormalMaterial({wireframe:!1}),a=new THREE.Mesh(o,r),i=new THREE.SphereGeometry(30,10,10),s=new THREE.SphereGeometry(30,10,10),l=new THREE.SphereGeometry(30,10,10);i.translate(0,0,e),s.translate(e,0,0),l.translate(0,-e,0);var c=new THREE.MeshBasicMaterial({color:"blue"}),u=new THREE.MeshBasicMaterial({color:"red"}),d=new THREE.MeshBasicMaterial({color:"green"}),h=new THREE.Mesh(i,c),f=new THREE.Mesh(s,u),p=new THREE.Mesh(l,d);n.sphereObject=new THREE.Object3D,n.sphereObject.add(a,h,f,p),n.sphereObject.name=n.me.name}t.addGroup(n.sphereObject)}var n={sphereObject:null,scale:null};return{name:"debugThreejs",onInit:function(e){n.me=e,t.call(this)},onCreate:function(){e.call(this)},sphere:function(){return n.sphereObject}}},oceanThreejs:function(t){function e(){this._.options.transparentOcean=!1}function n(){var e=this.threejsPlugin;if(!r.sphereObject){var n=this._.proj.scale(),a=new THREE.SphereGeometry(n,30,30);if(t){var i=new THREE.AmbientLight(o),s=new THREE.Mesh(a,r.material);r.sphereObject=new THREE.Group,r.sphereObject.add(i),r.sphereObject.add(s)}else r.sphereObject=new THREE.Mesh(a,r.material);r.sphereObject.name=r.me.name}e.addGroup(r.sphereObject)}var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:11184810,r={sphereObject:null};return r.material=t?new THREE.MeshPhongMaterial({color:t}):new THREE.MeshNormalMaterial({transparent:!1,wireframe:!1,opacity:.8}),{name:"oceanThreejs",onInit:function(t){r.me=t,e.call(this)},onCreate:function(){n.call(this)},sphere:function(){return r.sphereObject}}},imageThreejs:function(){function t(){var t=this.threejsPlugin;o.material=new THREE.MeshBasicMaterial({map:t.texture(n),side:THREE.DoubleSide,transparent:!0,alphaTest:.5}),Object.defineProperty(o.me,"transparent",{get:function(){return o.transparent},set:function(t){o.transparent=t,t?(o.material.side=THREE.DoubleSide,o.material.alphaTest=.01):(o.material.side=THREE.FrontSide,o.material.alphaTest=0),o.material.needsUpdate=!0}})}function e(){var t=this.threejsPlugin;if(o.sphereObject)t.addGroup(o.sphereObject);else{var e=this._.proj.scale(),n=new THREE.SphereGeometry(e,30,30);o.sphereObject=new THREE.Mesh(n,o.material),o.sphereObject.name=o.me.name,t.addGroup(o.sphereObject)}}var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../globe/world.png",o={sphereObject:null};return{name:"imageThreejs",onInit:function(e){o.me=e,o.transparent=!1,t.call(this)},onCreate:function(){e.call(this)},sphere:function(){return o.sphereObject}}},inertiaThreejs:function(){function t(){g&&(void 0!==m&&void 0!==y&&(f+=.012*(m-d),p+=.012*(y-h),Math.abs(m-d)<.1&&Math.abs(y-h)<.1&&(m=void 0,y=void 0)),d+=f,h+=p,f*=.98,p*=.98,(v||void 0!==m)&&(f*=.6,p*=.6),d<-w&&(d=-w,f*=-.95),d>w&&(d=w,f*=-.95),v||i.rotation.x.toPrecision(5)!==d.toPrecision(5)||i.rotation.y.toPrecision(5)!==h.toPrecision(5)||(g=!1),i.rotation.x=d,i.rotation.y=h,i.renderThree(!0))}function e(t){c=s,u=l,s=t.clientX-.5*window.innerWidth,l=t.clientY-.5*window.innerHeight,v&&(p+=(s-c)/2*.005235987755982988,f+=(l-u)/2*.005235987755982988)}function n(){v=!0,g=!0,m=void 0,m=void 0}function o(){v=!1}function r(){document.addEventListener("mousemove",e,!0),document.addEventListener("mousedown",n,!0),document.addEventListener("mouseup",o,!1)}function a(){var e=this.threejsPlugin;i.rotation=e.group.rotation,i.renderThree=e.renderThree,this._.options.tween=t}var i={},s=0,l=0,c=0,u=0,d=0,h=0,f=0,p=0,v=!1,g=!1,m=void 0,y=void 0,w=90*Math.PI/180;return{name:"inertiaThreejs",onInit:function(t){i.me=t,r.call(this)},onCreate:function(){a.call(this),setTimeout(function(){d=i.rotation.x,h=i.rotation.y},0)}}},worldThreejs:function(){function t(){var t=this.threejsPlugin;if(!n.sphereObject){var e=topojson.mesh(n.world,n.world.objects.countries),o=new THREE.MeshBasicMaterial({color:7368816});n.sphereObject=t.wireframe(e,o),n.sphereObject.name=n.me.name}t.addGroup(n.sphereObject)}var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../globe/world.png",n={world:null,land:null,lakes:{type:"FeatureCollection",features:[]},selected:{type:"FeatureCollection",features:[]},countries:{type:"FeatureCollection",features:[]}};return{name:"worldThreejs",urls:e&&[e],onReady:function(t,e){n.me.data(e)},onInit:function(t){n.me=t,this._.options.showLand=!0},onCreate:function(){t.call(this)},data:function(t){if(!t)return n.world;n.world=t,n.land=topojson.feature(t,t.objects.land),n.lakes.features=topojson.feature(t,t.objects.ne_110m_lakes).features,n.countries.features=topojson.feature(t,t.objects.countries).features},allData:function(t){if(!t)return{world:n.world,land:n.land,lakes:n.lakes,countries:n.countries};n.world=t.world,n.land=t.land,n.lakes=t.lakes,n.countries=t.countries},sphere:function(){return n.sphereObject}}},globeThreejs:function(){function t(){this._.options.showGlobe=!0}function e(){var t=this.threejsPlugin;if(a.sphereObject)t.addGroup(a.sphereObject);else{var e=this._.proj.scale(),i=t.texture(n),s=t.texture(o),l=t.texture(r),c=new THREE.SphereGeometry(e,30,30),u=new THREE.MeshPhongMaterial({map:i,bumpMap:s,bumpScale:.01,specularMap:l,specular:new THREE.Color("grey")});a.sphereObject=new THREE.Mesh(c,u),a.sphereObject.name=a.me.name,this.threejsPlugin.domEvents&&this.threejsPlugin.domEvents.addEventListener(a.sphereObject,"mousemove",function(t){var e=!0,n=!1,o=void 0;try{for(var r,i=a.onHoverVals[Symbol.iterator]();!(e=(r=i.next()).done);e=!0)r.value.call(t.target,t)}catch(t){n=!0,o=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw o}}},!1);var d=new THREE.AmbientLight(7829367),h=new THREE.DirectionalLight(16777215,.2),f=new THREE.DirectionalLight(16777215,.2);h.position.set(5,3,6),f.position.set(5,3,-6),t.addGroup(d),t.addGroup(h),t.addGroup(f),t.addGroup(a.sphereObject)}}var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../globe/world_1.jpg",o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"../globe/earth_elevation.jpg",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"../globe/earth_water.png",a={sphereObject:null,onHover:{},onHoverVals:[]};return{name:"globeThreejs",onInit:function(e){a.me=e,t.call(this)},onCreate:function(){e.call(this)},onHover:function(t){Object.assign(a.onHover,t),a.onHoverVals=Object.keys(a.onHover).map(function(t){return a.onHover[t]})},sphere:function(){return a.sphereObject}}},sphereThreejs:function(){function t(){var t=this.threejsPlugin;if(n.sphereObject)t.addGroup(n.sphereObject);else{var r=this._.proj.scale(),a=new THREE.SphereGeometry(r,30,30),i=THREE.UniformsUtils.clone(o.earth.uniforms),s=THREE.UniformsUtils.clone(o.atmosphere.uniforms);i.texture.value=t.texture(e);var l=new THREE.Mesh(a,new THREE.ShaderMaterial({uniforms:i,vertexShader:o.earth.vertexShader,fragmentShader:o.earth.fragmentShader})),c=new THREE.Mesh(a,new THREE.ShaderMaterial({uniforms:s,vertexShader:o.atmosphere.vertexShader,fragmentShader:o.atmosphere.fragmentShader,side:THREE.BackSide,blending:THREE.AdditiveBlending,transparent:!0})),u=new THREE.Group;u.add(l),u.add(c),n.sphereObject=u,n.sphereObject.name=n.me.name,t.addGroup(n.sphereObject)}}var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../globe/world.png",n={sphereObject:null},o={earth:{uniforms:{texture:{type:"t",value:null}},vertexShader:["varying vec3 vNormal;","varying vec2 vUv;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","vUv = uv;","}"].join("\n"),fragmentShader:["uniform sampler2D texture;","varying vec3 vNormal;","varying vec2 vUv;","void main() {","vec3 diffuse = texture2D( texture, vUv ).xyz;","float intensity = 1.05 - dot( vNormal, vec3( 0.0, 0.0, 1.0 ) );","vec3 atmosphere = vec3( 1.0, 1.0, 1.0 ) * pow( intensity, 3.0 );","gl_FragColor = vec4( diffuse + atmosphere, 1.0 );","}"].join("\n")},atmosphere:{uniforms:{},vertexShader:["varying vec3 vNormal;","void main() {","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec3 vNormal;","void main() {","float intensity = pow( 0.8 - dot( vNormal, vec3( 0, 0, 1.0 ) ), 12.0 );","gl_FragColor = vec4( 1.0, 1.0, 1.0, 1.0 ) * intensity;","}"].join("\n")}};return{name:"sphereThreejs",onInit:function(t){n.me=t,this._.options.showSphere=!0},onCreate:function(){t.call(this)},sphere:function(){return n.sphereObject},imgSrc:function(t){var e=this.threejsPlugin,o=n.me.sphere().children[0].material;o.uniforms.texture.value=e.texture(t),o.needsUpdate=!0}}},world3d:function(){function e(){var e=c.world;for(var n in e){var o=new t(e[n],s);c.sphereObject.add(e[n].mesh=new THREE.Mesh(o,c.material))}c.loaded=!0}function n(){var t=this._.proj.scale()+5;this._.options.showWorld=!0,c.sphereObject.rotation.y=l,c.sphereObject.scale.set(t,t,t),r.call(this,i,function(t){c.material=t,c.world&&!c.loaded&&e()})}function o(){c.material&&!c.loaded&&e(),c.sphereObject.name=c.me.name,this.threejsPlugin.addGroup(c.sphereObject)}function r(t,e){var n=this.threejsPlugin,o=THREE.SmoothShading,r={tMatCap:{type:"t",value:n.texture(t)}},a=new THREE.ShaderMaterial({shading:o,uniforms:r,vertexShader:u,fragmentShader:d});e.call(this,a)}var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../d/world.geometry.json",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"../globe/gold.jpg",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1.57,c={sphereObject:new THREE.Object3D},u="\n    varying vec2 vN;\n    void main() {\n        vec4 p = vec4( position, 1. );\n        vec3 e = normalize( vec3( modelViewMatrix * p ) );\n        vec3 n = normalize( normalMatrix * normal );\n        vec3 r = reflect( e, n );\n        float m = 2. * length( vec3( r.xy, r.z + 1. ) );\n        vN = r.xy / m + .5;\n        gl_Position = projectionMatrix * modelViewMatrix * p;\n    }\n    ",d="\n    uniform sampler2D tMatCap;\n    varying vec2 vN;\n    void main() {\n        vec3 base = texture2D( tMatCap, vN ).rgb;\n        gl_FragColor = vec4( base, 1. );\n    }\n    ";return{name:"world3d",urls:a&&[a],onReady:function(t,e){c.me.data(e)},onInit:function(t){c.me=t,n.call(this)},onCreate:function(){o.call(this)},rotate:function(t){c.sphereObject.rotation.y=t},data:function(t){if(!t)return c.world;c.world=t},sphere:function(){return c.sphereObject},extrude:function(e){for(var n in c.world){var o=c.world[n];o.mesh.geometry=new t(o,e)}}}},world3d2:function(){function t(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=t.vertices.length/2;t.vertices.forEach(function(t,r){var a=e;r>=o&&(a=1+n);var i=.017453292519943295*(90-t.oy),s=.017453292519943295*(360-t.ox);t.x=a*Math.sin(i)*Math.cos(s),t.y=a*Math.cos(i),t.z=a*Math.sin(i)*Math.sin(s)}),t.verticesNeedUpdate=!0,t.computeFaceNormals()}function e(e){var n=new THREE.Shape(e),o=new THREE.ExtrudeGeometry(n,{bevelEnabled:!1,amount:16});return o.vertices.forEach(function(t){t.ox=t.x,t.oy=t.y,t.oz=t.z}),t(o,s,l),new THREE.Mesh(o,p)}function n(t,n){var o=t.id,r=[],a=u.group[o];void 0===a&&((a=new THREE.Group).name=o,u.group[o]=a,u.sphereObject.add(a)),n.forEach(function(t){r.push(new THREE.Vector2(t[0],t[1]))});var i=e(r);i.cid=t.properties.cid,a.add(i)}function o(){var t=this._.options.choropleth;u.world.features.forEach(function(e){var o=e.geometry.coordinates;p=t?new THREE.MeshPhongMaterial({color:new THREE.Color(e.properties.color||"rgb(2, 20, 37)"),side:THREE.DoubleSide}):u.material,1===o.length?n(e,o[0]):o.forEach(function(t){1==t.length?n(e,t[0]):n(e,t)})})}function r(){!u.loaded&&o.call(this),this.threejsPlugin.addGroup(u.sphereObject)}function a(){var t=this._.proj.scale();this._.options.showWorld=!0,u.sphereObject.rotation.y=c,u.sphereObject.scale.set(t,t,t),u.sphereObject.name=u.me.name}var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../d/countries.geo.json",s=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9),l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u={group:{},sphereObject:new THREE.Group,material:new THREE.MeshPhongMaterial({color:new THREE.Color(11180339),side:THREE.DoubleSide})},d=new THREE.AmbientLight(7829367),h=new THREE.DirectionalLight(16777215),f=new THREE.DirectionalLight(16777215);h.position.set(1,0,1),f.position.set(-1,0,1),u.sphereObject.add(d),u.sphereObject.add(h),u.sphereObject.add(f);var p=void 0;return{name:"world3d2",urls:i&&[i],onReady:function(t,e){u.me.data(e)},onInit:function(t){u.me=t,a.call(this)},onCreate:function(){r.call(this)},rotate:function(t){u.sphereObject.rotation.y=t},data:function(t){if(!t)return u.world;u.world=t},sphere:function(){return u.sphereObject},group:function(){return u.group},extrude:function(e,n,o){u.group[e]&&u.group[e].children.forEach(function(e){t(e.geometry,n,o)})}}},commonPlugins:function(t){function e(){var e=this,n=this.register,o=earthjs.plugins;n(o.mousePlugin()),n(o.configPlugin()),n(o.autorotatePlugin()),n(o.dropShadowSvg()),n(o.oceanSvg()),n(o.canvasPlugin()),n(o.graticuleCanvas()),n(o.worldCanvas(t)),this._.options.transparent=!0,this.canvasPlugin.selectAll(".ej-canvas"),this.graticuleCanvas.drawTo([1]),this.worldCanvas.drawTo([0]),r.options=this.configPlugin.set(),r.buttonClick=function(t){var n=t.split(":")[2],o={},r=e.configPlugin.set();r[n]=!r[n],o[n]=r[n],"transparent"==n?((r.transparentGraticule||r.transparentLand)&&(o.transparent=!1),o.transparentGraticule=!1,o.transparentLand=!1):"showCountries"==n||"showLakes"==n?o.showLand=!0:"transparentGraticule"!=n&&"transparentLand"!=n||(r.transparent&&(o.transparentGraticule=!1,o.transparentLand=!1),o.transparent=!1),e.configPlugin.set(o)}}function n(t,e,n,o,r,a,i){t.append("br"),t.append("input").attr("id",e).attr("type","range").attr("min",n).attr("max",o).attr("step",r).attr("value",a).on("input",i)}function o(){var t=this,e=this,o=d3.select(".set-options"),a=d3.select(".set-options2");if(o.selectAll("button, input, br").remove(),a.selectAll("button, input, br").remove(),this._.options.showControll){o.selectAll("button").data(r.checker).enter().append("button").text(function(t){return t[1]}).on("click",function(e){return r.buttonClick.call(t,e.join(":"))}),n(a,"pan",0,400,1,r.pan,function(){r.pan=+this.value;for(var t=1;t<i.length;t++)i[t].style.left=r.pan*t+"px"}),n(a,"ocn",0,20,1,r.ocn,function(){r.ocn=this.value,e.oceanSvg.scale(-r.ocn)}),n(a,"spd",10,200,10,r.spd,function(){r.spd=this.value,e.autorotatePlugin.speed(r.spd)});var i=d3.selectAll(".ea-layer").nodes()}}var r={checker:[],ocn:0,spd:10,pan:0,clr:0};return r.checker=[":Shadow:showDropShadow",":Ocean:showOcean",":Graticule:showGraticule",":Land:showLand",":Country:showCountries",":Lakes:showLakes",":Transparent:transparent",":Canvas:showCanvas",":Spin:spin"].map(function(t){return t.split(":")}),{name:"commonPlugins",onInit:function(t){r.me=t,e.call(this),this._.options.showControll=!0},onCreate:function(){o.call(this)},addChecker:function(t){r.checker.push(t),r.options=this.configPlugin.set(),o.call(this)}}},selectCountryMix:function(){function t(){var t=this.register(earthjs.plugins.mousePlugin()).register(earthjs.plugins.hoverCanvas()).register(earthjs.plugins.clickCanvas()).register(earthjs.plugins.centerCanvas()).register(earthjs.plugins.canvasPlugin()).register(earthjs.plugins.countryCanvas()).register(earthjs.plugins.autorotatePlugin()).register(earthjs.plugins.worldCanvas(e)).register(earthjs.plugins.threejsPlugin());t.canvasPlugin.selectAll(".ej-canvas"),t._.options.showSelectedCountry=!0,t._.options.showBorder=!1,t.worldCanvas.style({countries:"rgba(220,91,52,0.2)"}),t.worldCanvas.ready=function(e,n){t.countryCanvas.data(n),t.worldCanvas.data(n),t.hoverCanvas.data(n),t.clickCanvas.data(n)},t.centerCanvas.focused(function(e,n){if(t.autorotatePlugin.stop(),e.metaKey){var o=t.worldCanvas.selectedCountries().concat(n);t.worldCanvas.selectedCountries(o)}else t.worldCanvas.selectedCountries([n]);console.log(n)})}var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../d/world-110m.json",n={};return{name:"selectCountryMix",onInit:function(e){n.me=e,t.call(this)},region:function(t,e){var n=this,o=n.worldCanvas.countries().filter(function(e){return t.indexOf(e.id)>-1});n.worldCanvas.selectedCountries(o),n.autorotatePlugin.stop(),e&&n.centerCanvas.go(e)},multiRegion:function(t,e){var n=[],o=this,r=!0,a=!1,i=void 0;try{for(var s,l=function(){var t=s.value,e=o.worldCanvas.countries().filter(function(e){var n=t.countries.indexOf(e.id)>-1;return n&&(e.color=t.color),n});n=n.concat(e)},c=t[Symbol.iterator]();!(r=(s=c.next()).done);r=!0)l()}catch(t){a=!0,i=t}finally{try{!r&&c.return&&c.return()}finally{if(a)throw i}}o.worldCanvas.selectedCountries(n,!0),o.autorotatePlugin.stop(),e&&o.centerCanvas.go(e)}}},selectCountryMix2:function(){function t(){var t=this.register(earthjs.plugins.worldJson(e)).register(earthjs.plugins.mousePlugin()).register(earthjs.plugins.hoverCanvas()).register(earthjs.plugins.clickCanvas()).register(earthjs.plugins.centerCanvas()).register(earthjs.plugins.countryCanvas()).register(earthjs.plugins.threejsPlugin()).register(earthjs.plugins.autorotatePlugin());n&&t.register(earthjs.plugins.imageThreejs(n)),t.register(earthjs.plugins.canvasThreejs()),t._.options.showSelectedCountry=!0,t._.options.showBorder=!1,t.canvasThreejs.style({countries:"rgba(220,91,52,0.5)"}),t.centerCanvas.focused(function(e,n){if(t.autorotatePlugin.stop(),e.metaKey){var o=t.canvasThreejs.selectedCountries().concat(n);t.canvasThreejs.selectedCountries(o)}else t.canvasThreejs.selectedCountries([n]);t.canvasThreejs.refresh(),console.log(n)})}var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../d/world-110m.json",n=arguments[1],o={};return{name:"selectCountryMix2",onInit:function(e){o.me=e,t.call(this)},region:function(t,e){var n=this,o=n.canvasThreejs.countries().filter(function(e){return t.indexOf(e.id)>-1});n.canvasThreejs.selectedCountries(o),n.autorotatePlugin.stop(),e&&n.centerCanvas.go(e)},multiRegion:function(t,e){var n=[],o=this,r=!0,a=!1,i=void 0;try{for(var s,l=function(){var t=s.value,e=o.canvasThreejs.countries().filter(function(e){var n=t.countries.indexOf(e.id)>-1;return n&&(e.color=t.color),n});n=n.concat(e)},c=t[Symbol.iterator]();!(r=(s=c.next()).done);r=!0)l()}catch(t){a=!0,i=t}finally{try{!r&&c.return&&c.return()}finally{if(a)throw i}}o.canvasThreejs.selectedCountries(n,!0),o.autorotatePlugin.stop(),e&&o.centerCanvas.go(e)}}}},n}();